import{j as e,L as H,C as me,B as P,x as ce,I as at,y as _e,P as ue,z as nt,A as ot,E as Ge,F as lt,R as it,G as ct,H as dt,J as ke,K as mt,M as ie,v as ht}from"./index-Bzb4F3kx.js";import{r as N,R as L,h as ut}from"./router-C0wDHNfv.js";import{u as xt}from"./usePageTitle-CpPgFbZv.js";import{C as I,a as U,b as X,c as J}from"./card-WXtfKUg2.js";import{S as Z,a as ee,b as te,c as se,d as R,C as he}from"./select-WonCfv9o.js";import{P as xe,a as pe,C as ge,b as fe,c as je,d as be,e as ve,f as ye,g as Ne,h as Q}from"./popover-MapSAk0u.js";import{C as Pe}from"./checkbox-BjBjZgw6.js";import{u as pt}from"./useMonthlyStockData-CuShNDzV.js";import{u as gt}from"./useStockData-BWzV3G2_.js";import{B as Ve}from"./badge-OBSMywpV.js";import{T as ft,a as jt,b as Fe,c as q,d as bt,e as K}from"./table-CGHOFhqg.js";import{A as vt}from"./arrow-up-down-nlnHjzKT.js";import{A as yt,a as Nt}from"./arrow-up-CA_LF0IU.js";import{R as Ce,d as wt,C as Se,X as De,Y as Me,T as Ae,L as He,e as Re,f as Be,g as _t,B as Le,b as ne,h as kt}from"./charts-B8eVsusH.js";import{T as Ct}from"./trending-down-BlFXryvF.js";import{A as Ee}from"./arrow-left-Cme9G3bo.js";import"./csv-B1Pu-2A6.js";const W=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],St=({data:x,selectedMonths:t=[],currentMonth:m,currentMonthPerformance:c})=>{const[o,_]=N.useState("pct_pos_return_months"),[p,h]=N.useState("pct_pos_return_months"),[r,S]=N.useState(20),[g,d]=N.useState(null),[f,b]=N.useState(!1),[i,v]=N.useState("desc"),C=t.length>0&&m!==void 0&&t.includes(m)&&((c==null?void 0:c.size)??0)>0,k=m!==void 0?`${W[m-1]} MTD`:"MTD",z=()=>{f?i==="desc"?v("asc"):b(!1):(b(!0),d(null),v("desc"))},B=n=>{g!==n?(d(n),b(!1),v("desc")):i==="desc"?v("asc"):d(null)},F=N.useMemo(()=>{const n=new Map;x.forEach(s=>{n.has(s.name)||n.set(s.name,{name:s.name,avgReturn:0,avgPosMonths:0,monthlyData:new Map}),n.get(s.name).monthlyData.set(s.month,s)}),n.forEach(s=>{const u=Array.from(s.monthlyData.values()),A=u.map(D=>D.return_month_mean_pct_return_month),E=u.map(D=>D.pct_pos_return_months);s.avgReturn=A.length>0?A.reduce((D,T)=>D+T,0)/A.length:0,s.avgPosMonths=E.length>0?E.reduce((D,T)=>D+T,0)/E.length:0});const j=i==="desc"?1:-1;return Array.from(n.values()).sort((s,u)=>{var A,E;if(f&&c){const D=c.get(s.name)??-1/0;return((c.get(u.name)??-1/0)-D)*j}if(g!==null){const D=((A=s.monthlyData.get(g))==null?void 0:A[o])||0;return((((E=u.monthlyData.get(g))==null?void 0:E[o])||0)-D)*j}switch(p){case"pct_pos_return_months":if(t.length>0){const D=t.map(V=>{var $;return(($=s.monthlyData.get(V))==null?void 0:$.pct_pos_return_months)||0}),T=t.map(V=>{var $;return(($=u.monthlyData.get(V))==null?void 0:$.pct_pos_return_months)||0}),O=D.reduce((V,$)=>V+$,0)/D.length;return T.reduce((V,$)=>V+$,0)/T.length-O}else return u.avgPosMonths-s.avgPosMonths;case"avg_return":if(t.length>0){const D=t.map(V=>{var $;return(($=s.monthlyData.get(V))==null?void 0:$.return_month_mean_pct_return_month)||0}),T=t.map(V=>{var $;return(($=u.monthlyData.get(V))==null?void 0:$.return_month_mean_pct_return_month)||0}),O=D.reduce((V,$)=>V+$,0)/D.length;return T.reduce((V,$)=>V+$,0)/T.length-O}else return u.avgReturn-s.avgReturn;case"alphabetical":return s.name.localeCompare(u.name);default:return u.avgPosMonths-s.avgPosMonths}}).slice(0,r)},[x,p,r,t,g,o,f,c,i]),M=N.useMemo(()=>{const n=F.flatMap(s=>t.length===0?Array.from({length:12},(u,A)=>{const E=A+1,D=s.monthlyData.get(E);return D?D[o]:null}).filter(u=>u!==null):t.map(u=>{const A=s.monthlyData.get(u);return A?A[o]:null}).filter(u=>u!==null));if(n.length===0)return null;const j=n.sort((s,u)=>s-u),l=s=>{const u=Math.ceil(s*j.length/100)-1;return j[Math.max(0,Math.min(u,j.length-1))]};return{p20:l(20),p40:l(40),p60:l(60),p80:l(80)}},[F,o,t]),G=(n,j)=>n===null||!M?"bg-slate-100 dark:bg-slate-800":n<=M.p20?"bg-gradient-to-br from-red-500 to-red-600":n<=M.p40?"bg-gradient-to-br from-orange-400 to-orange-500":n<=M.p60?"bg-gradient-to-br from-amber-400 to-amber-500":n<=M.p80?"bg-gradient-to-br from-emerald-400 to-emerald-500":"bg-gradient-to-br from-emerald-500 to-emerald-600",y=n=>n<5?"opacity-40":n<10?"opacity-70":"opacity-100",a=(n,j)=>{if(n===null)return"—";if(j==="pct_pos_return_months")return Math.round(n).toString();{const l=n*100,s=Math.round(l*100)/100;return s>0?`+${s.toFixed(2)}%`:`${s.toFixed(2)}%`}},w=(n,j,l)=>l?`${n} - ${W[j-1]}
${l.pct_pos_return_months.toFixed(1)}% positive months
Avg return: ${l.return_month_mean_pct_return_month.toFixed(2)}%
Data points: ${l.number_of_months_available} months`:"No data available";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[(g!==null||f)&&e.jsx("div",{className:"p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ve,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:["Sorted by ",f?k:W[g-1]," (",i==="desc"?"↓":"↑",")"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click any column header to change sorting or click again to clear"})]}),e.jsx("button",{onClick:()=>{d(null),b(!1)},className:"text-sm text-muted-foreground hover:text-foreground underline",children:"Clear sorting"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 p-6 bg-gradient-to-r from-muted/10 to-muted/20 rounded-xl border border-border/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{htmlFor:"metric-select",className:"text-sm font-medium",children:"Metric:"}),e.jsxs(Z,{value:o,onValueChange:n=>_(n),children:[e.jsx(ee,{id:"metric-select",className:"w-44 bg-background",children:e.jsx(te,{})}),e.jsxs(se,{className:"bg-background border shadow-lg z-50",children:[e.jsx(R,{value:"pct_pos_return_months",children:"% Positive Months"}),e.jsx(R,{value:"return_month_mean_pct_return_month",children:"Average Return"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{htmlFor:"sort-select",className:"text-sm font-medium",children:"Sort by:"}),e.jsxs(Z,{value:p,onValueChange:n=>h(n),children:[e.jsx(ee,{id:"sort-select",className:"w-36 bg-background",children:e.jsx(te,{})}),e.jsxs(se,{className:"bg-background border shadow-lg z-50",children:[e.jsx(R,{value:"pct_pos_return_months",children:"% Positive Months"}),e.jsx(R,{value:"avg_return",children:"Avg Return"}),e.jsx(R,{value:"alphabetical",children:"Alphabetical"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{htmlFor:"stocks-select",className:"text-sm font-medium",children:"Show:"}),e.jsxs(Z,{value:r.toString(),onValueChange:n=>S(parseInt(n)),children:[e.jsx(ee,{id:"stocks-select",className:"w-28 bg-background",children:e.jsx(te,{})}),e.jsxs(se,{className:"bg-background border shadow-lg z-50",children:[e.jsx(R,{value:"10",children:"Top 10"}),e.jsx(R,{value:"20",children:"Top 20"}),e.jsx(R,{value:"30",children:"Top 30"}),e.jsx(R,{value:"50",children:"Top 50"})]})]})]})]})]}),e.jsx("div",{className:"w-full overflow-x-auto bg-background rounded-lg border shadow-sm",children:e.jsxs("div",{className:"min-w-[1200px] p-6",children:[e.jsxs("div",{className:"flex mb-3 pb-2 border-b border-border/50",children:[e.jsx("div",{className:"w-40 flex-shrink-0 text-sm font-semibold text-foreground px-3 py-2",children:"Stock Symbol"}),t.length===0?W.map((n,j)=>{const l=j+1,s=g===l;return e.jsxs("button",{onClick:()=>B(l),className:`
                      w-16 flex-shrink-0 text-sm font-semibold text-center px-2 py-2 rounded-md mx-0.5
                      transition-all duration-200 cursor-pointer hover:bg-muted/20
                      flex items-center justify-center gap-1
                      ${s?"bg-primary/10 text-primary border-2 border-primary/20":"text-foreground hover:text-primary"}
                    `,title:`Click to sort by ${n} values`,children:[n,s&&(i==="desc"?e.jsx(me,{className:"h-3 w-3"}):e.jsx(he,{className:"h-3 w-3"}))]},n)}):e.jsxs(e.Fragment,{children:[t.map(n=>{const j=g===n;return e.jsxs("button",{onClick:()=>B(n),className:`
                        w-16 flex-shrink-0 text-sm font-semibold text-center px-2 py-2 rounded-md mx-0.5
                        transition-all duration-200 cursor-pointer hover:bg-muted/20
                        flex items-center justify-center gap-1
                        ${j?"bg-primary/10 text-primary border-2 border-primary/20":"text-foreground hover:text-primary"}
                      `,title:`Click to sort by ${W[n-1]} values`,children:[W[n-1],j&&(i==="desc"?e.jsx(me,{className:"h-3 w-3"}):e.jsx(he,{className:"h-3 w-3"}))]},n)}),C&&e.jsxs("div",{className:"flex items-center ml-1",children:[e.jsx("div",{className:"w-px self-stretch bg-border mx-1"}),e.jsxs("button",{onClick:z,className:`
                        w-20 flex-shrink-0 text-xs font-semibold text-center px-2 py-2 rounded-md
                        transition-all duration-200 cursor-pointer flex flex-col items-center justify-center gap-0.5
                        ${f?"bg-primary/10 text-primary border-2 border-primary/20":"text-blue-600 dark:text-blue-400 hover:bg-muted/20"}
                      `,title:"Click to sort by current month performance",children:[e.jsx("span",{children:W[(m??1)-1]}),e.jsx("span",{className:"text-[10px] font-normal opacity-80",children:"MTD"}),f&&(i==="desc"?e.jsx(me,{className:"h-3 w-3"}):e.jsx(he,{className:"h-3 w-3"}))]})]})]})]}),e.jsx("div",{className:"space-y-2",children:F.map(n=>e.jsxs("div",{className:"flex items-center hover:bg-muted/5 rounded-lg transition-colors duration-200",children:[e.jsx("div",{className:"w-40 flex-shrink-0 text-sm font-medium px-3 py-2 truncate text-foreground",title:n.name,children:n.name}),t.length===0?Array.from({length:12},(j,l)=>{const s=l+1,u=n.monthlyData.get(s),A=u?u[o]:null,E=(u==null?void 0:u.number_of_months_available)||0;return e.jsxs("div",{className:`
                          w-16 h-10 flex-shrink-0 rounded-md flex items-center justify-center
                          text-xs font-semibold text-white cursor-help transition-all duration-200
                          hover:scale-105 hover:shadow-lg hover:z-10 relative border border-white/20 mx-0.5
                          ${G(A)}
                          ${y(E)}
                        `,title:w(n.name,s,u),onTouchStart:D=>{const T=w(n.name,s,u),O=document.createElement("div");O.className="fixed z-50 bg-black text-white text-xs p-2 rounded shadow-lg pointer-events-none",O.textContent=T,O.style.top=`${D.touches[0].clientY-50}px`,O.style.left=`${D.touches[0].clientX-75}px`,document.body.appendChild(O),setTimeout(()=>{document.body.removeChild(O)},2e3)},children:[a(A,o),E<5&&A!==null&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/20 rounded-sm pointer-events-none"})]},l)}):e.jsxs(e.Fragment,{children:[t.map(j=>{const l=n.monthlyData.get(j),s=l?l[o]:null,u=(l==null?void 0:l.number_of_months_available)||0;return e.jsxs("div",{className:`
                            w-16 h-10 flex-shrink-0 rounded-md flex items-center justify-center
                            text-xs font-semibold text-white cursor-help transition-all duration-200
                            hover:scale-105 hover:shadow-lg hover:z-10 relative border border-white/20 mx-0.5
                            ${G(s)}
                            ${y(u)}
                          `,title:w(n.name,j,l),onTouchStart:A=>{const E=w(n.name,j,l),D=document.createElement("div");D.className="fixed z-50 bg-black text-white text-xs p-2 rounded shadow-lg pointer-events-none",D.textContent=E,D.style.top=`${A.touches[0].clientY-50}px`,D.style.left=`${A.touches[0].clientX-75}px`,document.body.appendChild(D),setTimeout(()=>{document.body.removeChild(D)},2e3)},children:[a(s,o),u<5&&s!==null&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/20 rounded-sm pointer-events-none"})]},j)}),C&&(()=>{const j=c==null?void 0:c.get(n.name),l=j!==void 0&&j>=0;return e.jsxs("div",{className:"flex items-center gap-0.5 ml-1",children:[e.jsx("div",{className:"w-px self-stretch bg-border mx-1"}),e.jsx("div",{className:`
                              w-16 h-10 flex-shrink-0 rounded-md flex items-center justify-center
                              text-xs font-semibold text-white cursor-default transition-all duration-200
                              hover:scale-105 hover:shadow-lg border border-white/20
                              ${j===void 0?"bg-muted text-muted-foreground":l?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-red-500 to-red-600"}
                            `,title:`${n.name} — current month to date: ${j!==void 0?(j>=0?"+":"")+j.toFixed(2)+"%":"no data"}`,children:j!==void 0?`${l?"+":""}${j.toFixed(2)}%`:"—"})]})})()]})]},n.name))})]})}),e.jsxs("div",{className:"space-y-4 p-6 bg-gradient-to-r from-muted/5 to-muted/10 rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:o==="pct_pos_return_months"?"Performance Scale - % Positive Months":"Performance Scale - Average Return (%)"}),M&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"Lowest 20%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-orange-400 to-orange-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"20-40%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-amber-400 to-amber-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"40-60%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-emerald-400 to-emerald-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"60-80%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"Top 20%"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground pt-2 border-t border-border/30",children:[e.jsx("span",{className:"font-medium",children:"Data Reliability:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md opacity-40 shadow-sm"}),e.jsx("span",{children:"<5 months (limited data)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md opacity-70 shadow-sm"}),e.jsx("span",{children:"5-10 months (moderate)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md shadow-sm"}),e.jsx("span",{children:"10+ months (reliable)"})]})]})]})]})},Dt=["All Months","January","February","March","April","May","June","July","August","September","October","November","December"],Mt=({data:x})=>{const[t,m]=N.useState("pct_pos_return_months"),[c,o]=N.useState("desc"),[_,p]=N.useState(""),[h,r]=N.useState(1),[S,g]=N.useState(0),[d,f]=N.useState(""),[b,i]=N.useState(!1),v=20,C=N.useMemo(()=>Array.from(new Set(x.map(w=>w.name))).sort(),[x]),k=a=>{t===a?o(c==="asc"?"desc":"asc"):(m(a),o("desc")),r(1)},z=N.useMemo(()=>{let a=x;return S>0&&(a=a.filter(w=>w.month===S)),d&&(a=a.filter(w=>w.name===d)),_&&(a=a.filter(w=>w.name.toLowerCase().includes(_.toLowerCase()))),[...a].sort((w,n)=>{let j=w[t],l=n[t];if(t==="name"){const s=String(j).localeCompare(String(l));return c==="asc"?s:-s}return j=Number(j)||0,l=Number(l)||0,c==="asc"?j-l:l-j})},[x,_,t,c,S,d]),B=N.useMemo(()=>{const a=(h-1)*v;return z.slice(a,a+v)},[z,h]),F=Math.ceil(z.length/v),M=a=>t!==a?e.jsx(vt,{className:"h-4 w-4"}):c==="asc"?e.jsx(yt,{className:"h-4 w-4"}):e.jsx(Nt,{className:"h-4 w-4"}),G=(a,w=2)=>a.toFixed(w),y=a=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a-1]||"All";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted/20 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Month Filter"}),e.jsxs(Z,{value:S.toString(),onValueChange:a=>{g(parseInt(a)),r(1)},children:[e.jsx(ee,{children:e.jsx(te,{})}),e.jsx(se,{className:"bg-background border shadow-lg z-50",children:Dt.map((a,w)=>e.jsx(R,{value:w.toString(),children:a},w))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Stock Filter"}),e.jsxs(xe,{open:b,onOpenChange:i,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(P,{variant:"outline",role:"combobox","aria-expanded":b,className:"w-full justify-between",children:[d||"All stocks...",e.jsx(ge,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(fe,{className:"w-full p-0 bg-background border shadow-lg z-50",align:"start",children:e.jsxs(je,{children:[e.jsx(be,{placeholder:"Search stocks..."}),e.jsxs(ve,{children:[e.jsx(ye,{children:"No stock found."}),e.jsxs(Ne,{children:[e.jsxs(Q,{value:"",onSelect:()=>{f(""),i(!1),r(1)},children:[e.jsx(ce,{className:`mr-2 h-4 w-4 ${d===""?"opacity-100":"opacity-0"}`}),"All stocks"]}),C.map(a=>e.jsxs(Q,{value:a,onSelect:w=>{f(w===d?"":w),i(!1),r(1)},children:[e.jsx(ce,{className:`mr-2 h-4 w-4 ${d===a?"opacity-100":"opacity-0"}`}),a]},a))]})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Search"}),e.jsx(at,{placeholder:"Search stocks...",value:_,onChange:a=>{p(a.target.value),r(1)}})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[z.length," results"]}),e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"Drawdown = decline from month's open to lowest intramonth price"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ft,{children:[e.jsx(jt,{children:e.jsxs(Fe,{children:[e.jsx(q,{className:"w-20","aria-sort":t==="name"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("name"),className:"h-auto p-0 font-medium",children:["Stock ",M("name")]})}),e.jsx(q,{className:"w-16","aria-sort":t==="month"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("month"),className:"h-auto p-0 font-medium",children:["Month ",M("month")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="number_of_months_available"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("number_of_months_available"),className:"h-auto p-0 font-medium text-xs",children:["History ",M("number_of_months_available")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="pct_pos_return_months"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("pct_pos_return_months"),className:"h-auto p-0 font-medium text-xs",children:["Pos % ",M("pct_pos_return_months")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="return_month_mean_pct_return_month"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("return_month_mean_pct_return_month"),className:"h-auto p-0 font-medium text-xs",children:["Avg Ret % ",M("return_month_mean_pct_return_month")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="open_to_low_mean_pct_return_month"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("open_to_low_mean_pct_return_month"),className:"h-auto p-0 font-medium text-xs",children:["Avg Drawdown % ",M("open_to_low_mean_pct_return_month")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="open_to_low_min_pct_return_month"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("open_to_low_min_pct_return_month"),className:"h-auto p-0 font-medium text-xs",children:["Worst Drawdown % ",M("open_to_low_min_pct_return_month")]})}),e.jsx(q,{className:"w-20","aria-sort":t==="open_to_low_max_pct_return_month"?c==="asc"?"ascending":"descending":void 0,children:e.jsxs(P,{variant:"ghost",onClick:()=>k("open_to_low_max_pct_return_month"),className:"h-auto p-0 font-medium text-xs",children:["Best Drawdown % ",M("open_to_low_max_pct_return_month")]})})]})}),e.jsx(bt,{children:B.map((a,w)=>e.jsxs(Fe,{children:[e.jsx(K,{className:"font-medium",children:a.name}),e.jsx(K,{children:y(a.month)}),e.jsx(K,{children:a.number_of_months_available}),e.jsx(K,{children:e.jsxs("span",{className:a.pct_pos_return_months>=70?"text-green-600":a.pct_pos_return_months>=50?"text-yellow-600":"text-red-600",children:[G(a.pct_pos_return_months,1),"%"]})}),e.jsx(K,{children:e.jsxs("span",{className:a.return_month_mean_pct_return_month>=0?"text-green-600":"text-red-600",children:[G(a.return_month_mean_pct_return_month*100),"%"]})}),e.jsx(K,{children:e.jsxs("span",{className:a.open_to_low_mean_pct_return_month>=-.05?"text-green-600":"text-red-600",children:[G(a.open_to_low_mean_pct_return_month*100),"%"]})}),e.jsx(K,{children:e.jsxs("span",{className:"text-red-600",children:[G(a.open_to_low_min_pct_return_month*100),"%"]})}),e.jsx(K,{children:e.jsxs("span",{className:a.open_to_low_max_pct_return_month>=0?"text-green-600":"text-orange-600",children:[G(a.open_to_low_max_pct_return_month*100),"%"]})})]},`${a.name}-${a.month}-${w}`))})]})})}),F>1&&e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>r(Math.max(1,h-1)),disabled:h===1,children:"Previous"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,F)},(a,w)=>{let n;return F<=5||h<=3?n=w+1:h>=F-2?n=F-4+w:n=h-2+w,e.jsx(P,{variant:h===n?"default":"outline",size:"sm",onClick:()=>r(n),className:"w-8 h-8 p-0",children:n},n)})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>r(Math.min(F,h+1)),disabled:h===F,children:"Next"})]})]})},Oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],oe=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1","#14B8A6","#F43F5E"],At=({data:x,selectedStock:t})=>{const[m,c]=N.useState(new Set([1,2,3,4,5,6,7,8,9,10,11,12])),o=N.useMemo(()=>{if(!t||!x.length)return[];const f=x.filter(i=>i.name===t).reduce((i,v)=>(i[v.year]||(i[v.year]={}),i[v.year][v.month]||(i[v.year][v.month]=[]),i[v.year][v.month].push(v.pct_return_month),i),{});return Object.keys(f).map(i=>parseInt(i)).sort((i,v)=>i-v).map(i=>{const v={year:i};for(let C=1;C<=12;C++){const k=f[i][C];k&&k.length>0&&(v[`month_${C}`]=k.reduce((z,B)=>z+B,0)/k.length*100)}return v})},[x,t]),_=N.useMemo(()=>{if(!o.length)return{min:-10,max:10};const d=[];if(o.forEach(v=>{for(let C=1;C<=12;C++){const k=v[`month_${C}`];typeof k=="number"&&d.push(k)}}),d.length===0)return{min:-10,max:10};const f=Math.min(...d),b=Math.max(...d),i=Math.abs(b-f)*.1;return{min:f-i,max:b+i}},[o]),p=d=>{const f=new Set(m);f.has(d)?f.delete(d):f.add(d),c(f)},h=()=>{c(new Set([1,2,3,4,5,6,7,8,9,10,11,12]))},r=()=>{c(new Set)},S=(d,f)=>typeof d=="number"?[`${d.toFixed(2)}%`,f]:[d,f],g=d=>`${d.toFixed(1)}%`;return t?o.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Toggle Months"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:h,children:"Show All"}),e.jsx(P,{variant:"outline",size:"sm",onClick:r,children:"Hide All"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Oe.map((d,f)=>{const b=f+1,i=m.has(b);return e.jsx(Ve,{variant:i?"default":"outline",className:"cursor-pointer transition-colors",style:{backgroundColor:i?oe[f]:void 0,borderColor:oe[f],color:i?"white":oe[f]},onClick:()=>p(b),children:d},b)})})]}),e.jsx("div",{className:"h-96",children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(wt,{data:o,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Se,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(De,{dataKey:"year",className:"fill-muted-foreground",tick:{fontSize:12}}),e.jsx(Me,{tickFormatter:g,className:"fill-muted-foreground",tick:{fontSize:12},domain:[_.min,_.max]}),e.jsx(Ae,{formatter:S,labelFormatter:d=>`Year: ${d}`,contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(He,{}),e.jsx(Re,{y1:0,y2:_.max,fill:"#22c55e",fillOpacity:.1}),e.jsx(Re,{y1:_.min,y2:0,fill:"#ef4444",fillOpacity:.1}),e.jsx(Be,{y:0,stroke:"hsl(var(--muted-foreground))",strokeWidth:2,strokeDasharray:"5 5",label:{value:"0% (Break-even)",position:"insideTopRight",style:{fontSize:"12px",fill:"hsl(var(--muted-foreground))"}}}),Oe.map((d,f)=>{const b=f+1;return m.has(b)?e.jsx(_t,{type:"monotone",dataKey:`month_${b}`,stroke:oe[f],strokeWidth:2,name:d,connectNulls:!1,dot:{r:3},activeDot:{r:5}},b):null})]})})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• Shows monthly percentage returns for ",e.jsx("strong",{children:t})," over time"]}),e.jsx("p",{children:"• Each line represents a different calendar month across multiple years"}),e.jsxs("p",{children:["• ",e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Green shaded area"})," = positive returns, ",e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"red shaded area"})," = negative returns"]}),e.jsx("p",{children:"• Dashed line at 0% shows break-even point"}),e.jsx("p",{children:"• Click month badges above to toggle visibility • Hover over data points for detailed values"})]})]}):e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsxs("p",{children:["No historical data available for ",t]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsx("p",{children:"Please select a stock to view the timeline performance chart"})})};var Ie="Toggle",Te=N.forwardRef((x,t)=>{const{pressed:m,defaultPressed:c,onPressedChange:o,..._}=x,[p,h]=_e({prop:m,onChange:o,defaultProp:c??!1,caller:Ie});return e.jsx(ue.button,{type:"button","aria-pressed":p,"data-state":p?"on":"off","data-disabled":x.disabled?"":void 0,..._,ref:t,onClick:nt(x.onClick,()=>{x.disabled||h(!p)})})});Te.displayName=Ie;var Je=Te,Y="ToggleGroup",[qe]=ct(Y,[Ge]),Ke=Ge(),$e=L.forwardRef((x,t)=>{const{type:m,...c}=x;if(m==="single"){const o=c;return e.jsx(Tt,{...o,ref:t})}if(m==="multiple"){const o=c;return e.jsx($t,{...o,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${Y}\``)});$e.displayName=Y;var[Ye,We]=qe(Y),Tt=L.forwardRef((x,t)=>{const{value:m,defaultValue:c,onValueChange:o=()=>{},..._}=x,[p,h]=_e({prop:m,defaultProp:c??"",onChange:o,caller:Y});return e.jsx(Ye,{scope:x.__scopeToggleGroup,type:"single",value:L.useMemo(()=>p?[p]:[],[p]),onItemActivate:h,onItemDeactivate:L.useCallback(()=>h(""),[h]),children:e.jsx(Ue,{..._,ref:t})})}),$t=L.forwardRef((x,t)=>{const{value:m,defaultValue:c,onValueChange:o=()=>{},..._}=x,[p,h]=_e({prop:m,defaultProp:c??[],onChange:o,caller:Y}),r=L.useCallback(g=>h((d=[])=>[...d,g]),[h]),S=L.useCallback(g=>h((d=[])=>d.filter(f=>f!==g)),[h]);return e.jsx(Ye,{scope:x.__scopeToggleGroup,type:"multiple",value:p,onItemActivate:r,onItemDeactivate:S,children:e.jsx(Ue,{..._,ref:t})})});$e.displayName=Y;var[Pt,Ft]=qe(Y),Ue=L.forwardRef((x,t)=>{const{__scopeToggleGroup:m,disabled:c=!1,rovingFocus:o=!0,orientation:_,dir:p,loop:h=!0,...r}=x,S=Ke(m),g=lt(p),d={role:"group",dir:g,...r};return e.jsx(Pt,{scope:m,rovingFocus:o,disabled:c,children:o?e.jsx(it,{asChild:!0,...S,orientation:_,dir:g,loop:h,children:e.jsx(ue.div,{...d,ref:t})}):e.jsx(ue.div,{...d,ref:t})})}),de="ToggleGroupItem",Xe=L.forwardRef((x,t)=>{const m=We(de,x.__scopeToggleGroup),c=Ft(de,x.__scopeToggleGroup),o=Ke(x.__scopeToggleGroup),_=m.value.includes(x.value),p=c.disabled||x.disabled,h={...x,pressed:_,disabled:p},r=L.useRef(null);return c.rovingFocus?e.jsx(ot,{asChild:!0,...o,focusable:!p,active:_,ref:r,children:e.jsx(ze,{...h,ref:t})}):e.jsx(ze,{...h,ref:t})});Xe.displayName=de;var ze=L.forwardRef((x,t)=>{const{__scopeToggleGroup:m,value:c,...o}=x,_=We(de,m),p={role:"radio","aria-checked":x.pressed,"aria-pressed":void 0},h=_.type==="single"?p:void 0;return e.jsx(Te,{...h,...o,ref:t,onPressedChange:r=>{r?_.onItemActivate(c):_.onItemDeactivate(c)}})}),Qe=$e,Ze=Xe;const et=dt("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),Rt=N.forwardRef(({className:x,variant:t,size:m,...c},o)=>e.jsx(Je,{ref:o,className:ke(et({variant:t,size:m,className:x})),...c}));Rt.displayName=Je.displayName;const tt=N.createContext({size:"default",variant:"default"}),st=N.forwardRef(({className:x,variant:t,size:m,children:c,...o},_)=>e.jsx(Qe,{ref:_,className:ke("flex items-center justify-center gap-1",x),...o,children:e.jsx(tt.Provider,{value:{variant:t,size:m},children:c})}));st.displayName=Qe.displayName;const we=N.forwardRef(({className:x,children:t,variant:m,size:c,...o},_)=>{const p=N.useContext(tt);return e.jsx(Ze,{ref:_,className:ke(et({variant:p.variant||m,size:p.size||c}),x),...o,children:t})});we.displayName=Ze.displayName;const Et=({data:x,analysisType:t,medianDay:m,modeDay:c})=>{const o=(r,S)=>S==="frequency"?[`${r} occurrences`,"Frequency"]:[r,S],_=r=>r.toString(),p=t==="lows"?"#ef4444":"#22c55e",h=t==="lows"?"#dc2626":"#16a34a";return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-80",children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(Le,{data:x,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Se,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(De,{dataKey:"day",className:"fill-muted-foreground",tick:{fontSize:11},label:{value:"Day of Month",position:"insideBottom",offset:-10,style:{fontSize:"12px",fill:"hsl(var(--muted-foreground))"}}}),e.jsx(Me,{tickFormatter:_,className:"fill-muted-foreground",tick:{fontSize:11},label:{value:"Frequency (Number of Occurrences)",angle:-90,position:"insideLeft",style:{fontSize:"12px",fill:"hsl(var(--muted-foreground))"}}}),e.jsx(Ae,{formatter:o,contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},labelFormatter:r=>`Day ${r}`}),m>0&&e.jsx(Be,{x:m,stroke:"hsl(var(--primary))",strokeWidth:2,strokeDasharray:"5 5",label:{value:`Median (Day ${m})`,position:"top",style:{fontSize:"11px",fill:"hsl(var(--primary))",fontWeight:"bold"}}}),e.jsx(ne,{dataKey:"frequency",radius:[4,4,0,0],children:x.map((r,S)=>e.jsx(kt,{fill:r.day===c?h:p,opacity:r.day===c?1:.8},`cell-${S}`))})]})})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 pt-2 border-t border-border/30",children:[e.jsxs("p",{children:["• Each bar shows how many times stocks hit their monthly ",t==="lows"?"low":"high"," on that specific day"]}),e.jsxs("p",{children:["• ",e.jsx("span",{className:"font-semibold",children:"Darker bar"})," indicates the most common day (mode) = Day ",c]}),e.jsxs("p",{children:["• ",e.jsx("span",{className:"text-primary font-semibold",children:"Dashed line"})," shows the median day = Day ",m," (50% occur before this day)"]}),e.jsx("p",{children:"• Hover over bars for exact frequency counts"})]})]})},Ot=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],zt=({data:x,analysisType:t,selectedMonths:m})=>{const c=N.useMemo(()=>(m.length>0?x.filter(h=>m.includes(h.month)):x).map(h=>({month:Ot[h.month-1],monthNumber:h.month,"Days 1-7":Number(h.week1Pct.toFixed(1)),"Days 8-14":Number(h.week2Pct.toFixed(1)),"Days 15-21":Number(h.week3Pct.toFixed(1)),"Days 22-31":Number(h.week4Pct.toFixed(1)),week1Count:h.week1Count,week2Count:h.week2Count,week3Count:h.week3Count,week4Count:h.week4Count})),[x,m]),o=({active:p,payload:h,label:r})=>{if(p&&h&&h.length){const S=h.reduce((g,d)=>g+d.value,0);return e.jsxs("div",{style:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",padding:"12px"},children:[e.jsx("p",{className:"font-semibold mb-2",children:r}),h.reverse().map((g,d)=>e.jsxs("p",{style:{color:g.color},className:"text-sm",children:[g.name,": ",g.value.toFixed(1),"%",g.payload[`week${4-d}Count`]!==void 0&&e.jsxs("span",{className:"text-muted-foreground text-xs ml-2",children:["(",g.payload[`week${4-d}Count`]," occurrences)"]})]},d)),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t border-border/30",children:["Total: ",S.toFixed(1),"%"]})]})}return null},_=p=>`${p}%`;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-96",children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(Le,{data:c,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Se,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(De,{dataKey:"month",className:"fill-muted-foreground",tick:{fontSize:11},angle:-45,textAnchor:"end",height:80}),e.jsx(Me,{tickFormatter:_,className:"fill-muted-foreground",tick:{fontSize:11},label:{value:"Percentage of Occurrences",angle:-90,position:"insideLeft",style:{fontSize:"12px",fill:"hsl(var(--muted-foreground))"}},domain:[0,100]}),e.jsx(Ae,{content:e.jsx(o,{})}),e.jsx(He,{wrapperStyle:{paddingTop:"20px"},iconType:"square"}),e.jsx(ne,{dataKey:"Days 1-7",stackId:"a",fill:"#3b82f6",radius:[0,0,0,0]}),e.jsx(ne,{dataKey:"Days 8-14",stackId:"a",fill:"#f59e0b",radius:[0,0,0,0]}),e.jsx(ne,{dataKey:"Days 15-21",stackId:"a",fill:"#8b5cf6",radius:[0,0,0,0]}),e.jsx(ne,{dataKey:"Days 22-31",stackId:"a",fill:"#ec4899",radius:[4,4,0,0]})]})})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 pt-2 border-t border-border/30",children:[e.jsxs("p",{children:["• Bars are stacked to show the distribution of ",t==="lows"?"lows":"highs"," across weeks within each calendar month"]}),e.jsxs("p",{children:["• Each segment represents a week: ",e.jsx("span",{className:"font-semibold text-[#3b82f6]",children:"Days 1-7"}),", ",e.jsx("span",{className:"font-semibold text-[#f59e0b]",children:"Days 8-14"}),", ",e.jsx("span",{className:"font-semibold text-[#8b5cf6]",children:"Days 15-21"}),", ",e.jsx("span",{className:"font-semibold text-[#ec4899]",children:"Days 22-31"})]}),e.jsx("p",{children:"• Percentages sum to 100% for each month"}),e.jsx("p",{children:"• Hover over segments to see exact percentages and occurrence counts"}),e.jsxs("p",{className:"pt-1 font-medium",children:["Example insights: Large ",e.jsx("span",{className:"text-[#ec4899]",children:"pink"})," segments = late-month ",t,", large ",e.jsx("span",{className:"text-[#3b82f6]",children:"blue"})," segments = early-month ",t]})]})]})},Gt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],re=["Days 1-7","Days 8-14","Days 15-21","Days 22-31"],Vt=({data:x,analysisType:t,selectedMonths:m})=>{const c=N.useMemo(()=>m.length===0?x:x.filter(r=>m.includes(r.month)),[x,m]),o=N.useMemo(()=>{const r=[];if(c.forEach(d=>{r.push(d.week1Pct,d.week2Pct,d.week3Pct,d.week4Pct)}),r.length===0)return null;const S=r.sort((d,f)=>d-f),g=d=>{const f=Math.ceil(d*S.length/100)-1;return S[Math.max(0,Math.min(f,S.length-1))]};return{p20:g(20),p40:g(40),p60:g(60),p80:g(80)}},[c]),_=r=>o?r<=o.p20?"bg-gradient-to-br from-red-500 to-red-600":r<=o.p40?"bg-gradient-to-br from-orange-400 to-orange-500":r<=o.p60?"bg-gradient-to-br from-amber-400 to-amber-500":r<=o.p80?"bg-gradient-to-br from-emerald-400 to-emerald-500":"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-slate-100 dark:bg-slate-800",p=r=>r<5?"opacity-40":r<10?"opacity-70":"opacity-100",h=(r,S,g,d)=>`${r} - ${S}
${g.toFixed(1)}% of ${t}
${d} occurrences`;return c.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsx("p",{children:"No data available for the selected filters"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"w-full overflow-x-auto bg-background rounded-lg border shadow-sm",children:e.jsxs("div",{className:"min-w-[600px] p-6",children:[e.jsxs("div",{className:"flex mb-3 pb-2 border-b border-border/50",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-sm font-semibold text-foreground px-3 py-2",children:"Month"}),re.map((r,S)=>e.jsx("div",{className:"flex-1 text-sm font-semibold text-center px-2 py-2 text-foreground",children:r},S))]}),e.jsx("div",{className:"space-y-2",children:c.map(r=>{const S=Gt[r.month-1],g=r.week1Count+r.week2Count+r.week3Count+r.week4Count,d=[{pct:r.week1Pct,count:r.week1Count,label:re[0]},{pct:r.week2Pct,count:r.week2Count,label:re[1]},{pct:r.week3Pct,count:r.week3Count,label:re[2]},{pct:r.week4Pct,count:r.week4Count,label:re[3]}];return e.jsxs("div",{className:"flex items-center hover:bg-muted/5 rounded-lg transition-colors duration-200",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-sm font-medium px-3 py-2 text-foreground",children:S}),d.map((f,b)=>e.jsxs("div",{className:`
                        flex-1 h-12 mx-1 rounded-md flex items-center justify-center
                        text-xs font-semibold text-white cursor-help transition-all duration-200
                        hover:scale-105 hover:shadow-lg hover:z-10 relative border border-white/20
                        ${_(f.pct)}
                        ${p(g)}
                      `,title:h(S,f.label,f.pct,f.count),onTouchStart:i=>{const v=h(S,f.label,f.pct,f.count),C=document.createElement("div");C.className="fixed z-50 bg-black text-white text-xs p-2 rounded shadow-lg pointer-events-none whitespace-pre-line",C.textContent=v,C.style.top=`${i.touches[0].clientY-60}px`,C.style.left=`${i.touches[0].clientX-75}px`,document.body.appendChild(C),setTimeout(()=>{document.body.removeChild(C)},2e3)},children:[f.pct.toFixed(1),"%",g<5&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/20 rounded-md pointer-events-none"})]},b))]},r.month)})})]})}),e.jsxs("div",{className:"space-y-4 p-6 bg-gradient-to-r from-muted/5 to-muted/10 rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[e.jsxs("span",{className:"text-base font-semibold text-foreground",children:["Intensity Scale - Percentage of ",t==="lows"?"Lows":"Highs"]}),o&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"Lowest 20%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-orange-400 to-orange-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"20-40%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-amber-400 to-amber-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"40-60%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-emerald-400 to-emerald-500 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"60-80%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-md shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"Top 20%"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground pt-2 border-t border-border/30",children:[e.jsx("span",{className:"font-medium",children:"Data Reliability:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md opacity-40 shadow-sm"}),e.jsx("span",{children:"<5 months (limited data)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md opacity-70 shadow-sm"}),e.jsx("span",{children:"5-10 months (moderate)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-primary rounded-md shadow-sm"}),e.jsx("span",{children:"10+ months (reliable)"})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• Each cell shows what percentage of ",t," occurred in that week of that month"]}),e.jsxs("p",{children:["• ",e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:"Green cells"})," = high frequency (this week is common for ",t,")"]}),e.jsxs("p",{children:["• ",e.jsx("span",{className:"font-semibold text-red-600 dark:text-red-400",children:"Red cells"})," = low frequency (this week is rare for ",t,")"]}),e.jsx("p",{children:"• Hover over cells for exact percentages and occurrence counts"}),e.jsxs("p",{className:"pt-1 font-medium",children:['Example insight: If December shows high green in "Days 22-31", it means December ',t," tend to occur late in the month"]})]})]})},Ht=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Bt=({monthlyData:x,selectedMonths:t,selectedStock:m,minHistory:c})=>{const[o,_]=N.useState("lows"),[p,h]=N.useState("histogram"),r=b=>{if(b.length===0)return 0;const i=[...b].sort((C,k)=>C-k),v=Math.floor(i.length/2);return i.length%2===0?Math.round((i[v-1]+i[v])/2):i[v]},S=b=>{let i=0,v=1;return Object.entries(b).forEach(([C,k])=>{k>i&&(i=k,v=parseInt(C))}),{mode:v,frequency:i}},g=N.useMemo(()=>{let b=x.filter(l=>!(t.length>0&&!t.includes(l.month)||m&&l.name!==m));if(!m&&c>1){const l=b.reduce((s,u)=>(s[u.name]=(s[u.name]||0)+1,s),{});b=b.filter(s=>l[s.name]>=c)}if(b.length===0)return{dailyDistribution:[],periodDistribution:[{period:"early",dayRange:"1-10",percentage:0,count:0},{period:"mid",dayRange:"11-20",percentage:0,count:0},{period:"late",dayRange:"21-31",percentage:0,count:0}],weeklyDistribution:[],medianDay:0,modeDay:0,modeDayFrequency:0,totalRecords:0,earlyPct:0,midPct:0,latePct:0};const i=o==="lows"?"day_low_day_of_month":"day_high_day_of_month",v={},C=[];b.forEach(l=>{const s=l[i];s>=1&&s<=31&&(v[s]=(v[s]||0)+1,C.push(s))});const k=C.length,z=Array.from({length:31},(l,s)=>{const u=s+1,A=v[u]||0;return{day:u,frequency:A,percentage:k>0?A/k*100:0}}),B=b.filter(l=>l[i]>=1&&l[i]<=10).length,F=b.filter(l=>l[i]>=11&&l[i]<=20).length,M=b.filter(l=>l[i]>=21&&l[i]<=31).length,G=[{period:"early",dayRange:"1-10",percentage:k>0?B/k*100:0,count:B},{period:"mid",dayRange:"11-20",percentage:k>0?F/k*100:0,count:F},{period:"late",dayRange:"21-31",percentage:k>0?M/k*100:0,count:M}],y={};for(let l=1;l<=12;l++)y[l]={week1:0,week2:0,week3:0,week4:0};b.forEach(l=>{const s=l[i],u=l.month;y[u]&&(s>=1&&s<=7?y[u].week1++:s>=8&&s<=14?y[u].week2++:s>=15&&s<=21?y[u].week3++:s>=22&&s<=31&&y[u].week4++)});const a=[];for(let l=1;l<=12;l++){const s=y[l],u=s.week1+s.week2+s.week3+s.week4;a.push({month:l,week1Count:s.week1,week2Count:s.week2,week3Count:s.week3,week4Count:s.week4,week1Pct:u>0?s.week1/u*100:0,week2Pct:u>0?s.week2/u*100:0,week3Pct:u>0?s.week3/u*100:0,week4Pct:u>0?s.week4/u*100:0})}const w=r(C),{mode:n,frequency:j}=S(v);return{dailyDistribution:z,periodDistribution:G,weeklyDistribution:a,medianDay:w,modeDay:n,modeDayFrequency:j,totalRecords:k,earlyPct:G[0].percentage,midPct:G[1].percentage,latePct:G[2].percentage}},[x,t,m,c,o]),d=N.useMemo(()=>{const{modeDay:b,modeDayFrequency:i,totalRecords:v,earlyPct:C}=g;if(v===0)return"No data available for the selected filters";const k=v>0?(i/v*100).toFixed(1):"0",z=o==="lows"?"lows":"highs";return m?`${m} typically hits monthly ${z} on day ${b} (${k}% of months)`:`Across all stocks, ${C.toFixed(1)}% of ${z} occur in days 1-10, with day ${b} being most common (${k}%)`},[g,o,m]),f=({title:b,value:i,subtitle:v,icon:C})=>e.jsx(I,{className:"bg-gradient-to-br from-muted/20 to-muted/10 border-border/50",children:e.jsx(J,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:b}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:i}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:v})]}),C&&e.jsx("div",{className:"text-muted-foreground opacity-50",children:C})]})})});return g.totalRecords===0?e.jsxs(I,{children:[e.jsx(U,{children:e.jsx(X,{children:"Day-of-Month Analysis"})}),e.jsx(J,{children:e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsx("p",{children:"No data available for the selected filters. Try adjusting your month, stock, or minimum history filters."})})})]}):e.jsxs(I,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Day-of-Month Analysis"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Analyze when stocks typically hit their monthly ",o==="lows"?"lows":"highs"," during the month"]})]}),e.jsxs(J,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 p-6 bg-gradient-to-r from-muted/10 to-muted/20 rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Show:"}),e.jsxs(st,{type:"single",value:o,onValueChange:b=>b&&_(b),children:[e.jsx(we,{value:"lows",className:"px-4",children:"Low Days"}),e.jsx(we,{value:"highs",className:"px-4",children:"High Days"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{htmlFor:"chart-select",className:"text-sm font-medium",children:"Chart:"}),e.jsxs(Z,{value:p,onValueChange:b=>h(b),children:[e.jsx(ee,{id:"chart-select",className:"w-48 bg-background",children:e.jsx(te,{})}),e.jsxs(se,{className:"bg-background border shadow-lg z-50",children:[e.jsx(R,{value:"histogram",children:"Daily Distribution"}),e.jsx(R,{value:"period-comparison",children:"Period Comparison"}),e.jsx(R,{value:"heatmap",children:"Weekly Heatmap"})]})]})]})]}),e.jsx(I,{className:"bg-primary/5 border-primary/20",children:e.jsx(J,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[o==="lows"?e.jsx(Ct,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}):e.jsx(mt,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Key Pattern Detected"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d})]})]})})}),e.jsxs("div",{className:"mt-6",children:[p==="histogram"&&e.jsx(Et,{data:g.dailyDistribution,analysisType:o,medianDay:g.medianDay,modeDay:g.modeDay}),p==="period-comparison"&&e.jsx(zt,{data:g.weeklyDistribution,analysisType:o,selectedMonths:t}),p==="heatmap"&&e.jsx(Vt,{data:g.weeklyDistribution,analysisType:o,selectedMonths:t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsx(f,{title:`Median ${o==="lows"?"Low":"High"} Day`,value:`Day ${g.medianDay}`,subtitle:`50% of ${o} occur before this day`,icon:e.jsx(ie,{className:"h-5 w-5"})}),e.jsx(f,{title:`Most Common ${o==="lows"?"Low":"High"} Day`,value:`Day ${g.modeDay}`,subtitle:`${(g.modeDayFrequency/g.totalRecords*100).toFixed(1)}% of months`,icon:e.jsx(ie,{className:"h-5 w-5"})}),e.jsx(f,{title:"Early-Month Tendency",value:`${g.earlyPct.toFixed(1)}%`,subtitle:`${o==="lows"?"Lows":"Highs"} in days 1-10`,icon:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"text-xs text-muted-foreground pt-4 border-t border-border/30",children:e.jsxs("p",{children:["Analysis based on ",g.totalRecords," historical monthly records",t.length>0&&` for ${t.map(b=>Ht[b-1]).join(", ")}`,m&&` for ${m}`]})})]})]})},ae=new Date().getMonth()+1,le=["All Months","January","February","March","April","May","June","July","August","September","October","November","December"],os=()=>{xt("Monthly Analysis");const x=ut(),{monthlyData:t,monthlyStats:m,isLoading:c,error:o}=pt(),{allStockData:_}=gt(),[p,h]=N.useState([]),[r,S]=N.useState(""),[g,d]=N.useState(!1),[f,b]=N.useState(!1),[i,v]=N.useState([10]),[C,k]=N.useState(50),z=N.useMemo(()=>Array.from(new Set(m.map(a=>a.name))).sort(),[m]),{currentMonthPerformance:B,recentStocksSet:F}=N.useMemo(()=>{const y=new Map,a=new Set;if(_.length===0)return{currentMonthPerformance:y,recentStocksSet:a};const w=new Date,n=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}-01`,j=new Date(w);j.setDate(j.getDate()-30);const l=j.toISOString().slice(0,10),s=new Map;return _.forEach(u=>{s.has(u.name)||s.set(u.name,[]),s.get(u.name).push(u)}),s.forEach((u,A)=>{const E=[...u].sort((T,O)=>T.date.localeCompare(O.date)),D=E[E.length-1];if(D.date>=l&&a.add(A),D.date>=n){const T=E.filter(O=>O.date<n).pop();if(T){const O=(D.close-T.close)/T.close*100;y.set(A,O)}}}),{currentMonthPerformance:y,recentStocksSet:a}},[_]),M=N.useMemo(()=>{let y=m;return p.length>0&&(y=y.filter(a=>p.includes(a.month))),r&&(y=y.filter(a=>a.name===r)),y=y.filter(a=>a.number_of_months_available>=i[0]),y.slice(0,C)},[m,p,r,i,C]),G=N.useMemo(()=>{let y=m;return y=y.filter(a=>a.number_of_months_available>=i[0]),r&&(y=y.filter(a=>a.name===r)),F.size>0&&(y=y.filter(a=>F.has(a.name))),y},[m,r,i,F]);return N.useMemo(()=>{var n;if(M.length===0)return null;const y=M.reduce((j,l)=>j+l.pct_pos_return_months,0)/M.length,a=((n=[...M].sort((j,l)=>j.return_month_mean_pct_return_month-l.return_month_mean_pct_return_month)[Math.floor(M.length/2)])==null?void 0:n.return_month_mean_pct_return_month)||0,w=M.length;return{avgPosReturnMonths:y,medianReturn:a,stockCount:w}},[M]),c?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading monthly analysis data..."})]})}):o?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs(I,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(X,{className:"text-destructive",children:"Error Loading Data"})}),e.jsxs(J,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:o}),e.jsxs(P,{onClick:()=>x("/"),variant:"outline",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Back to Main Page"]})]})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"border-b bg-card",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(P,{onClick:()=>x("/"),variant:"ghost",size:"sm",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Back to Options"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Monthly Stock Analysis"}),e.jsx("p",{className:"text-muted-foreground",children:"Historical seasonal patterns and performance metrics"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:p.length===0?"All Months":p.length===1?le[p[0]]:`${p.length} months selected`})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs(I,{children:[e.jsx(U,{children:e.jsx(X,{children:"Filters & Controls"})}),e.jsx(J,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Months"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(xe,{open:f,onOpenChange:b,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(P,{variant:"outline",role:"combobox","aria-expanded":f,className:"flex-1 justify-between",children:[p.length===0?"All months...":p.length===1?le[p[0]]:`${p.length} months selected`,e.jsx(ge,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(fe,{className:"w-full p-0",align:"start",children:e.jsxs(je,{children:[e.jsx(be,{placeholder:"Search months..."}),e.jsxs(ve,{children:[e.jsx(ye,{children:"No month found."}),e.jsxs(Ne,{children:[e.jsxs(Q,{onSelect:()=>{h([])},children:[e.jsx(Pe,{checked:p.length===0,className:"mr-2"}),"All months"]}),le.slice(1).map((y,a)=>{const w=a+1,n=p.includes(w);return e.jsxs(Q,{onSelect:()=>{h(n?j=>j.filter(l=>l!==w):j=>[...j,w])},children:[e.jsx(Pe,{checked:n,className:"mr-2"}),y]},w)})]})]})]})})]}),e.jsx(P,{variant:p.length===1&&p[0]===ae?"default":"outline",size:"sm",onClick:()=>h(y=>y.length===1&&y[0]===ae?[]:[ae]),title:"Filter to current month",children:le[ae]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Select Stock"}),e.jsxs(xe,{open:g,onOpenChange:d,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(P,{variant:"outline",role:"combobox","aria-expanded":g,className:"w-full justify-between",children:[r||"All stocks...",e.jsx(ge,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(fe,{className:"w-full p-0",align:"start",children:e.jsxs(je,{children:[e.jsx(be,{placeholder:"Search stocks..."}),e.jsxs(ve,{children:[e.jsx(ye,{children:"No stock found."}),e.jsxs(Ne,{children:[e.jsxs(Q,{value:"",onSelect:()=>{S(""),d(!1)},children:[e.jsx(ce,{className:`mr-2 h-4 w-4 ${r===""?"opacity-100":"opacity-0"}`}),"All stocks"]}),z.map(y=>e.jsxs(Q,{value:y,onSelect:a=>{S(a===r?"":a),d(!1)},children:[e.jsx(ce,{className:`mr-2 h-4 w-4 ${r===y?"opacity-100":"opacity-0"}`}),y]},y))]})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(H,{children:["Min History (months): ",i[0]]}),e.jsx(ht,{value:i,onValueChange:v,min:1,max:50,step:1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Show Top N Stocks"}),e.jsxs(Z,{value:C.toString(),onValueChange:y=>k(parseInt(y)),children:[e.jsx(ee,{children:e.jsx(te,{})}),e.jsxs(se,{children:[e.jsx(R,{value:"10",children:"Top 10"}),e.jsx(R,{value:"25",children:"Top 25"}),e.jsx(R,{value:"50",children:"Top 50"}),e.jsx(R,{value:"100",children:"Top 100"}),e.jsx(R,{value:"200",children:"Top 200"})]})]})]})]})})]}),e.jsxs(I,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Monthly Seasonality Heatmap"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Percentage of positive return months by stock and calendar month"})]}),e.jsx(J,{children:e.jsx(St,{data:G,selectedMonths:p,currentMonth:ae,currentMonthPerformance:B})})]}),e.jsxs(I,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Timeline Performance Chart"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Historical monthly returns over time - analyze when good/bad months occurred"})]}),e.jsx(J,{children:e.jsx(At,{data:t,selectedStock:r})})]}),e.jsx(Bt,{monthlyData:t,selectedMonths:p,selectedStock:r,minHistory:i[0]}),e.jsxs(I,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Detailed Statistics Table"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Complete monthly performance metrics for all stocks"})]}),e.jsx(J,{children:e.jsx(Mt,{data:m})})]})]})]})};export{os as MonthlyAnalysis};
