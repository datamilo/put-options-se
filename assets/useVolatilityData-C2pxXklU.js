import{r as u}from"./router-C0wDHNfv.js";import{P as B}from"./csv-B1Pu-2A6.js";const O=()=>{const[k,M]=u.useState([]),[N,V]=u.useState([]),[C,m]=u.useState(!0),[D,y]=u.useState(null),v=async()=>{try{m(!0),y(null),console.log("ðŸ” Attempting to load volatility event data...");const l=["https://raw.githubusercontent.com/datamilo/put-options-se/main/data/Stock_Events_Volatility_Data.csv","/data/Stock_Events_Volatility_Data.csv"];let i="",d="";for(const t of l)try{console.log(`ðŸŒ Trying to fetch from: ${t}`);const n=t.includes("github")?`${t}?${Date.now()}`:t,r=await fetch(n);if(console.log(`ðŸ“¨ Response status: ${r.status} for ${t}`),r.ok){i=await r.text(),d=t,console.log(`âœ… Successfully loaded from: ${t}`),console.log(`ðŸ“„ CSV length: ${i.length} characters`);break}else console.log(`âŒ Failed to load from ${t}: ${r.status} ${r.statusText}`)}catch(n){console.warn(`âŒ Failed to fetch from ${t}:`,n)}if(!i)throw new Error("Could not load volatility event data from GitHub or local source. Please check if the file exists and is accessible.");const s=B.parse(i,{header:!0,skipEmptyLines:!0,delimiter:"|",transform:(t,n)=>["year","month"].includes(n)?parseInt(t)||0:["event_value","open","high","low","close","volume","volume_pct_change_from_previous_day","close_price_pct_change_from_previous_day","intraday_high_low_price_diff","pct_intraday_high_low_movement","pct_intraday_open_close_movement"].includes(n)?parseFloat(t)||0:t});s.errors.length>0&&console.warn("ðŸ“ CSV parsing warnings:",s.errors);const a=s.data.filter(t=>t.name&&t.date);console.log(`ðŸ“Š Parsed ${a.length} volatility records`),console.log("ðŸ“Š Sample records:",a.slice(0,3)),M(a);const o=x(a);console.log(`ðŸ“ˆ Calculated stats for ${o.length} stocks`),V(o)}catch(l){console.error("âŒ Error loading volatility data:",l),y(l instanceof Error?l.message:"Unknown error occurred")}finally{m(!1)}},x=l=>{const i=l.reduce((s,a)=>{const o=a.name;return s[o]||(s[o]=[]),s[o].push(a),s},{}),d=[];for(const[s,a]of Object.entries(i)){const o=a.map(e=>e.close_price_pct_change_from_previous_day).filter(e=>!isNaN(e));if(o.length===0)continue;const t=o.length,n=o.reduce((e,c)=>e+c,0)/t,r=[...o].sort((e,c)=>e-c),E=t%2===0?(r[t/2-1]+r[t/2])/2:r[Math.floor(t/2)],P=o.reduce((e,c)=>e+Math.pow(c-n,2),0)/t,w=Math.sqrt(P),S=Math.min(...o),$=Math.max(...o),_=a.find(e=>e.close_price_pct_change_from_previous_day===S),h=a.find(e=>e.close_price_pct_change_from_previous_day===$),F=t>0?r[Math.floor(t*.05)]:NaN,L=t>0?r[Math.floor(t*.95)]:NaN,T=o.reduce((e,c)=>e+Math.abs(c),0)/t,b=o.filter(e=>e<0).length,q=b/t,g=w/Math.sqrt(t),A=n-1.96*g,I=n+1.96*g,p=a.map(e=>e.volume_pct_change_from_previous_day).filter(e=>!isNaN(e)),U=p.length>0?p.reduce((e,c)=>e+c,0)/p.length:0,f=a.map(e=>Math.abs(e.pct_intraday_high_low_movement)).filter(e=>!isNaN(e)),j=f.length>0?f.reduce((e,c)=>e+c,0)/f.length:0;d.push({name:s,count:t,mean_change:n,median_change:E,std_dev:w,min_change:S,max_change:$,p05:F,p95:L,mean_abs_change:T,negative_count:b,negative_rate:q,se_mean:g,ci95_low:A,ci95_high:I,avg_volume_pct_change:U,avg_intraday_spread_pct:j,min_event_type:(_==null?void 0:_.type_of_event)||"",min_event_date:(_==null?void 0:_.date)||"",max_event_type:(h==null?void 0:h.type_of_event)||"",max_event_date:(h==null?void 0:h.date)||""})}return d.sort((s,a)=>a.mean_abs_change-s.mean_abs_change)};return u.useEffect(()=>{v()},[]),{volatilityData:k,volatilityStats:N,isLoading:C,error:D,loadVolatilityData:v}};export{O as u};
