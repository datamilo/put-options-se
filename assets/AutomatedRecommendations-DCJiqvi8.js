import{c as Le,j as e,L as W,I as Oe,B as I,ah as _e,C as le,y as Ee,P as ce,ai as We,z as Ie,W as He,X as Ve,aj as Ue,G as qe,ak as Ke,Q as Ge,v as Je,U as Ye,K as Xe}from"./index-BVw2Pzxv.js";import{r as f,R as De}from"./router-C0wDHNfv.js";import{u as Ze}from"./usePageTitle-CpPgFbZv.js";import{u as Ce}from"./useEnrichedOptionsData-QELhI0Ua.js";import{u as Qe}from"./useSupportLevelMetrics-DrzEGGKY.js";import{u as et}from"./useProbabilityHistory-CJabXNgn.js";import{u as tt}from"./useProbabilityRecoveryData-5JhFCbWq.js";import{u as at}from"./useMonthlyStockData-CuShNDzV.js";import{u as rt}from"./useStockData-BWzV3G2_.js";import{C as $,a as A,b as B,c as R}from"./card-Dh7Q_ijz.js";import{u as ne,w as st,D as it}from"./xlsx-C1AHQ_Pv.js";import{S as Z,a as Q,b as ee,c as te,d as D,C as ot}from"./select-CzhzUq9X.js";import{T as nt,a as lt,b as ae,c as Pe,d as ct,e as N}from"./table-W_lzODQg.js";import{S as dt,a as ht}from"./scroll-area-iYhE9Q-7.js";import{C as ut}from"./circle-alert-Il3saIWk.js";import{C as mt}from"./circle-x-DjjK3YLa.js";import{I as pt}from"./info-CIZJMKHd.js";import{A as xt,a as yt}from"./arrow-up-sGc0pOJ_.js";import{R as gt}from"./rotate-ccw-DglO4_aN.js";import{C as bt}from"./chart-column-CueXmNrU.js";import"./charts-B8eVsusH.js";import"./csv-B1Pu-2A6.js";import"./index-BAMY2Nnw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=Le("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),vt=t=>t<.5?"<50%":t<.6?"50-60%":t<.7?"60-70%":t<.8?"70-80%":t<.9?"80-90%":"90%+",kt=t=>t<=7?"0-7":t<=14?"8-14":t<=21?"15-21":t<=28?"22-28":t<=35?"29-35":"36+",jt=t=>({ProbWorthless_Bayesian_IsoCal:"Bayesian Calibrated","1_2_3_ProbOfWorthless_Weighted":"Weighted Average","1_ProbOfWorthless_Original":"Original Black-Scholes","2_ProbOfWorthless_Calibrated":"Bias Corrected","3_ProbOfWorthless_Historical_IV":"Historical IV"})[t]||t,wt=t=>t===null?{normalized:0,hasData:!1,dataStatus:"unavailable"}:{normalized:Math.min(100,Math.max(0,t)),hasData:!0,dataStatus:"available"},St=(t,o)=>{if(t===null)return{normalized:0,hasData:!1,dataStatus:"unavailable"};const m=t/(o||30);return{normalized:Math.min(100,Math.max(0,m*50)),hasData:!0,dataStatus:"available"}},Pt=t=>t===null?{normalized:0,hasData:!1,dataStatus:"unavailable"}:{normalized:Math.min(100,Math.max(0,t*100)),hasData:!0,dataStatus:"available"},Nt=(t,o,h,m)=>{if(m===0)return{normalized:0,hasData:!1,dataStatus:"unavailable"};if(o===null)return{normalized:0,hasData:!1,dataStatus:"unavailable"};if(o<h)return{normalized:30,hasData:!0,dataStatus:"available"};const c=o-t;return{normalized:Math.min(100,50+c*200),hasData:!0,dataStatus:"available"}},_t=(t,o,h)=>{if(t===null)return{normalized:0,hasData:!1,dataStatus:"unavailable"};let m=t;return h!==null&&Math.abs(o-h)<=3&&(m+=10),{normalized:Math.min(100,m),hasData:!0,dataStatus:"available"}},Dt=(t,o)=>{if(t===null||o===null)return{normalized:0,hasData:!1,dataStatus:"unavailable"};const h=o-t;return{normalized:Math.min(100,Math.max(0,50+h*10)),hasData:!0,dataStatus:"available"}},Ct=t=>!t||!t.day_low_day_of_month?null:t.day_low_day_of_month||null,Mt=()=>{const{data:t,isLoading:o}=Ce(),{data:h,isLoading:m,getMetricsForStock:c}=Qe(),{allData:d,isLoading:s}=et(),{chartData:n,isLoading:l}=tt(),{monthlyStats:y,isLoading:v}=at(),{getStockSummary:u,isLoading:i}=rt(),w=o||m||s||l||v||i,r=f.useMemo(()=>{const p=new Map,x=new Date().getMonth()+1;return y&&Array.isArray(y)&&y.filter(b=>b.month===x).forEach(b=>p.set(b.name,b)),p},[y]);return{analyzeOptions:f.useCallback((p,x)=>{if(!t||t.length===0)return[];if(!h||h.length===0)return[];const b=new Date().getDate(),C=[],T=new Map;return d&&Array.isArray(d)&&d.forEach(j=>{const k=j.OptionName,S=T.get(k),M=j[p.probabilityMethod];M&&typeof M=="number"&&(!S||M>S)&&T.set(k,M)}),t.filter(j=>{if(p.expiryDate&&j.ExpiryDate!==p.expiryDate)return!1;const k=c(j.StockName,p.rollingPeriod);return!(!k||k.rolling_low&&j.StrikePrice>k.rolling_low||k.days_since_last_break!==null&&k.days_since_last_break<p.minDaysSinceBreak)}).forEach((j,k)=>{var ye,ge,be,fe,ve,ke,je,we,Se;const S=c(j.StockName,p.rollingPeriod);if(!S)return;const M=Math.floor((new Date(j.ExpiryDate).getTime()-new Date().getTime())/(1e3*60*60*24)),L=j[p.probabilityMethod]||0;if(typeof L!="number")return;const g=T.get(j.OptionName)||null;!g&&k===0&&(console.warn(`‚ö†Ô∏è Probability peaks map has ${T.size} entries`),T.size===0&&console.warn("‚ö†Ô∏è probabilityPeaksMap is empty - probability history may not have loaded"));const P=vt(L),z=kt(M);let O=null;try{const F=p.historicalPeakThreshold.toFixed(2),H=jt(p.probabilityMethod);if(k===0)if(console.log("üîç Recovery data structure keys:",Object.keys(n)),console.log("üìä Looking for threshold:",F),console.log("üîë Probability method (field):",p.probabilityMethod),console.log("üîÑ Mapped method (recovery):",H),n[F]){console.log("‚úÖ Threshold found! Methods:",Object.keys(n[F]));const X=(ye=n[F])==null?void 0:ye[H];console.log("üîé Method data:",X?`Found ${Object.keys(X).length} prob bins`:"NOT found"),X&&console.log("üìä Available prob bins:",Object.keys(X))}else console.warn("‚ö†Ô∏è Threshold NOT found:",F);const V=(fe=(be=(ge=n[F])==null?void 0:ge[H])==null?void 0:be[P])==null?void 0:fe[z];k<3&&(console.log(`üîç Looking for: ${j.OptionName} - Prob: ${P} (current: ${(L*100).toFixed(1)}%), DTE: ${z} (days: ${M})`),(ke=(ve=n[F])==null?void 0:ve[H])!=null&&ke[P]?(Se=(we=(je=n[F])==null?void 0:je[H])==null?void 0:we[P])!=null&&Se[z]||console.warn(`‚ö†Ô∏è DTE bin '${z}' not found for prob bin '${P}'`):console.warn(`‚ö†Ô∏è Prob bin '${P}' not found in recovery data`)),V&&(console.log(`üéØ Found recovery point for ${j.OptionName}: ${P} / ${z}`,V),V.recovery_candidate_rate!==void 0&&V.recovery_candidate_rate!==null&&(O=V.recovery_candidate_rate))}catch(F){console.warn("Error looking up recovery data:",F)}const _=r.get(j.StockName),se=(_==null?void 0:_.pct_pos_return_months)||null,pe=(_==null?void 0:_.return_month_mean_pct_return_month)||null,xe=Ct(_),Fe=(_==null?void 0:_.number_of_months_available)||null,Ae=(_==null?void 0:_.open_to_low_max_pct_return_month)||null,ie=u(j.StockName),oe=(ie==null?void 0:ie.priceChangePercentMonth)||null,U=wt(S.support_strength_score),q=St(S.days_since_last_break,S.trading_days_per_break),K=Pt(O),G=Nt(L,g,p.historicalPeakThreshold,x.historicalPeak),J=_t(se,b,xe),Y=Dt(oe,pe),E={supportStrength:{raw:S.support_strength_score,normalized:U.normalized,weighted:U.normalized*(x.supportStrength/100),hasData:U.hasData,dataStatus:U.dataStatus},daysSinceBreak:{raw:S.days_since_last_break,normalized:q.normalized,weighted:q.normalized*(x.daysSinceBreak/100),hasData:q.hasData,dataStatus:q.dataStatus},recoveryAdvantage:{raw:O,normalized:K.normalized,weighted:K.normalized*(x.recoveryAdvantage/100),hasData:K.hasData,dataStatus:K.dataStatus},historicalPeak:{raw:g,normalized:G.normalized,weighted:G.normalized*(x.historicalPeak/100),hasData:G.hasData,dataStatus:G.dataStatus},monthlySeasonality:{raw:se,normalized:J.normalized,weighted:J.normalized*(x.monthlySeasonality/100),hasData:J.hasData,dataStatus:J.dataStatus},currentPerformance:{raw:oe,normalized:Y.normalized,weighted:Y.normalized*(x.currentPerformance/100),hasData:Y.hasData,dataStatus:Y.dataStatus}},Be=E.supportStrength.weighted+E.daysSinceBreak.weighted+E.recoveryAdvantage.weighted+E.historicalPeak.weighted+E.monthlySeasonality.weighted+E.currentPerformance.weighted,ze=S.current_price>0&&S.rolling_low?(S.rolling_low-S.current_price)/S.current_price*100:null;C.push({rank:0,optionName:j.OptionName,stockName:j.StockName,strikePrice:j.StrikePrice,currentPrice:S.current_price,expiryDate:j.ExpiryDate,daysToExpiry:M,premium:j.Premium||0,rollingLow:S.rolling_low,distanceToSupportPct:ze,daysSinceLastBreak:S.days_since_last_break,supportStrengthScore:S.support_strength_score,patternType:S.pattern_type,currentProbability:L,historicalPeakProbability:g,recoveryAdvantage:O,currentProbBin:P,dteBin:z,monthlyPositiveRate:se,monthlyAvgReturn:pe,typicalLowDay:xe,currentMonthPerformance:oe,monthsInHistoricalData:Fe,worstMonthDrawdown:Ae,financialReport:j.FinancialReport||null,xDay:j["X-Day"]||null,compositeScore:Be,scoreBreakdown:E})}),C.sort((j,k)=>k.compositeScore-j.compositeScore),C.map((j,k)=>({...j,rank:k+1}))},[t,h,c,d,r,n,u]),isLoading:w}},$t=({filename:t,data:o})=>{const h=r=>r.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^\w/,a=>a.toUpperCase()).replace(/\b\w/g,a=>a.toUpperCase()),m=r=>{const a={rank:r.rank,optionName:r.optionName,stockName:r.stockName,strikePrice:r.strikePrice,currentPrice:r.currentPrice,expiryDate:r.expiryDate,daysToExpiry:r.daysToExpiry,premium:r.premium,rollingLow:r.rollingLow,distanceToSupportPct:r.distanceToSupportPct,daysSinceLastBreak:r.daysSinceLastBreak,supportStrengthScore:r.supportStrengthScore,patternType:r.patternType,currentProbability:r.currentProbability,historicalPeakProbability:r.historicalPeakProbability,recoveryAdvantage:r.recoveryAdvantage,currentProbBin:r.currentProbBin,dteBin:r.dteBin,monthlyPositiveRate:r.monthlyPositiveRate,monthlyAvgReturn:r.monthlyAvgReturn,typicalLowDay:r.typicalLowDay,currentMonthPerformance:r.currentMonthPerformance,monthsInHistoricalData:r.monthsInHistoricalData,worstMonthDrawdown:r.worstMonthDrawdown,financialReport:r.financialReport,xDay:r.xDay,compositeScore:r.compositeScore},p=["supportStrength","daysSinceBreak","recoveryAdvantage","historicalPeak","monthlySeasonality","currentPerformance"];for(const x of p){const b=r.scoreBreakdown[x];a[`${x}_raw`]=b.raw,a[`${x}_normalized`]=b.normalized,a[`${x}_weighted`]=b.weighted,a[`${x}_hasData`]=b.hasData?"Yes":"No"}return a},c=["rank","optionName","stockName","strikePrice","currentPrice","expiryDate","daysToExpiry","premium","rollingLow","distanceToSupportPct","daysSinceLastBreak","supportStrengthScore","patternType","currentProbability","historicalPeakProbability","recoveryAdvantage","currentProbBin","dteBin","monthlyPositiveRate","monthlyAvgReturn","typicalLowDay","currentMonthPerformance","monthsInHistoricalData","worstMonthDrawdown","financialReport","xDay","compositeScore"],d=["supportStrength_raw","supportStrength_normalized","supportStrength_weighted","supportStrength_hasData","daysSinceBreak_raw","daysSinceBreak_normalized","daysSinceBreak_weighted","daysSinceBreak_hasData","recoveryAdvantage_raw","recoveryAdvantage_normalized","recoveryAdvantage_weighted","recoveryAdvantage_hasData","historicalPeak_raw","historicalPeak_normalized","historicalPeak_weighted","historicalPeak_hasData","monthlySeasonality_raw","monthlySeasonality_normalized","monthlySeasonality_weighted","monthlySeasonality_hasData","currentPerformance_raw","currentPerformance_normalized","currentPerformance_weighted","currentPerformance_hasData"],s=[...c,...d],n=(r,a)=>r==null||Number.isNaN(r)?null:typeof r=="boolean"?r?"Yes":"No":typeof r=="number"?a==="Distance To Support Pct"?parseFloat(r.toFixed(1)):a==="Current Probability"||a==="Historical Peak Probability"?parseFloat(r.toFixed(3)):a.includes("Probability")||a==="Recovery Rate %"?parseFloat((r*100).toFixed(1)):a==="Monthly Positive Rate"?parseFloat(r.toFixed(1)):a==="Current Month Performance"?parseFloat(r.toFixed(2)):a==="Support Strength Score"?Math.round(r):a.includes("_raw")&&r>=0&&r<=1?parseFloat((r*100).toFixed(2)):a.includes("_normalized")||a.includes("_weighted")||a.includes("Price")||a.includes("Strike")||a==="Rolling Low"||!Number.isInteger(r)?parseFloat(r.toFixed(2)):r:String(r),l=[s.map(r=>h(r)),...o.map(r=>{const a=m(r);return s.map(p=>n(a[p],h(p)))})],y=ne.book_new(),v=ne.aoa_to_sheet(l),u=s.map(r=>{const a=h(r),p=Math.max(a.length,...o.map(x=>{const C=m(x)[r];return String(C||"").length}));return{wch:Math.min(Math.max(p+2,10),50)}});v["!cols"]=u,ne.book_append_sheet(y,v,"Recommendations");const i=new Date().toISOString().split("T")[0],w=`${t}_${i}.xlsx`;st(y,w)},Rt=({filters:t,onFiltersChange:o,onAnalyze:h,availableExpiryDates:m,isAnalyzing:c})=>{const d=(s,n)=>{o({...t,[s]:n})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"expiry-date",children:"Expiry Date"}),e.jsxs(Z,{value:t.expiryDate,onValueChange:s=>d("expiryDate",s),children:[e.jsx(Q,{id:"expiry-date",children:e.jsx(ee,{placeholder:"Select expiry date"})}),e.jsx(te,{children:m.map(s=>e.jsx(D,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"rolling-period",children:"Rolling Low Period"}),e.jsxs(Z,{value:t.rollingPeriod.toString(),onValueChange:s=>d("rollingPeriod",parseInt(s)),children:[e.jsx(Q,{id:"rolling-period",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(D,{value:"30",children:"30 days (1-Month)"}),e.jsx(D,{value:"90",children:"90 days (3-Month)"}),e.jsx(D,{value:"180",children:"180 days (6-Month)"}),e.jsx(D,{value:"270",children:"270 days (9-Month)"}),e.jsx(D,{value:"365",children:"365 days (1-Year)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"min-days-since-break",children:"Min Days Since Last Break (business days)"}),e.jsx(Oe,{id:"min-days-since-break",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t.minDaysSinceBreak,onChange:s=>{const n=s.target.value.trim();if(n===""){d("minDaysSinceBreak",0);return}if(!/^\d+$/.test(n))return;const l=parseInt(n,10);!isNaN(l)&&l>=0&&d("minDaysSinceBreak",l)}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"prob-method",children:"Probability Method"}),e.jsxs(Z,{value:t.probabilityMethod,onValueChange:s=>d("probabilityMethod",s),children:[e.jsx(Q,{id:"prob-method",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(D,{value:"ProbWorthless_Bayesian_IsoCal",children:"PoW - Bayesian Calibrated"}),e.jsx(D,{value:"1_2_3_ProbOfWorthless_Weighted",children:"PoW - Weighted Average"}),e.jsx(D,{value:"1_ProbOfWorthless_Original",children:"PoW - Original Black-Scholes"}),e.jsx(D,{value:"2_ProbOfWorthless_Calibrated",children:"PoW - Bias Corrected"}),e.jsx(D,{value:"3_ProbOfWorthless_Historical_IV",children:"PoW - Historical IV"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"peak-threshold",children:"Historical Peak Threshold"}),e.jsxs(Z,{value:t.historicalPeakThreshold.toFixed(2),onValueChange:s=>d("historicalPeakThreshold",parseFloat(s)),children:[e.jsx(Q,{id:"peak-threshold",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(D,{value:"0.80",children:"80%"}),e.jsx(D,{value:"0.90",children:"90%"}),e.jsx(D,{value:"0.95",children:"95%"})]})]})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsxs(I,{onClick:h,disabled:c||!t.expiryDate,className:"w-full",size:"lg",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),c?"Analyzing...":"Analyze"]})})]})]})},Tt={supportStrength:{label:"Support reliability score",explanation:"Composite metric (0-100) measuring how consistently support level has held based on stability, break frequency, and drop consistency"},daysSinceBreak:{label:"Days since support break",explanation:"Number of trading days since support level was last tested/broken; higher is better"},recoveryAdvantage:{label:"Recovery candidate rate",explanation:"Percentage of similar options (by probability/DTE) that recovered from similar levels in historical data"},historicalPeak:{label:"Historical peak probability",explanation:"Highest probability of worthlessness ever seen for this option; indicates recovery potential if peaked above current threshold"},monthlySeasonality:{label:"Monthly positive rate",explanation:"Percentage of historical months with positive returns for this stock in the current calendar month"},currentPerformance:{label:"Month-to-date underperformance",explanation:"How much the stock is underperforming (negative = better for puts) compared to its historical average for this calendar month"}},Ft=({breakdown:t,compositeScore:o,weights:h})=>{const m=[{name:"Recovery Advantage",key:"recoveryAdvantage",weightKey:"recoveryAdvantage",description:"Historical worthless rate for similar recovery candidates"},{name:"Support Strength",key:"supportStrength",weightKey:"supportStrength",description:"Pre-calculated composite support level robustness"},{name:"Days Since Break",key:"daysSinceBreak",weightKey:"daysSinceBreak",description:"Time since support level was last broken"},{name:"Historical Peak",key:"historicalPeak",weightKey:"historicalPeak",description:"Recovery candidate based on historical probability peaks"},{name:"Monthly Seasonality",key:"monthlySeasonality",weightKey:"monthlySeasonality",description:"Historical positive return rate for current month"},{name:"Current Performance",key:"currentPerformance",weightKey:"currentPerformance",description:"Current month underperformance vs historical average"}],c=s=>s===null?"N/A":s>=0&&s<=1?`${(s*100).toFixed(1)}%`:s>=-100&&s<=100?`${s.toFixed(1)}`:s.toFixed(0),d=m.filter(s=>t[s.key].hasData).length;return e.jsxs($,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(B,{className:"text-lg",children:"Score Breakdown"}),d<6&&e.jsxs("div",{className:"text-xs font-semibold text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-950 px-2 py-1 rounded",children:["Based on ",d,"/6 factors with data"]})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-primary/10 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-lg",children:"Composite Score"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:o.toFixed(1)})]}),e.jsx("div",{className:"space-y-4",children:m.map(s=>{const n=t[s.key],l=h[s.weightKey],y=c(n.raw),v=n.normalized,u=n.weighted,i=l===0,w=n.hasData;n.dataStatus;const r=Tt[s.key];return e.jsxs("div",{className:`space-y-2 p-3 rounded-lg transition-colors ${i?"bg-muted/40 border border-dashed border-muted-foreground/30":w?"bg-transparent":"bg-destructive/5 border border-destructive/20"}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.name}),i&&e.jsxs("div",{className:"flex items-center gap-1 bg-destructive/10 text-destructive px-2 py-0.5 rounded text-xs font-semibold",children:[e.jsx(ut,{className:"h-3 w-3"}),"Not Included"]}),!i&&!w&&e.jsxs("div",{className:"flex items-center gap-1 bg-red-100 dark:bg-red-950 text-red-700 dark:text-red-400 px-2 py-0.5 rounded text-xs font-semibold",children:[e.jsx(mt,{className:"h-3 w-3"}),"No Data"]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[u.toFixed(1)," pts"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[l.toFixed(0),"% weight"]})]})]}),!i&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/30 p-2 rounded",children:[e.jsxs("div",{className:"font-semibold text-foreground mb-1",children:[r==null?void 0:r.label,":"]}),e.jsx("div",{children:r==null?void 0:r.explanation}),e.jsxs("div",{className:"mt-2 font-semibold",children:["Raw value: ",w?y:"Not Available"]})]}),!i&&!w&&e.jsxs("div",{className:"text-xs text-destructive font-semibold bg-destructive/10 p-2 rounded",children:["‚ö†Ô∏è No data available for this stock. Score contribution: ",e.jsx("strong",{children:"0 points"})," (not included)"]}),e.jsx("div",{className:`w-full bg-secondary rounded-full h-2 ${i||!w?"opacity-40":""}`,children:e.jsx("div",{className:`h-2 rounded-full transition-all ${i||!w?"bg-muted-foreground":"bg-primary"}`,style:{width:`${v}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Normalized: ",v.toFixed(1),"/100"]}),e.jsxs("span",{children:["Contributing: ",w||i?"Yes":"No (missing data)"]})]})]},s.key)})}),e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg text-xs text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"How Scoring Works:"})," Each factor is normalized to a 0-100 scale, then weighted according to its importance. Only factors with available data contribute to the final score."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Missing Data:"})," If a factor has no historical data for this stock, it contributes 0 points to the composite score, regardless of its weight setting."]}),e.jsxs("p",{children:[e.jsx("strong",{children:'Red "No Data" badge:'})," This stock lacks the historical data needed for this factor, so it contributes 0 points."]})]})]})]})},At=({option:t,filters:o})=>{const m=(n=>({ProbWorthless_Bayesian_IsoCal:"PoW - Bayesian Calibrated","1_2_3_ProbOfWorthless_Weighted":"PoW - Weighted Average","1_ProbOfWorthless_Original":"PoW - Original Black-Scholes","2_ProbOfWorthless_Calibrated":"PoW - Bias Corrected","3_ProbOfWorthless_Historical_IV":"PoW - Historical IV"})[n]||n)(o.probabilityMethod),c=o.rollingPeriod===365?"1 year":`${o.rollingPeriod} days`,d=[];if(d.push(`This analysis explains why ${t.optionName} (${t.stockName}) has been recommended based on multiple factors.`),t.rollingLow!==null&&t.distanceToSupportPct!==null){const n=t.strikePrice<=t.rollingLow?"below":"above",l=t.currentPrice<=t.rollingLow?"below":"above";d.push(`**Support Level Discovery:** The option has a strike price of ${t.strikePrice.toFixed(2)} kr, which is ${n} the ${c} rolling low support level of ${t.rollingLow.toFixed(2)} kr. The current price (${t.currentPrice.toFixed(2)} kr) is ${Math.abs(t.distanceToSupportPct).toFixed(1)}% ${l} the rolling low. This ${c} low can act as a strong support level for the stock.`)}if(t.daysSinceLastBreak!==null&&t.supportStrengthScore!==null){const n=t.supportStrengthScore>=70?"strong":t.supportStrengthScore>=50?"moderate":"weak",l=t.supportStrengthScore>=70?"historically held reliably with few breaks":t.supportStrengthScore>=50?"held reasonably well with occasional breaks":"broken frequently or inconsistently";d.push(`**Support Robustness:** The support level has not been broken for ${t.daysSinceLastBreak} days, which is ${t.daysSinceLastBreak>=o.minDaysSinceBreak?"above":"below"} the minimum threshold of ${o.minDaysSinceBreak} days. The support strength score is ${t.supportStrengthScore.toFixed(0)}/100, indicating ${n} support robustness‚Äîthis means the support level has ${l}. ${t.daysSinceLastBreak>20?"The extended period since the last break makes this support level more reliable.":""}`)}if(t.historicalPeakProbability!==null&&t.currentProbability){const n=(t.historicalPeakProbability*100).toFixed(1),l=(t.currentProbability*100).toFixed(1),y=(o.historicalPeakThreshold*100).toFixed(0);if(((t.historicalPeakProbability-t.currentProbability)*100).toFixed(1),t.historicalPeakProbability>=o.historicalPeakThreshold&&t.historicalPeakProbability>t.currentProbability&&t.recoveryAdvantage!==null&&t.currentProbBin&&t.dteBin){const v=(t.recoveryAdvantage*100).toFixed(1);d.push(`**Recovery Candidate Analysis:** This option previously reached a ${n}% probability peak but has declined to ${l}%‚Äîqualifying as a "recovery candidate." Historical research shows that similar options (${t.currentProbBin} probability with ${t.dteBin} days to expiry that previously peaked above ${y}%) expired worthless ${v}% of the time. This is substantially higher than the current ${l}% probability, indicating the market systematically underestimates these opportunities. For put sellers, this ${(parseFloat(v)-parseFloat(l)).toFixed(1)} percentage point advantage represents a statistical edge. See the Probability Analysis page ‚Üí "Probability Recovery Analysis" for detailed research.`)}else t.historicalPeakProbability>=o.historicalPeakThreshold&&t.historicalPeakProbability>t.currentProbability?d.push(`**Recovery Candidate:** This option previously reached a ${n}% probability peak but has declined to ${l}%, qualifying as a "recovery candidate." Research shows such options typically expire worthless more often than their current probability suggests, though specific historical data for this probability/DTE combination is limited.`):d.push(`**Probability History:** The ${m} probability previously peaked at ${n}%, ${t.historicalPeakProbability>=o.historicalPeakThreshold?`which is above the ${y}% threshold. The current probability is ${l}%.`:`which is below the ${y}% threshold, so this is not classified as a recovery candidate. The current probability is ${l}%.`}`)}else t.currentProbability>=.9&&t.recoveryAdvantage===null&&d.push(`**Probability Analysis:** The current probability of ${(t.currentProbability*100).toFixed(1)}% is very high (‚â•90%). Historical recovery data is not available for this probability bin, limiting comparative analysis.`);if(t.monthlyPositiveRate!==null){const n=["January","February","March","April","May","June","July","August","September","October","November","December"],l=new Date().getMonth(),y=n[l],v=t.monthlyPositiveRate.toFixed(1);let u=`**Monthly Seasonality:** Historical data shows that ${t.stockName} has had positive performance during ${v}% of all ${y} months in the dataset (${t.monthsInHistoricalData||"multiple"} months of historical data). `;if(t.typicalLowDay!==null){const i=new Date().getDate(),w=Math.abs(i-t.typicalLowDay);u+=`The stock typically hits monthly lows on day ${t.typicalLowDay} (${w<=3?`which is very close to today (day ${i}), suggesting we may be near a monthly low point`:`while today is day ${i}`}). `}t.monthlyAvgReturn!==null&&(u+=`The average return for ${y} is ${t.monthlyAvgReturn>=0?"+":""}${t.monthlyAvgReturn.toFixed(2)}%.`),d.push(u)}if(t.currentMonthPerformance!==null&&t.monthlyAvgReturn!==null){const n=["January","February","March","April","May","June","July","August","September","October","November","December"],l=new Date().getMonth(),y=n[l],v=t.currentMonthPerformance,u=t.monthlyAvgReturn,i=u-v;let w=`**Current Performance:** ${t.stockName}'s current performance for ${y} is ${v>=0?"+":""}${v.toFixed(2)}%, while the historical average for this month is ${u>=0?"+":""}${u.toFixed(2)}%. ${i>0?`The stock is currently underperforming by ${i.toFixed(2)} percentage points, which could suggest potential for a bounce back.`:i<0?`The stock is currently outperforming the historical average by ${Math.abs(i).toFixed(2)} percentage points.`:"The stock is performing in line with historical averages."}`;t.worstMonthDrawdown!==null&&(w+=` Historically, the worst intra-month drawdown for ${y} has been ${t.worstMonthDrawdown.toFixed(2)}%, providing context for potential downside risk.`),d.push(w)}const s=t.compositeScore>=70?"strong":t.compositeScore>=50?"moderate":"weak";return d.push(`**Composite Score:** Based on all these factors combined with customized weights, this option received a composite score of ${t.compositeScore.toFixed(1)}/100, indicating a ${s} recommendation. ${t.compositeScore>=70?"This high score suggests multiple favorable conditions align for this option.":t.compositeScore>=50?"This moderate score suggests some favorable conditions, but not all factors are optimal.":"This lower score suggests caution - review individual factors to understand potential concerns."}`),d.push(`**Recommendation:** ${t.stockName} option ${t.optionName} with strike ${t.strikePrice.toFixed(2)} kr and expiry ${t.expiryDate} (${t.daysToExpiry} days) offers a premium of ${t.premium.toLocaleString()} kr. ${t.compositeScore>=70?"The combination of support level stability, probability recovery potential, and favorable seasonality makes this a compelling candidate for put option writing.":t.compositeScore>=50?"This option shows some promise based on the analysis, though individual factors should be carefully reviewed.":"Consider reviewing alternative options with higher composite scores, or adjust analysis weights to match your risk tolerance."}`),e.jsxs($,{className:"border-primary/20",children:[e.jsx(A,{children:e.jsxs(B,{className:"flex items-center gap-2 text-base",children:[e.jsx(pt,{className:"h-4 w-4"}),"Why This Option Was Recommended"]})}),e.jsx(R,{className:"space-y-4",children:d.map((n,l)=>{const y=n.split(/(\*\*.*?\*\*)/g);return e.jsx("p",{className:"text-sm leading-relaxed",children:y.map((v,u)=>v.startsWith("**")&&v.endsWith("**")?e.jsx("span",{className:"font-semibold",children:v.slice(2,-2)},u):v)},l)})})]})},Bt=({recommendations:t,getFullPath:o,filters:h,weights:m})=>{const[c,d]=f.useState("compositeScore"),[s,n]=f.useState("desc"),[l,y]=f.useState(null),v=a=>{c===a?n(s==="asc"?"desc":"asc"):(d(a),n("desc"))},u=f.useMemo(()=>[...t].sort((a,p)=>{let x=a[c],b=p[c];if(x===null&&(x=-1/0),b===null&&(b=-1/0),typeof x=="number"&&typeof b=="number")return s==="asc"?x-b:b-x;const C=String(x).toLowerCase(),T=String(b).toLowerCase();return s==="asc"?C.localeCompare(T):T.localeCompare(C)}),[t,c,s]),i=({field:a,label:p,align:x="left"})=>e.jsx(Pe,{className:`cursor-pointer hover:bg-muted/50 ${x==="right"?"text-right":x==="center"?"text-center":""}`,onClick:()=>v(a),"aria-sort":c===a?s==="asc"?"ascending":"descending":void 0,children:e.jsxs("div",{className:`flex items-center gap-1 ${x==="right"?"justify-end":""}`,children:[e.jsx("span",{children:p}),c===a&&(s==="asc"?e.jsx(xt,{className:"h-3 w-3"}):e.jsx(yt,{className:"h-3 w-3"}))]})}),w=a=>a>=70?"text-green-600 dark:text-green-400":a>=50?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",r=a=>a.financialReport==="Y"?"text-orange-600 dark:text-orange-400":a.xDay&&String(a.xDay).toUpperCase()==="Y"?"text-red-600 dark:text-red-400":"text-primary";return e.jsx("div",{className:"space-y-4",children:e.jsxs(dt,{className:"w-full",children:[e.jsxs(nt,{children:[e.jsx(lt,{children:e.jsxs(ae,{children:[e.jsx(Pe,{className:"w-12",children:"Details"}),e.jsx(i,{field:"rank",label:"Rank",align:"center"}),e.jsx(i,{field:"stockName",label:"Stock"}),e.jsx(i,{field:"optionName",label:"Option"}),e.jsx(i,{field:"strikePrice",label:"Strike",align:"right"}),e.jsx(i,{field:"currentPrice",label:"Current",align:"right"}),e.jsx(i,{field:"rollingLow",label:"Support",align:"right"}),e.jsx(i,{field:"distanceToSupportPct",label:"Distance %",align:"right"}),e.jsx(i,{field:"daysSinceLastBreak",label:"Days Since (biz days)",align:"right"}),e.jsx(i,{field:"currentProbability",label:"Current PoW",align:"right"}),e.jsx(i,{field:"historicalPeakProbability",label:"Peak PoW",align:"right"}),e.jsx(i,{field:"recoveryAdvantage",label:"Recovery Rate %",align:"right"}),e.jsx(i,{field:"monthlyPositiveRate",label:"Monthly %",align:"right"}),e.jsx(i,{field:"currentMonthPerformance",label:"Curr Month",align:"right"}),e.jsx(i,{field:"supportStrengthScore",label:"Strength",align:"right"}),e.jsx(i,{field:"premium",label:"Premium",align:"right"}),e.jsx(i,{field:"compositeScore",label:"Score",align:"right"})]})}),e.jsx(ct,{children:u.length===0?e.jsx(ae,{children:e.jsx(N,{colSpan:17,className:"text-center text-muted-foreground py-8",children:"No recommendations found. Try adjusting your filters or click Analyze."})}):u.map((a,p)=>e.jsxs(De.Fragment,{children:[e.jsxs(ae,{className:"hover:bg-muted/50",children:[e.jsx(N,{children:e.jsx("button",{onClick:()=>y(l===p?null:p),className:"p-1 hover:bg-muted rounded",children:l===p?e.jsx(ot,{className:"h-4 w-4"}):e.jsx(le,{className:"h-4 w-4"})})}),e.jsx(N,{className:"text-center font-semibold",children:a.rank}),e.jsx(N,{children:e.jsx("button",{onClick:()=>window.open(o(`/stock/${encodeURIComponent(a.stockName)}`),"_blank"),className:"text-primary hover:underline cursor-pointer",children:a.stockName})}),e.jsx(N,{children:e.jsx("button",{onClick:()=>window.open(o(`/option/${encodeURIComponent(a.optionName)}`),"_blank"),className:`font-medium hover:opacity-80 transition-all cursor-pointer ${r(a)}`,children:a.optionName})}),e.jsx(N,{className:"text-right",children:a.strikePrice.toFixed(2)}),e.jsx(N,{className:"text-right",children:a.currentPrice.toFixed(2)}),e.jsx(N,{className:"text-right",children:a.rollingLow!==null?a.rollingLow.toFixed(2):"-"}),e.jsx(N,{className:"text-right",children:a.distanceToSupportPct!==null?`${a.distanceToSupportPct.toFixed(1)}%`:"-"}),e.jsx(N,{className:"text-right",children:a.daysSinceLastBreak!==null?a.daysSinceLastBreak:"N/A"}),e.jsxs(N,{className:"text-right",children:[(a.currentProbability*100).toFixed(1),"%"]}),e.jsx(N,{className:"text-right",children:a.historicalPeakProbability!==null?`${(a.historicalPeakProbability*100).toFixed(1)}%`:"-"}),e.jsx(N,{className:"text-right",children:a.recoveryAdvantage!==null?`${(a.recoveryAdvantage*100).toFixed(1)}%`:"-"}),e.jsx(N,{className:"text-right",children:a.monthlyPositiveRate!==null?`${a.monthlyPositiveRate.toFixed(1)}%`:"-"}),e.jsx(N,{className:"text-right",children:a.currentMonthPerformance!==null?`${a.currentMonthPerformance>=0?"+":""}${a.currentMonthPerformance.toFixed(2)}%`:"-"}),e.jsx(N,{className:"text-right",children:a.supportStrengthScore!==null?a.supportStrengthScore.toFixed(0):"-"}),e.jsx(N,{className:"text-right text-green-600 dark:text-green-400 font-semibold",children:a.premium.toLocaleString()}),e.jsx(N,{className:`text-right font-bold text-lg ${w(a.compositeScore)}`,children:a.compositeScore.toFixed(1)})]}),l===p&&e.jsx(ae,{children:e.jsx(N,{colSpan:17,className:"bg-muted/30",children:e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(Ft,{breakdown:a.scoreBreakdown,compositeScore:a.compositeScore,weights:m}),e.jsx(At,{option:a,filters:{rollingPeriod:h.rollingPeriod,minDaysSinceBreak:h.minDaysSinceBreak,probabilityMethod:h.probabilityMethod,historicalPeakThreshold:h.historicalPeakThreshold}})]})})})})]},a.optionName))})]}),e.jsx(ht,{orientation:"horizontal"})]})})},zt=({recommendations:t,selectedStocks:o,onSelectedStocksChange:h})=>{const[m,c]=f.useState(!1),d=f.useRef(null),s=De.useMemo(()=>{const u=new Map;return t.forEach(i=>{u.set(i.stockName,(u.get(i.stockName)||0)+1)}),Array.from(u.entries()).map(([i,w])=>({stock:i,count:w})).sort((i,w)=>i.stock.localeCompare(w.stock))},[t]);f.useEffect(()=>{const u=i=>{d.current&&!d.current.contains(i.target)&&c(!1)};if(m)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[m]);const n=u=>{o.includes(u)?h(o.filter(i=>i!==u)):h([...o,u])},l=()=>{h([])},y=()=>{h(s.map(u=>u.stock))},v=o.length===0?"All stocks":o.length===1?o[0]:`${o.length} stocks selected`;return e.jsxs("div",{className:"relative",ref:d,children:[e.jsxs(I,{variant:"outline",className:"w-full justify-between",onClick:()=>c(!m),children:[e.jsx("span",{className:"truncate",children:v}),e.jsx(le,{className:`h-4 w-4 ml-2 transition-transform flex-shrink-0 ${m?"rotate-180":""}`})]}),m&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-950 border rounded-md shadow-lg z-50 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 border-b bg-white dark:bg-slate-950 p-2 flex gap-2",children:[e.jsx(I,{variant:"sm",size:"sm",onClick:y,className:"flex-1 h-8",children:"Select All"}),e.jsx(I,{variant:"outline",size:"sm",onClick:l,className:"flex-1 h-8",children:"Clear"})]}),e.jsx("div",{className:"p-2 space-y-1",children:s.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-2",children:"No stocks available"}):s.map(({stock:u,count:i})=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.includes(u),onChange:()=>n(u),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm flex-1",children:u}),e.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:i})]},u))})]})]})},Lt={expiryDate:"",rollingPeriod:365,minDaysSinceBreak:10,probabilityMethod:"ProbWorthless_Bayesian_IsoCal",historicalPeakThreshold:.9},Ne={supportStrength:20,daysSinceBreak:15,recoveryAdvantage:25,historicalPeak:15,monthlySeasonality:15,currentPerformance:10};var re="Collapsible",[Ot]=qe(re),[Et,de]=Ot(re),Me=f.forwardRef((t,o)=>{const{__scopeCollapsible:h,open:m,defaultOpen:c,disabled:d,onOpenChange:s,...n}=t,[l,y]=Ee({prop:m,defaultProp:c??!1,onChange:s,caller:re});return e.jsx(Et,{scope:h,disabled:d,contentId:We(),open:l,onOpenToggle:f.useCallback(()=>y(v=>!v),[y]),children:e.jsx(ce.div,{"data-state":ue(l),"data-disabled":d?"":void 0,...n,ref:o})})});Me.displayName=re;var $e="CollapsibleTrigger",Re=f.forwardRef((t,o)=>{const{__scopeCollapsible:h,...m}=t,c=de($e,h);return e.jsx(ce.button,{type:"button","aria-controls":c.contentId,"aria-expanded":c.open||!1,"data-state":ue(c.open),"data-disabled":c.disabled?"":void 0,disabled:c.disabled,...m,ref:o,onClick:Ie(t.onClick,c.onOpenToggle)})});Re.displayName=$e;var he="CollapsibleContent",Te=f.forwardRef((t,o)=>{const{forceMount:h,...m}=t,c=de(he,t.__scopeCollapsible);return e.jsx(He,{present:h||c.open,children:({present:d})=>e.jsx(Wt,{...m,ref:o,present:d})})});Te.displayName=he;var Wt=f.forwardRef((t,o)=>{const{__scopeCollapsible:h,present:m,children:c,...d}=t,s=de(he,h),[n,l]=f.useState(m),y=f.useRef(null),v=Ve(o,y),u=f.useRef(0),i=u.current,w=f.useRef(0),r=w.current,a=s.open||n,p=f.useRef(a),x=f.useRef(void 0);return f.useEffect(()=>{const b=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(b)},[]),Ue(()=>{const b=y.current;if(b){x.current=x.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const C=b.getBoundingClientRect();u.current=C.height,w.current=C.width,p.current||(b.style.transitionDuration=x.current.transitionDuration,b.style.animationName=x.current.animationName),l(m)}},[s.open,m]),e.jsx(ce.div,{"data-state":ue(s.open),"data-disabled":s.disabled?"":void 0,id:s.contentId,hidden:!a,...d,ref:v,style:{"--radix-collapsible-content-height":i?`${i}px`:void 0,"--radix-collapsible-content-width":r?`${r}px`:void 0,...t.style},children:a&&c})});function ue(t){return t?"open":"closed"}var It=Me;const Ht=It,Vt=Re,Ut=Te,xa=()=>{var M,L;Ze("Option Recommendations");const{analyzeOptions:t,isLoading:o}=Mt(),{data:h}=Ce(),{toast:m}=Ke(),[c,d]=f.useState(Lt),[s,n]=f.useState(Ne),[l,y]=f.useState([]),[v,u]=f.useState(!1),[i,w]=f.useState(!1),[r,a]=f.useState([]),p=f.useMemo(()=>!h||h.length===0?[]:[...new Set(h.map(g=>g.ExpiryDate))].sort(),[h]);f.useEffect(()=>{if(!c.expiryDate&&p.length>0){const g=Ge(p);g&&d(P=>({...P,expiryDate:g}))}},[p,c.expiryDate]);const x=g=>(window.location.hostname==="datamilo.github.io"?"/put-options-se":"")+g,b=()=>{c.expiryDate&&(u(!0),setTimeout(()=>{const g=Object.values(s).reduce((O,_)=>O+_,0),P=g>0?Object.fromEntries(Object.entries(s).map(([O,_])=>[O,_/g*100])):s,z=t(c,P);y(z),u(!1)},100))},C=(g,P)=>{n({...s,[g]:P})},T=()=>{n(Ne)},me=()=>{$t({filename:"option-recommendations",data:k}),m({title:"Export successful",description:`Exported ${k.length} recommendations to Excel`})},j=f.useMemo(()=>l.length===0?0:new Set(l.map(g=>g.stockName)).size,[l]),k=f.useMemo(()=>r.length===0?l:l.filter(g=>r.includes(g.stockName)),[l,r]),S=f.useMemo(()=>k.length===0?0:k.reduce((g,P)=>g+P.compositeScore,0)/k.length,[k]);return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Automated Put Option Recommendations"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Evaluates 6 weighted analysis factors‚Äîsupport strength, support stability, recovery potential, historical peaks, monthly seasonality, and current performance‚Äîto identify optimal put writing opportunities."})]}),o&&e.jsx($,{children:e.jsx(R,{className:"py-8",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading data sources..."})})}),!o&&e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx(A,{children:e.jsx(B,{children:"Analysis Parameters"})}),e.jsx(R,{children:e.jsx(Rt,{filters:c,onFiltersChange:d,onAnalyze:b,availableExpiryDates:p,isAnalyzing:v})})]}),l.length>0&&e.jsxs($,{children:[e.jsx(A,{children:e.jsx(B,{children:"Filter by Stock"})}),e.jsx(R,{children:e.jsx(zt,{recommendations:l,selectedStocks:r,onSelectedStocksChange:a})})]}),e.jsx(Ht,{open:i,onOpenChange:w,children:e.jsxs($,{children:[e.jsx(A,{children:e.jsx(Vt,{className:"w-full hover:opacity-80 transition-opacity",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"text-lg",children:"Score Weights Configuration"}),e.jsx(le,{className:`h-5 w-5 transition-transform ${i?"rotate-180":""}`})]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:g=>{g.stopPropagation(),T()},children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Reset"]})]})})}),e.jsx(Ut,{children:e.jsxs(R,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adjust sliders to set relative importance between factors."}),[{key:"recoveryAdvantage",label:"Recovery Advantage",description:"Statistical advantage from probability recovery"},{key:"supportStrength",label:"Support Strength",description:"Pre-calculated support level robustness"},{key:"daysSinceBreak",label:"Days Since Break",description:"Time since support was last broken"},{key:"historicalPeak",label:"Historical Peak",description:"Recovery candidate from high past probability"},{key:"monthlySeasonality",label:"Monthly Seasonality",description:"Historical % of positive months"},{key:"currentPerformance",label:"Current Performance",description:"Underperformance suggests bounce potential"}].map(g=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(W,{htmlFor:g.key,children:g.label}),e.jsxs("span",{className:"text-sm font-medium",children:[s[g.key],"%"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g.description}),e.jsx(Je,{id:g.key,value:[s[g.key]],onValueChange:([P])=>C(g.key,P),min:0,max:50,step:5})]},g.key))]})})]})}),l.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs($,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Unique Stocks"}),e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.length>0&&r.length<j?`${r.length} selected`:"Available stocks"})]})]}),e.jsxs($,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Recommendations"}),e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:k.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.length>0?"After filtering":"Matching criteria"})]})]}),e.jsxs($,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Average Composite Score"}),e.jsx(bt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:S.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across options"})]})]}),e.jsxs($,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Top Score"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((M=k[0])==null?void 0:M.compositeScore.toFixed(1))||"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:((L=k[0])==null?void 0:L.stockName)||"N/A"})]})]})]}),e.jsxs($,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{children:["Recommendations"," ",k.length>0&&`(${k.length})`]}),k.length>0&&e.jsxs(I,{variant:"outline",size:"sm",onClick:me,children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Export to Excel"]})]})}),e.jsx(R,{children:e.jsx(Bt,{recommendations:k,getFullPath:x,filters:c,weights:s})})]})]})]})};export{xa as AutomatedRecommendations,xa as default};
