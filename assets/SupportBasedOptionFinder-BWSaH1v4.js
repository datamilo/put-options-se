import{j as e,O as me,J as pe,Q as he,U as be,L as G,I as je,T as $,f as M,g as A,h as L,C as ge}from"./index-BVw2Pzxv.js";import{r as b,R as fe}from"./router-C0wDHNfv.js";import{u as ve}from"./usePageTitle-CpPgFbZv.js";import{u as ne}from"./useEnrichedOptionsData-QELhI0Ua.js";import{u as ie}from"./useSupportLevelMetrics-DrzEGGKY.js";import{C as D,a as I,b as O,c as B}from"./card-Dh7Q_ijz.js";import{S as Z,a as ee,b as se,c as te,d as E,C as ye}from"./select-CzhzUq9X.js";import{T as Ne,a as _e,b as X,c as P,d as ke,e as u}from"./table-W_lzODQg.js";import{S as we,a as Se}from"./scroll-area-iYhE9Q-7.js";import{A as T,a as F}from"./arrow-up-sGc0pOJ_.js";import{I as R}from"./info-CIZJMKHd.js";import"./charts-B8eVsusH.js";import"./csv-B1Pu-2A6.js";const Ce=()=>{const{data:s,isLoading:i}=ne(),{data:c,isLoading:d,getMetricsForStock:o}=ie();return{findOptions:b.useCallback(n=>{if(!s||s.length===0)return[];if(!c||c.length===0)return[];const l=[];return s.forEach(a=>{const r=o(a.StockName,n.rollingPeriod);if(!r||n.expiryDate&&a.ExpiryDate!==n.expiryDate||r.days_since_last_break!==null&&r.days_since_last_break<n.minDaysSinceBreak||r.rolling_low===null||a.StrikePrice>r.rolling_low)return;const S=a.ProbWorthless_Bayesian_IsoCal??0,p=a["1_ProbOfWorthless_Original"]??0;if(S<n.minProbOfWorthless)return;const g=Math.floor((new Date(a.ExpiryDate).getTime()-new Date().getTime())/(1e3*60*60*24));if(g>n.maxDaysToExpiry||g<0||(a.Premium??0)<n.minPremium||n.requireStrikeBelowLowerAtAcc&&a.StrikeBelowLowerAtAcc!=="Y")return;const j=(a.Ask??0)-(a.Bid??0);if(j>n.maxBidAskSpread||n.minSupportStrength!==void 0&&r.support_strength_score<n.minSupportStrength||n.patternTypes&&n.patternTypes.length>0&&!n.patternTypes.includes(r.pattern_type)||n.maxBreakProbability30d!==void 0&&r.break_probability_30d>n.maxBreakProbability30d||n.stabilityTrends&&n.stabilityTrends.length>0&&!n.stabilityTrends.includes(r.stability_trend))return;const m=r.current_price>0?(r.rolling_low-r.current_price)/r.current_price*100:null,f=r.rolling_low?(a.StrikePrice-r.rolling_low)/r.rolling_low*100:null;if(n.strikePosition==="at_support"){if(f===null||Math.abs(f)>2)return}else if(n.strikePosition==="below_median_drop"){if(r.median_drop_per_break_pct===null)return;const y=r.rolling_low*(1+r.median_drop_per_break_pct/100);if(Math.abs(a.StrikePrice-y)/y*100>5)return}else if(n.strikePosition==="percent_below"){if(!n.percentBelow)return;const y=r.rolling_low*(1-n.percentBelow/100);if(Math.abs(a.StrikePrice-y)/y*100>5)return}l.push({optionName:a.OptionName,stockName:a.StockName,expiryDate:a.ExpiryDate,strikePrice:a.StrikePrice,currentPrice:r.current_price,rollingLow:r.rolling_low,distanceToSupport:m,strikeVsSupport:f,medianDropPerBreak:r.median_drop_per_break_pct,premium:a.Premium??0,powBayesianCalibrated:S,powOriginal:p,daysToExpiry:g,supportStability:r.support_stability_pct,daysSinceLastBreak:r.days_since_last_break,numBreaks:r.total_breaks,strikeBelowLowerAtAcc:a.StrikeBelowLowerAtAcc??"",bidAskSpread:j,lowerBoundAtAccuracy:a.Lower_Bound_at_Accuracy??null,maxConsecutiveBreaks:r.max_consecutive_breaks,currentConsecutiveBreaks:r.current_consecutive_breaks,supportStrengthScore:r.support_strength_score,patternType:r.pattern_type,breakProbability30d:r.break_probability_30d,breakProbability60d:r.break_probability_60d,stabilityTrend:r.stability_trend})}),l.sort((a,r)=>r.premium-a.premium)},[s,c,o]),isLoading:i||d}};function Pe(s,i=[]){let c=[];function d(x,n){const l=b.createContext(n);l.displayName=x+"Context";const a=c.length;c=[...c,n];const r=p=>{var C;const{scope:g,children:j,...m}=p,f=((C=g==null?void 0:g[s])==null?void 0:C[a])||l,y=b.useMemo(()=>m,Object.values(m));return e.jsx(f.Provider,{value:y,children:j})};r.displayName=x+"Provider";function S(p,g){var f;const j=((f=g==null?void 0:g[s])==null?void 0:f[a])||l,m=b.useContext(j);if(m)return m;if(n!==void 0)return n;throw new Error(`\`${p}\` must be used within \`${x}\``)}return[r,S]}const o=()=>{const x=c.map(n=>b.createContext(n));return function(l){const a=(l==null?void 0:l[s])||x;return b.useMemo(()=>({[`__scope${s}`]:{...l,[s]:a}}),[l,a])}};return o.scopeName=s,[d,De(o,...i)]}function De(...s){const i=s[0];if(s.length===1)return i;const c=()=>{const d=s.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(x){const n=d.reduce((l,{useScope:a,scopeName:r})=>{const p=a(x)[`__scope${r}`];return{...l,...p}},{});return b.useMemo(()=>({[`__scope${i.scopeName}`]:n}),[n])}};return c.scopeName=i.scopeName,c}var Be=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],le=Be.reduce((s,i)=>{const c=me(`Primitive.${i}`),d=b.forwardRef((o,x)=>{const{asChild:n,...l}=o,a=n?c:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(a,{...l,ref:x})});return d.displayName=`Primitive.${i}`,{...s,[i]:d}},{}),Y="Progress",J=100,[Te]=Pe(Y),[Fe,$e]=Te(Y),oe=b.forwardRef((s,i)=>{const{__scopeProgress:c,value:d=null,max:o,getValueLabel:x=Me,...n}=s;(o||o===0)&&!re(o)&&console.error(Ae(`${o}`,"Progress"));const l=re(o)?o:J;d!==null&&!ae(d,l)&&console.error(Le(`${d}`,"Progress"));const a=ae(d,l)?d:null,r=q(a)?x(a,l):void 0;return e.jsx(Fe,{scope:c,value:a,max:l,children:e.jsx(le.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":q(a)?a:void 0,"aria-valuetext":r,role:"progressbar","data-state":xe(a,l),"data-value":a??void 0,"data-max":l,...n,ref:i})})});oe.displayName=Y;var ce="ProgressIndicator",de=b.forwardRef((s,i)=>{const{__scopeProgress:c,...d}=s,o=$e(ce,c);return e.jsx(le.div,{"data-state":xe(o.value,o.max),"data-value":o.value??void 0,"data-max":o.max,...d,ref:i})});de.displayName=ce;function Me(s,i){return`${Math.round(s/i*100)}%`}function xe(s,i){return s==null?"indeterminate":s===i?"complete":"loading"}function q(s){return typeof s=="number"}function re(s){return q(s)&&!isNaN(s)&&s>0}function ae(s,i){return q(s)&&!isNaN(s)&&s<=i&&s>=0}function Ae(s,i){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${i}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${J}\`.`}function Le(s,i){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${i}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${J} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ue=oe,Ee=de;const V=b.forwardRef(({className:s,value:i,...c},d)=>e.jsx(ue,{ref:d,className:pe("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...c,children:e.jsx(Ee,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(i||0)}%)`}})}));V.displayName=ue.displayName;const Re=({metrics:s,rollingPeriod:i})=>{var f,y,C,H,z;const c=s.support_stability_pct/100*30,d=s.days_since_last_break??365,o=Math.min(d/365,1)*100,x=o/100*25,n=Math.min(s.trading_days_per_break/200,1)*100,l=n/100*25,a=Math.max(0,(5-s.drop_std_dev_pct)/5)*100,r=a/100*20,S=c+x+l+r,g=[{rule:"never_breaks",condition:"Stability ≥ 99.5%",met:s.support_stability_pct>=99.5,value:`${s.support_stability_pct.toFixed(2)}%`},{rule:"exhausted_cascade",condition:"Current Consecutive ≥ 80% of Max",met:s.current_consecutive_breaks>=s.max_consecutive_breaks*.8,value:`${s.current_consecutive_breaks} ≥ ${(s.max_consecutive_breaks*.8).toFixed(1)}`},{rule:"shallow_breaker",condition:"Median Drop < 2%",met:(s.median_drop_per_break_pct??0)>-2&&(s.median_drop_per_break_pct??0)<0,value:`${(s.median_drop_per_break_pct??0).toFixed(2)}%`},{rule:"volatile",condition:"Stability < 70% AND Median Drop < -5%",met:s.support_stability_pct<70&&(s.median_drop_per_break_pct??0)<-5,value:`Stability: ${s.support_stability_pct.toFixed(1)}%, Drop: ${(s.median_drop_per_break_pct??0).toFixed(2)}%`},{rule:"stable",condition:"Stability ≥ 85% AND Total Breaks < 10",met:s.support_stability_pct>=85&&s.total_breaks<10,value:`Stability: ${s.support_stability_pct.toFixed(1)}%, Breaks: ${s.total_breaks}`},{rule:"predictable_cycles",condition:"Default (none of above met)",met:!0,value:"Falls through to default"}];g.find(h=>h.met&&h.rule===s.pattern_type);const m=s.stability_trend==="improving"?{description:"Second half stability exceeds first half by >5%",meaning:"Support is strengthening recently",visual:"upward"}:s.stability_trend==="weakening"?{description:"Second half stability is >5% lower than first half",meaning:"Support is deteriorating recently",visual:"downward"}:{description:"Second half stability within ±5% of first half",meaning:"Support behavior is consistent",visual:"flat"};return e.jsx("div",{className:"bg-muted/30 p-6 flex justify-start",children:e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(O,{className:"text-lg",children:["Support Strength Score: ",s.support_strength_score.toFixed(1),"/100"]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:"1. Support Stability (30% weight)"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.support_stability_pct.toFixed(2),"% × 0.30 = ",c.toFixed(2)]})]}),e.jsx(V,{value:c/30*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:"2. Days Since Break (25% weight)"}),e.jsxs("span",{className:"text-muted-foreground",children:[d,"d → ",o.toFixed(1),"% × 0.25 = ",x.toFixed(2)]})]}),e.jsx(V,{value:x/25*100,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Normalized: ",d," days ÷ 365 max = ",o.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:"3. Break Frequency (25% weight)"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.trading_days_per_break.toFixed(1)," days/break → ",n.toFixed(1),"% × 0.25 = ",l.toFixed(2)]})]}),e.jsx(V,{value:l/25*100,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Normalized: ",s.trading_days_per_break.toFixed(1)," ÷ 200 target = ",n.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:"4. Drop Consistency (20% weight)"}),e.jsxs("span",{className:"text-muted-foreground",children:["StdDev ",s.drop_std_dev_pct.toFixed(2),"% → ",a.toFixed(1),"% × 0.20 = ",r.toFixed(2)]})]}),e.jsx(V,{value:r/20*100,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Normalized: (5% - ",s.drop_std_dev_pct.toFixed(2),"%) ÷ 5% = ",a.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total Calculated Score:"}),e.jsxs("span",{children:[S.toFixed(2),"/100"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Actual Score from Data:"}),e.jsxs("span",{children:[s.support_strength_score.toFixed(2),"/100"]})]})]})]})]}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(O,{className:"text-lg",children:["Pattern: ",e.jsx("span",{className:s.pattern_type==="never_breaks"?"text-green-700":s.pattern_type==="exhausted_cascade"?"text-blue-600":s.pattern_type==="shallow_breaker"?"text-green-600":s.pattern_type==="volatile"?"text-red-600":"text-gray-600",children:(f=s.pattern_type)==null?void 0:f.replace(/_/g," ")})]})}),e.jsxs(B,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Pattern is assigned based on first matching rule (evaluated in order):"}),e.jsx("div",{className:"space-y-2",children:g.map((h,W)=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${h.rule===s.pattern_type?"bg-primary/10 border-primary":"bg-background border-border"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2",children:h.rule===s.pattern_type?"✓":W+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:h.rule.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:h.condition}),e.jsxs("div",{className:"text-xs mt-1",children:[e.jsx("span",{className:h.met?"text-green-600":"text-muted-foreground",children:h.value}),h.rule===s.pattern_type&&e.jsx("span",{className:"ml-2 font-semibold text-primary",children:"← Matched!"})]})]})]},h.rule))})]})]}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(O,{className:"text-lg",children:["Trend: ",e.jsxs("span",{className:s.stability_trend==="improving"?"text-green-600":s.stability_trend==="weakening"?"text-red-600":"text-gray-600",children:[s.stability_trend==="improving"?"↑":s.stability_trend==="weakening"?"↓":"→"," ",s.stability_trend]})]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"First Half of Period"}),e.jsx("div",{className:"h-16 bg-muted rounded flex items-end justify-center relative",children:e.jsx("div",{className:`w-full transition-all ${m.visual==="upward"?"bg-blue-300":m.visual==="downward"?"bg-blue-500":"bg-blue-400"}`,style:{height:m.visual==="upward"?"60%":m.visual==="downward"?"90%":"75%"}})})]}),e.jsx("div",{className:"flex-shrink-0 text-2xl",children:(s.stability_trend==="improving"||s.stability_trend==="weakening","→")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Second Half of Period"}),e.jsx("div",{className:"h-16 bg-muted rounded flex items-end justify-center relative",children:e.jsx("div",{className:`w-full transition-all ${m.visual==="upward"?"bg-green-500":m.visual==="downward"?"bg-red-300":"bg-blue-400"}`,style:{height:m.visual==="upward"?"90%":m.visual==="downward"?"60%":"75%"}})})]})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Calculation:"})," ",m.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meaning:"})," ",m.meaning]})]})]})]}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsx(O,{className:"text-lg",children:"Consecutive Breaks Analysis"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Historical Maximum"}),e.jsxs("span",{className:"font-bold",children:[s.max_consecutive_breaks," breaks"]})]}),e.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:e.jsxs("div",{className:"absolute inset-y-0 left-0 bg-orange-500 flex items-center justify-center text-white text-xs font-bold",style:{width:"100%"},children:["Max: ",s.max_consecutive_breaks]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Worst-case scenario: ",s.max_consecutive_breaks," consecutive breaks in one cluster"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Current Consecutive"}),e.jsxs("span",{className:`font-bold ${s.current_consecutive_breaks>0?"text-orange-600":"text-green-600"}`,children:[s.current_consecutive_breaks," breaks"]})]}),e.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:s.current_consecutive_breaks>0?e.jsxs("div",{className:"absolute inset-y-0 left-0 bg-red-500 flex items-center justify-center text-white text-xs font-bold",style:{width:`${s.current_consecutive_breaks/s.max_consecutive_breaks*100}%`},children:["Current: ",s.current_consecutive_breaks]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-green-700 text-xs font-bold",children:"No active cluster - Support holding ✓"})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.current_consecutive_breaks>0?`Active cluster with ${s.current_consecutive_breaks} breaks (${(s.current_consecutive_breaks/s.max_consecutive_breaks*100).toFixed(0)}% of max)`:"No breaks in recent cluster (last cluster ended >30 days ago)"})]}),s.current_consecutive_breaks>=s.max_consecutive_breaks*.8&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"text-blue-600 text-xl",children:"ℹ️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900 text-sm",children:"Exhausted Cascade Pattern Detected!"}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Current breaks (",s.current_consecutive_breaks,") ≥ 80% of historical max (",s.max_consecutive_breaks,"). This suggests the cascade may be near exhaustion - potential rebound candidate."]})]})]})})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Breaks in Period:"}),e.jsx("span",{className:"font-semibold",children:s.total_breaks})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Number of Clusters:"}),e.jsx("span",{className:"font-semibold",children:s.num_clusters})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Days Between Breaks:"}),e.jsx("span",{className:"font-semibold",children:((y=s.avg_days_between_breaks)==null?void 0:y.toFixed(1))??"N/A"})]})]})]})]}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(O,{className:"text-lg",children:["Data Summary for ",i,"-Day Period"]})}),e.jsxs(B,{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Rolling Low"}),e.jsxs("div",{className:"font-semibold",children:[(C=s.rolling_low)==null?void 0:C.toFixed(2)," kr"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Current Price"}),e.jsxs("div",{className:"font-semibold",children:[s.current_price.toFixed(2)," kr"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Distance to Support"}),e.jsxs("div",{className:"font-semibold",children:[(H=s.distance_to_support_pct)==null?void 0:H.toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Support Stability"}),e.jsxs("div",{className:"font-semibold",children:[s.support_stability_pct.toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Median Drop/Break"}),e.jsxs("div",{className:"font-semibold",children:[(z=s.median_drop_per_break_pct)==null?void 0:z.toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Days Since Last Break"}),e.jsx("div",{className:"font-semibold",children:s.days_since_last_break??"N/A"})]})]})]})]})})},Ke=()=>{ve("Support Level Options List");const{findOptions:s,isLoading:i}=Ce(),{data:c}=ne(),{getMetricsForStock:d}=ie(),o=t=>(window.location.hostname==="datamilo.github.io"?"/put-options-se":"")+t,[x,n]=b.useState("90"),[l,a]=b.useState("30"),[r,S]=b.useState(null),[p,g]=b.useState("premium"),[j,m]=b.useState("desc"),[f,y]=b.useState(null),C=t=>{y(f===t?null:t)},H=t=>{window.open(o(`/option/${encodeURIComponent(t)}`),"_blank")},z=t=>{window.open(o(`/stock/${encodeURIComponent(t)}`),"_blank")};b.useEffect(()=>{if(r===null&&c.length>0){const t=[...new Set(c.map(_=>_.ExpiryDate))].sort(),N=he(t);N&&S(N)}},[c,r]);const h=t=>{p===t?m(j==="asc"?"desc":"asc"):(g(t),m("desc"))},W=b.useMemo(()=>{const t={rollingPeriod:parseInt(x),minDaysSinceBreak:parseInt(l),strikePosition:"any",minProbOfWorthless:0,maxDaysToExpiry:999,minPremium:0,requireStrikeBelowLowerAtAcc:!1,maxBidAskSpread:999,expiryDate:r||void 0};return s(t)},[x,l,r,s]),U=b.useMemo(()=>[...W].sort((N,_)=>{let k=N[p],w=_[p];if(k===null&&(k=-1/0),w===null&&(w=-1/0),typeof k=="number"&&typeof w=="number")return j==="asc"?k-w:w-k;const Q=String(k).toLowerCase(),K=String(w).toLowerCase();return j==="asc"?Q.localeCompare(K):K.localeCompare(Q)}),[W,p,j]),v=({field:t,label:N,align:_="left"})=>{const k=p===t,w=t==="numBreaks";return e.jsx(P,{className:`min-w-[100px] cursor-pointer hover:bg-muted/50 transition-colors ${_==="right"?"text-right":""}`,onClick:()=>!w&&h(t),children:e.jsxs("div",{className:`flex items-center gap-1 ${_==="right"?"justify-end":""}`,children:[e.jsx("span",{children:N}),k&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"}))]})})};return i?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx(D,{children:e.jsx(B,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading data..."})})})}):e.jsx("div",{className:"min-h-screen bg-background p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-foreground mb-2 flex items-center gap-3",children:[e.jsx(be,{className:"h-8 w-8"}),"Support Level Options List"]}),e.jsx("p",{className:"text-muted-foreground",children:"Filter put options by support levels and analyze positioning relative to support"})]}),e.jsxs(D,{className:"mb-8",children:[e.jsx(I,{children:e.jsx(O,{children:"Filter Criteria"})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Support Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(G,{htmlFor:"rolling-period",className:"text-sm",children:"Rolling Low Period"}),e.jsxs(Z,{value:x,onValueChange:n,children:[e.jsx(ee,{id:"rolling-period",children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"30",children:"1-Month (30 days)"}),e.jsx(E,{value:"90",children:"3-Month (90 days)"}),e.jsx(E,{value:"180",children:"6-Month (180 days)"}),e.jsx(E,{value:"270",children:"9-Month (270 days)"}),e.jsx(E,{value:"365",children:"1-Year (365 days)"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(G,{htmlFor:"days-since-break",className:"text-sm",children:"Min Days Since Last Break (business days)"}),e.jsx(je,{id:"days-since-break",type:"number",value:l,onChange:t=>a(t.target.value),min:"0",step:"5"})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(G,{htmlFor:"expiry-date",className:"text-sm",children:"Expiry Date"}),e.jsxs(Z,{value:r||"",onValueChange:S,children:[e.jsx(ee,{id:"expiry-date",children:e.jsx(se,{placeholder:"Select expiry date"})}),e.jsx(te,{children:[...new Set(c.map(t=>t.ExpiryDate))].sort().map(t=>e.jsx(E,{value:t,children:t},t))})]})]})]})]})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Found ",e.jsx("span",{className:"font-bold text-foreground",children:U.length})," options matching criteria"]})}),U.length>0?e.jsxs(we,{className:"w-full rounded-md border",children:[e.jsxs(Ne,{children:[e.jsx(_e,{children:e.jsxs(X,{children:[e.jsx(P,{className:"w-[50px]",children:"Details"}),e.jsx(v,{field:"stockName",label:"Stock"}),e.jsx(v,{field:"optionName",label:"Option"}),e.jsx(P,{className:"min-w-[100px]",children:"Support Analysis"}),e.jsx(v,{field:"currentPrice",label:"Current Price",align:"right"}),e.jsx(v,{field:"strikePrice",label:"Strike",align:"right"}),e.jsx(v,{field:"rollingLow",label:`Support (${x}d)`,align:"right"}),e.jsx(v,{field:"distanceToSupport",label:"Distance to Support",align:"right"}),e.jsx(v,{field:"strikeVsSupport",label:"Strike vs Support",align:"right"}),e.jsx(v,{field:"medianDropPerBreak",label:"Median Drop/Break",align:"right"}),e.jsx(v,{field:"premium",label:"Premium",align:"right"}),e.jsx(v,{field:"powBayesianCalibrated",label:"PoW - Bayesian Calibrated",align:"right"}),e.jsx(v,{field:"powOriginal",label:"PoW - Original",align:"right"}),e.jsx(v,{field:"daysToExpiry",label:"Days to Expiry",align:"right"}),e.jsx(P,{className:"text-right min-w-[130px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("supportStability"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{children:"Support Stability"}),p==="supportStability"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsx(L,{className:"max-w-xs bg-background border",children:e.jsx("p",{children:"Percentage of trading days within the rolling period where the rolling low held without being broken. Higher percentage indicates more stable support. For example, 85% means the support level held on 85% of days and was broken on 15% of days."})})]})})]})}),e.jsx(v,{field:"daysSinceLastBreak",label:"Days Since Break (biz days)",align:"right"}),e.jsx(P,{className:"text-right min-w-[130px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("supportStrengthScore"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{children:"Support Strength"}),p==="supportStrengthScore"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsxs(L,{className:"max-w-xs bg-background border",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Support Strength Score (0-100)"}),e.jsx("p",{className:"mb-2",children:"Composite score combining: Stability (30%), Days Since Break (25%), Break Frequency (25%), Drop Consistency (20%)"}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-green-600",children:"80-100: Exceptional"})," |",e.jsx("span",{className:"text-green-600",children:" 70-79: Strong"})," |",e.jsx("span",{className:"text-yellow-600",children:" 60-69: Good"})," |",e.jsx("span",{className:"text-yellow-600",children:" 50-59: Moderate"})," |",e.jsx("span",{className:"text-red-600",children:" <50: Weak"})]})]})]})})]})}),e.jsx(P,{className:"text-left min-w-[150px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("patternType"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Pattern"}),p==="patternType"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsxs(L,{className:"max-w-md bg-background border",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Pattern Classification"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-green-600 font-semibold",children:"never_breaks:"})," 99.5%+ stability - safest"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"exhausted_cascade:"})," Near max breaks - rebound candidate"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-green-600 font-semibold",children:"shallow_breaker:"})," <2% drops - low downside"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-red-600 font-semibold",children:"volatile:"})," Frequent + large drops - high risk"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-green-600",children:"stable:"})," 85%+ stability - reliable"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-600",children:"predictable_cycles:"})," Regular patterns - time entries"]})]})]})]})})]})}),e.jsx(P,{className:"text-left min-w-[110px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("stabilityTrend"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Trend"}),p==="stabilityTrend"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsxs(L,{className:"max-w-xs bg-background border",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Stability Trend"}),e.jsx("p",{className:"mb-2",children:"Compares first half vs second half of rolling period."}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-green-600",children:"↑ improving:"})," Support strengthening - increasingly safe"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-600",children:"→ stable:"})," Consistent behavior - predictable"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-red-600",children:"↓ weakening:"})," Support deteriorating - increasing risk"]})]})]})]})})]})}),e.jsx(P,{className:"text-right min-w-[130px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("maxConsecutiveBreaks"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{children:"Max Consecutive"}),p==="maxConsecutiveBreaks"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsxs(L,{className:"max-w-xs bg-background border",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Max Consecutive Breaks"}),e.jsx("p",{className:"mb-2",children:"Historical maximum number of consecutive support breaks in any cluster (breaks ≤30 days apart)."}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{children:"0-2: Low cascade risk | 3-5: Normal | 6-10: Elevated | 11+: High risk"}),e.jsx("p",{className:"mt-1",children:"Shows worst-case scenario if stock starts breaking support."})]})]})]})})]})}),e.jsx(P,{className:"text-right min-w-[150px] cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>h("currentConsecutiveBreaks"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{children:"Current Consecutive"}),p==="currentConsecutiveBreaks"&&(j==="asc"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})),e.jsx($,{children:e.jsxs(M,{delayDuration:300,children:[e.jsx(A,{asChild:!0,children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),e.jsxs(L,{className:"max-w-xs bg-background border",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Current Consecutive Breaks"}),e.jsx("p",{className:"mb-2",children:"Number of breaks in most recent active cluster (if ended ≤30 days ago)."}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"0:"})," Support holding normally - safe to write"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"1-2:"})," Minor activity - watch"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3-5:"})," Active cascade - caution"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"6+:"})," Major cascade - high risk"]}),e.jsx("p",{className:"mt-1 text-blue-600",children:"If Current ≥ 80% of Max: likely rebound candidate!"})]})]})]})})]})})]})}),e.jsx(ke,{children:U.map((t,N)=>{var w;const _=f===N,k=d(t.stockName,parseInt(x));return e.jsxs(fe.Fragment,{children:[e.jsxs(X,{className:"hover:bg-muted/50",children:[e.jsx(u,{className:"text-center",children:e.jsx("button",{onClick:()=>C(N),className:"p-1 hover:bg-accent rounded transition-colors","aria-label":_?"Collapse details":"Expand details",children:_?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})})}),e.jsx(u,{className:"font-medium cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>z(t.stockName),children:e.jsx("span",{className:"text-secondary-foreground hover:text-primary transition-colors",children:t.stockName})}),e.jsx(u,{className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>H(t.optionName),children:e.jsx("span",{className:"font-medium text-primary hover:opacity-80 transition-all",children:t.optionName})}),e.jsx(u,{children:e.jsx("button",{onClick:()=>window.open(o(`/consecutive-breaks?stock=${encodeURIComponent(t.stockName)}&period=${x}`),"_blank"),className:"text-primary hover:underline cursor-pointer text-xs",children:"View Analysis"})}),e.jsxs(u,{className:"text-right",children:[t.currentPrice.toFixed(2)," kr"]}),e.jsxs(u,{className:"text-right font-semibold",children:[t.strikePrice.toFixed(2)," kr"]}),e.jsx(u,{className:"text-right",children:t.rollingLow?`${t.rollingLow.toFixed(2)} kr`:"-"}),e.jsx(u,{className:"text-right",children:t.distanceToSupport!==null?`${t.distanceToSupport.toFixed(1)}%`:"-"}),e.jsx(u,{className:"text-right",children:t.strikeVsSupport!==null?e.jsxs("span",{className:t.strikeVsSupport<0?"text-green-600 font-semibold":"",children:[t.strikeVsSupport.toFixed(1),"%"]}):"-"}),e.jsx(u,{className:"text-right",children:t.medianDropPerBreak!==null?`${t.medianDropPerBreak.toFixed(2)}%`:"-"}),e.jsxs(u,{className:"text-right font-semibold text-green-700",children:[t.premium.toFixed(0)," kr"]}),e.jsxs(u,{className:"text-right",children:[(t.powBayesianCalibrated*100).toFixed(1),"%"]}),e.jsxs(u,{className:"text-right",children:[(t.powOriginal*100).toFixed(1),"%"]}),e.jsxs(u,{className:"text-right",children:[t.daysToExpiry,"d"]}),e.jsxs(u,{className:"text-right",children:[t.supportStability.toFixed(1),"%"]}),e.jsx(u,{className:"text-right",children:t.daysSinceLastBreak!==null?`${t.daysSinceLastBreak}d`:"N/A"}),e.jsx(u,{className:"text-right",children:e.jsx("span",{className:t.supportStrengthScore&&t.supportStrengthScore>=70?"text-green-600 font-semibold":t.supportStrengthScore&&t.supportStrengthScore>=50?"text-yellow-600":"text-red-600",children:((w=t.supportStrengthScore)==null?void 0:w.toFixed(1))??"-"})}),e.jsx(u,{children:e.jsx("span",{className:t.patternType==="never_breaks"?"text-green-700 font-semibold":t.patternType==="exhausted_cascade"?"text-blue-600 font-semibold":t.patternType==="shallow_breaker"?"text-green-600":t.patternType==="volatile"?"text-red-600":"text-gray-600",children:t.patternType?t.patternType.replace(/_/g," "):"-"})}),e.jsx(u,{children:e.jsxs("span",{className:t.stabilityTrend==="improving"?"text-green-600":t.stabilityTrend==="weakening"?"text-red-600":"text-gray-600",children:[t.stabilityTrend==="improving"?"↑":t.stabilityTrend==="weakening"?"↓":"→"," ",t.stabilityTrend??"-"]})}),e.jsx(u,{className:"text-right",children:t.maxConsecutiveBreaks??"-"}),e.jsx(u,{className:"text-right",children:e.jsx("span",{className:t.currentConsecutiveBreaks&&t.currentConsecutiveBreaks>0?"text-orange-600 font-semibold":"",children:t.currentConsecutiveBreaks??"0"})})]}),_&&k&&e.jsx(X,{children:e.jsx(u,{colSpan:20,className:"p-0 bg-muted/20",children:e.jsx(Re,{metrics:k,rollingPeriod:parseInt(x)})})})]},N)})})]}),e.jsx(Se,{orientation:"horizontal"})]}):e.jsx(D,{children:e.jsx(B,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"No options match the current criteria. Try relaxing some filters."})})})]})})};export{Ke as SupportBasedOptionFinder,Ke as default};
