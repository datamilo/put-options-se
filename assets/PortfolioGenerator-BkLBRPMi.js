import{u as Ke,j as e,D as Ge,a as Fe,B as L,S as Re,b as ze,d as Ue,e as He,T as qe,f as Le,g as We,h as Me,I as Q,C as le,r as Je,i as Xe,k as Ye,s as Ce,t as Ze,L as U,l as ue,m as me,n as pe,o as Z,v as Qe,w as Ne}from"./index-BVw2Pzxv.js";import{r as y,h as et}from"./router-C0wDHNfv.js";import{u as tt}from"./usePageTitle-CpPgFbZv.js";import{T as at,a as st,b as De,c as Be,d as rt,e as we}from"./table-W_lzODQg.js";import{S as ot,a as it}from"./scroll-area-iYhE9Q-7.js";import{C as lt}from"./checkbox-CYORDKcF.js";import{B as nt}from"./badge-Dph76v7f.js";import{u as ct,a as Ie,D as dt,c as ut,S as mt,v as pt,b as gt,d as ft,s as xt,K as ht,P as yt,e as bt,C as _t,G as Pt,F as Te,f as St}from"./excelExport-BTk_pSYc.js";import{f as vt}from"./numberFormatting-BNPfGtWN.js";import{V as jt,T as Ct,u as Nt}from"./useScoredOptionsData-YnWey_8O.js";import{D as Dt}from"./xlsx-C1AHQ_Pv.js";import{A as wt}from"./arrow-up-down-CgXERPoI.js";import{I as be}from"./info-CIZJMKHd.js";import{u as kt}from"./useEnrichedOptionsData-QELhI0Ua.js";import{u as Vt}from"./useStockData-BWzV3G2_.js";import{C as ke,c as Ve,a as Ae,b as Oe}from"./card-Dh7Q_ijz.js";import{A as Lt}from"./arrow-left-Co53Anaq.js";import"./charts-B8eVsusH.js";import"./info-icon-tooltip-2bLzUggJ.js";import"./index-BAMY2Nnw.js";import"./csv-B1Pu-2A6.js";const $e=()=>{const{portfolioColumnPreferences:v,savePortfolioColumnPreferences:W,isLoading:M}=Ke();return{columnPreferences:v,isLoading:M,saveColumnPreferences:W}},Wt=({column:v,onVisibilityChange:W})=>{const{attributes:M,listeners:O,setNodeRef:a,transform:u,transition:I,isDragging:T}=bt({id:v.key}),P={transform:_t.Transform.toString(u),transition:I,opacity:T?.5:1},k=b=>{const E={"1_2_3_ProbOfWorthless_Weighted":"PoW - Weighted Average",ProbWorthless_Bayesian_IsoCal:"PoW - Bayesian Calibrated","1_ProbOfWorthless_Original":"PoW - Original Black-Scholes","2_ProbOfWorthless_Calibrated":"PoW - Bias Corrected","3_ProbOfWorthless_Historical_IV":"PoW - Historical IV"},R={DaysToExpiry:"Days to Expiry (business days)"},V={EstTotalMargin:"Est. Total Margin",Est_Margin_SEK:"Est. Margin per Contract",Prob_Normal_2SD_Decline_Pct:"Probability Normal 2SD Decline %",Hist_Worst_Decline_Pct:"Historical Worst Decline %",SRI_Base:"SRI Base",Event_Buffer:"Event Buffer",Final_SRI:"Final Safety-Risk Index",OTM_Amount:"OTM Amount",Margin_A_Broker_Proxy:"Margin A Broker Proxy",Margin_B_Historical_Floor:"Margin B Historical Floor",Margin_Floor_15pct:"Margin Floor 15%",Net_Premium_After_Costs:"Net Premium After Costs",Annualized_ROM_Pct:"Annualized Return on Margin %"},B={combined_score:"Combined Score",v21_score:"Probability Score",ta_probability:"TA Probability"};if(E[b])return E[b];if(R[b])return R[b];if(V[b])return V[b];if(B[b])return B[b];const i={IV_2sigma_Decline:"IV 2-Sigma Decline",BreakevenDecline:"Breakeven Decline",CVaR10pct_Decline:"CVaR 10% Decline",LossAtIV2sigmaDecline:"Loss at IV 2-Sigma",LossAtCVaR10pctDecline:"Loss at CVaR 10%"};return i[b]?i[b]:b.replace(/([A-Z])/g," $1").replace(/^./,h=>h.toUpperCase()).replace(/_/g," ")};return e.jsxs("div",{ref:a,style:P,className:"flex items-center space-x-3 p-3 bg-card rounded-lg border hover:bg-accent transition-colors",children:[e.jsx("div",{...M,...O,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-muted rounded",children:e.jsx(Pt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(lt,{checked:v.visible,onCheckedChange:b=>W(!!b),className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:k(v.key)}),e.jsx(nt,{variant:v.visible?"default":"secondary",className:"text-xs",children:v.visible?"Visible":"Hidden"})]})},Mt=({visibleColumns:v,onVisibilityChange:W,onColumnOrderChange:M})=>{const[O,a]=y.useState(!1),{columnPreferences:u,saveColumnPreferences:I,isLoading:T}=$e(),[P,k]=y.useState([]),b=ct(Ie(yt),Ie(ht,{coordinateGetter:xt})),E=["StockName","OptionName","ExpiryDate","DaysToExpiry","StrikePrice","Premium","NumberOfContractsBasedOnLimit","1_2_3_ProbOfWorthless_Weighted","PotentialLossAtLowerBound","EstTotalMargin"],R=()=>["StockName","OptionName","ExpiryDate","FinancialReport","X-Day","Premium","PoW_Simulation_Mean_Earnings","100k_Invested_Loss_Mean","1_2_3_ProbOfWorthless_Weighted","ProbWorthless_Bayesian_IsoCal","1_ProbOfWorthless_Original","2_ProbOfWorthless_Calibrated","3_ProbOfWorthless_Historical_IV","Lower_Bound_at_Accuracy","LossAtBadDecline","LossAtWorstDecline","PoW_Stats_MedianLossPct","PoW_Stats_WorstLossPct","PoW_Stats_MedianLoss","PoW_Stats_WorstLoss","PoW_Stats_MedianProbOfWorthless","PoW_Stats_MinProbOfWorthless","PoW_Stats_MaxProbOfWorthless","LossAt100DayWorstDecline","LossAt_2008_100DayWorstDecline","Mean_Accuracy","Lower_Bound_HistMedianIV_at_Accuracy","Lower_Bound","Lower_Bound_HistMedianIV","Bid_Ask_Mid_Price","Option_Price_Min","NumberOfContractsBasedOnLimit","Bid","ProfitLossPctLeastBad","Loss_Least_Bad","IV_AllMedianIV_Maximum100DaysToExp_Ratio","StockPrice","DaysToExpiry","AskBidSpread","Underlying_Value","StrikePrice","StockPrice_After_2008_100DayWorstDecline","LossAt50DayWorstDecline","LossAt_2008_50DayWorstDecline","ProfitLossPctBad","ProfitLossPctWorst","ProfitLossPct100DayWorst","ImpliedVolatility","TodayStockMedianIV_Maximum100DaysToExp","AllMedianIV_Maximum100DaysToExp","ExpiryDate_Lower_Bound_Minus_Pct_Based_on_Accuracy","StrikeBelowLowerAtAcc","Ask","WorstHistoricalDecline","BadHistoricalDecline","ImpliedVolatilityUntilExpiry","StockPrice_After_100DayWorstDecline","StockPrice_After_50DayWorstDecline","StockPrice_After_2008_50DayWorstDecline","100DayMaxPrice","100DayMaxPriceDate","50DayMaxPrice","50DayMaxPriceDate","Historical100DaysWorstDecline","Historical50DaysWorstDecline","2008_100DaysWorstDecline","2008_50DaysWorstDecline","IV_ClosestToStrike","IV_UntilExpiryClosestToStrike","LowerBoundClosestToStrike","LowerBoundDistanceFromCurrentPrice","LowerBoundDistanceFromStrike","ImpliedDownPct","ToStrikePct","SafetyMultiple","SigmasToStrike","ProbAssignment","SafetyCategory","CushionMinusIVPct","PotentialLossAtLowerBound","EstTotalMargin","Est_Margin_SEK","Prob_Normal_2SD_Decline_Pct","Hist_Worst_Decline_Pct","SRI_Base","Event_Buffer","Final_SRI","OTM_Amount","Margin_A_Broker_Proxy","Margin_B_Historical_Floor","Margin_Floor_15pct","Net_Premium_After_Costs","Annualized_ROM_Pct","IV_2sigma_Decline","BreakevenDecline","CVaR10pct_Decline","LossAtIV2sigmaDecline","LossAtCVaR10pctDecline","combined_score","v21_score","ta_probability"];y.useEffect(()=>{const g=R(),m=new Map(u.map(_=>[_.key,_])),j=g.map((_,z)=>m.get(_)||{key:_,visible:E.includes(_),order:m.size+z});j.sort((_,z)=>{const $=m.has(_.key),J=m.has(z.key);return $&&J?_.order-z.order:$?-1:J?1:_.order-z.order}),k(j)},[u]);const V=g=>{const{active:m,over:j}=g;m.id!==(j==null?void 0:j.id)&&k(_=>{const z=_.findIndex(K=>K.key===m.id),$=_.findIndex(K=>K.key===(j==null?void 0:j.id));return ft(_,z,$).map((K,q)=>({...K,order:q}))})},B=(g,m)=>{k(j=>j.map(_=>_.key===g?{..._,visible:m}:_))},i=async()=>{await I(P);const g=P.filter(m=>m.visible).sort((m,j)=>m.order-j.order).map(m=>m.key);M(g),a(!1)},h=P.filter(g=>g.visible).length;return e.jsxs(Ge,{open:O,onOpenChange:a,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"ml-2",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Portfolio Columns (",h,")"]})}),e.jsxs(ze,{className:"max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(Ue,{children:[e.jsx(He,{children:"Manage Portfolio Table Columns"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag to reorder columns and check/uncheck to show/hide them. These settings are independent from the main options table. Click Save to persist your preferences."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2",children:!T&&P.length>0&&e.jsx(dt,{sensors:b,collisionDetection:ut,onDragEnd:V,children:e.jsx(mt,{items:P.map(g=>g.key),strategy:pt,children:P.sort((g,m)=>g.order-m.order).map(g=>e.jsx(Wt,{column:g,onVisibilityChange:m=>B(g.key,m)},g.key))})})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[h," of ",P.length," columns visible"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(L,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(L,{onClick:i,disabled:T,children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Save Preferences"]})]})]})]})]})},Bt=({data:v,onRowClick:W,onStockClick:M,columnFilters:O=[],onColumnFiltersChange:a=()=>{},sortField:u,sortDirection:I,onSortChange:T,enableFiltering:P=!0,isScoredStrategy:k=!1,selectedProbabilityField:b})=>{const{columnPreferences:E,isLoading:R}=$e(),[V,B]=y.useState([]),[i,h]=y.useState(null),[g,m]=y.useState(new Set),j=y.useRef(null),_=["combined_score","v21_score","ta_probability"],z=["StockName","OptionName","ExpiryDate","DaysToExpiry","StrikePrice","Premium","NumberOfContractsBasedOnLimit","1_2_3_ProbOfWorthless_Weighted","PotentialLossAtLowerBound","EstTotalMargin"],J=["StockName","OptionName","ExpiryDate","DaysToExpiry","StrikePrice","Premium","NumberOfContractsBasedOnLimit",b||"1_2_3_ProbOfWorthless_Weighted",..._];y.useEffect(()=>{if(!R)if(E.length>0){const s=E.filter(n=>n.visible).sort((n,l)=>n.order-l.order).map(n=>n.key);B(s)}else B(k?J:z)},[E,R,k,b]);const K=s=>{m(n=>{const l=new Set(n);return l.has(s)?l.delete(s):l.add(s),l})};y.useEffect(()=>{const s=n=>{j.current&&!j.current.contains(n.target)&&h(null)};if(i&&P)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[i,P]);const q=s=>{if(s==="recalculatedNumberOfContracts")return"Number Of Contracts";const n={IV_ClosestToStrike:"IV Closest To Strike",IV_UntilExpiryClosestToStrike:"IV Until Expiry Closest To Strike",LowerBoundClosestToStrike:"Lower Bound Closest To Strike",LowerBoundDistanceFromCurrentPrice:"Lower Bound Distance From Current Price",LowerBoundDistanceFromStrike:"Lower Bound Distance From Strike",ImpliedDownPct:"Implied Down %",ToStrikePct:"To Strike %",SafetyMultiple:"Safety Multiple",SigmasToStrike:"Sigmas To Strike",ProbAssignment:"Prob Assignment",SafetyCategory:"Safety Category",CushionMinusIVPct:"Cushion Minus IV %",PotentialLossAtLowerBound:"Potential Loss At IV Lower Bound",EstTotalMargin:"Est. Total Margin",Est_Margin_SEK:"Est. Margin per Contract",Prob_Normal_2SD_Decline_Pct:"Probability Normal 2SD Decline %",Hist_Worst_Decline_Pct:"Historical Worst Decline %",SRI_Base:"SRI Base",Event_Buffer:"Event Buffer",Final_SRI:"Final Safety-Risk Index",OTM_Amount:"OTM Amount",Margin_A_Broker_Proxy:"Margin A Broker Proxy",Margin_B_Historical_Floor:"Margin B Historical Floor",Margin_Floor_15pct:"Margin Floor 15%",Net_Premium_After_Costs:"Net Premium After Costs",Annualized_ROM_Pct:"Annualized Return on Margin %",combined_score:"Combined Score",v21_score:"Probability Score",ta_probability:"TA Probability",agreement_strength:"Agreement",IV_2sigma_Decline:"IV 2-Sigma Decline",BreakevenDecline:"Breakeven Decline",CVaR10pct_Decline:"CVaR 10% Decline",LossAtIV2sigmaDecline:"Loss at IV 2-Sigma",LossAtCVaR10pctDecline:"Loss at CVaR 10%"};return n[s]?n[s]:s.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^\w/,l=>l.toUpperCase()).replace(/\b\w/g,l=>l.toUpperCase())},ge=s=>{u===s?T(s,I==="asc"?"desc":"asc"):T(s,"asc")},ne=[...v].sort((s,n)=>{if(!u)return 0;const l=(_.includes(u),s[u]),x=(_.includes(u),n[u]);if(typeof l=="number"&&typeof x=="number")return I==="asc"?l-x:x-l;const p=String(l??"").toLowerCase(),D=String(x??"").toLowerCase();return I==="asc"?p.localeCompare(D):D.localeCompare(p)}),ae=s=>v.length===0?"text":typeof v[0][s]=="number"?"number":"text",fe=P?ne.filter(s=>O.every(n=>{const l=s[n.field];return n.type==="text"?n.textValue?String(l).toLowerCase().includes(n.textValue.toLowerCase()):!0:typeof l!="number"?!0:!(n.minValue!==void 0&&l<n.minValue||n.maxValue!==void 0&&l>n.maxValue)})):ne,se=(s,n)=>{if(!P)return;const l=O,x=l.findIndex(C=>C.field===s),p=ae(s);let D;if(x>=0){const C=[...l];C[x]={...C[x],...n},p==="text"&&!C[x].textValue?D=C.filter((xe,t)=>t!==x):p==="number"&&C[x].minValue===void 0&&C[x].maxValue===void 0?D=C.filter((xe,t)=>t!==x):D=C}else p==="text"&&!n.textValue||p==="number"&&n.minValue===void 0&&n.maxValue===void 0?D=l:D=[...l,{field:s,type:p,...n}];a(D)},_e=s=>O.find(n=>n.field===s),ce=(s,n,l)=>{if(_.includes(n)&&l){const x=l[n];if(x==null||x===void 0)return"-";if(n==="agreement_strength")return String(x);const p=n==="ta_probability"?x*100:x;return vt(p,1)}return Xe(s,n)},Pe=(s,n)=>{n?V.includes(s)||B(l=>[...l,s]):B(l=>l.filter(x=>x!==s))},de=s=>{B(s)},Se=()=>{St({filename:"portfolio_options_data",visibleColumns:V,data:fe})};return e.jsx(qe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[P&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click on column headers to filter"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:Se,className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4"}),"Export to Excel"]}),e.jsx(Mt,{visibleColumns:V,onVisibilityChange:Pe,onColumnOrderChange:de})]})]}),e.jsxs(ot,{className:"w-full whitespace-nowrap rounded-md border",children:[e.jsxs(at,{children:[e.jsx(st,{children:e.jsxs(De,{children:[k&&e.jsx(Be,{className:"w-10 min-w-[40px]"}),V.map(s=>{const n=ae(s),l=_e(s),x=!!l;return e.jsx(Be,{className:s==="StockName"?"w-28 max-w-28":"min-w-[120px]","aria-sort":u===s?I==="asc"?"ascending":"descending":void 0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(L,{variant:"ghost",onClick:()=>ge(s),className:"h-9 px-1 font-medium",title:q(s),children:[q(s)," ",e.jsx(wt,{className:"ml-1 h-3 w-3"})]}),s==="OptionName"&&e.jsxs(Le,{children:[e.jsx(We,{asChild:!0,children:e.jsx(be,{className:"h-3 w-3 text-muted-foreground cursor-help"})}),e.jsx(Me,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"font-medium"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"Financial Report"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Ex-Dividend Day"})]})]})})]}),s==="PotentialLossAtLowerBound"&&e.jsxs(Le,{children:[e.jsx(We,{asChild:!0,children:e.jsx(be,{className:"h-3 w-3 text-muted-foreground cursor-help"})}),e.jsx(Me,{side:"top",align:"center",sideOffset:5,className:"z-[9999] border bg-popover text-popover-foreground shadow-md !max-w-none !w-auto",style:{width:"auto",minWidth:"max-content",maxWidth:"none",whiteSpace:"normal"},children:e.jsxs("div",{className:"text-xs leading-relaxed p-3",style:{width:"auto",minWidth:"max-content"},children:[e.jsx("div",{className:"font-medium mb-2",children:"How this field is calculated:"}),e.jsx("div",{className:"mb-2",children:"This field represents the maximum potential loss if the stock price falls to its IV-based lower bound at expiration."}),e.jsx("div",{className:"mb-2 font-mono text-xs bg-muted/50 p-2 rounded",children:"Premium + (LowerBoundValue Ã— Contracts Ã— 100) - (StrikePrice Ã— Contracts Ã— 100)"}),e.jsx("div",{children:"The lower bound is derived from implied volatility analysis to estimate worst-case scenarios for the option position."})]})})]})]}),P&&e.jsxs("div",{className:"relative",children:[e.jsxs(L,{variant:x?"default":"outline",size:"sm",onClick:()=>h(i===s?null:s),className:"h-9 w-full text-xs",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),x?"Filtered":"Filter"]}),i===s&&e.jsxs("div",{ref:j,className:"absolute top-8 left-0 z-50 bg-background border rounded-md shadow-md p-2 min-w-48",children:[n==="text"?e.jsx(Q,{placeholder:"Search...","aria-label":`Search ${q(s)}`,value:(l==null?void 0:l.textValue)||"",onChange:p=>se(s,{textValue:p.target.value.slice(0,100)}),className:"h-8",maxLength:100,autoFocus:!0}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{type:"number",placeholder:"Min value","aria-label":`Minimum ${q(s)}`,value:(l==null?void 0:l.minValue)||"",onChange:p=>{const D=p.target.value,C=D?parseFloat(D):void 0;(C===void 0||!isNaN(C)&&isFinite(C))&&se(s,{minValue:C})},className:"h-8"}),e.jsx(Q,{type:"number",placeholder:"Max value","aria-label":`Maximum ${q(s)}`,value:(l==null?void 0:l.maxValue)||"",onChange:p=>{const D=p.target.value,C=D?parseFloat(D):void 0;(C===void 0||!isNaN(C)&&isFinite(C))&&se(s,{maxValue:C})},className:"h-8"})]}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>{se(s,n==="text"?{textValue:""}:{minValue:void 0,maxValue:void 0}),h(null)},className:"mt-2 h-9 w-full text-xs",children:"Clear"})]})]})]})},s)})]})}),e.jsx(rt,{children:fe.map((s,n)=>{const l=k&&g.has(s.OptionName),x=s.scoredData;return e.jsxs(e.Fragment,{children:[e.jsxs(De,{className:"hover:bg-muted/50",children:[k&&e.jsx(we,{className:"w-10 min-w-[40px] p-1",children:x&&e.jsx(L,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>K(s.OptionName),children:l?e.jsx(le,{className:"h-4 w-4"}):e.jsx(Je,{className:"h-4 w-4"})})}),V.map(p=>{const D=()=>p!=="OptionName"?"":s.FinancialReport==="Y"?"text-orange-600 dark:text-orange-400":s["X-Day"]&&String(s["X-Day"]).toUpperCase()==="Y"?"text-red-600 dark:text-red-400":"text-primary";return e.jsx(we,{className:`${p==="StockName"?"w-28 max-w-28 truncate":"min-w-[120px]"} ${p==="OptionName"||p==="StockName"?"cursor-pointer hover:bg-accent/50 transition-colors":""}`,onClick:p==="OptionName"?()=>W==null?void 0:W(s):p==="StockName"?()=>M==null?void 0:M(s.StockName):void 0,children:p==="OptionName"?e.jsx("span",{className:`font-medium ${D()} hover:opacity-80 transition-all`,children:ce(s[p],p,s)}):p==="StockName"?e.jsx("span",{className:"font-medium text-secondary-foreground hover:text-primary transition-colors",children:ce(s[p],p,s)}):ce(s[p],p,s)},p)})]},`${s.StockName}-${s.OptionName}-${n}`),l&&x&&e.jsx(De,{children:e.jsx(we,{colSpan:V.length+1,className:"p-4 bg-muted/30",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 whitespace-normal",children:[e.jsx(jt,{option:x}),e.jsx(Ct,{option:x})]})})},`${s.OptionName}-detail`)]})})})]}),e.jsx(it,{orientation:"horizontal"})]})]})})},Ee={totalPremiumTarget:500,strikeBelowPeriod:null,minProbabilityWorthless:null,maxProbabilityWorthless:null,selectedExpiryDate:"",portfolioUnderlyingValue:1e5,selectedProbabilityField:"ProbWorthless_Bayesian_IsoCal",optimizationStrategy:"returns",v21Weight:50,maxTotalCapital:null,excludedStocks:[],generatedPortfolio:[],portfolioGenerated:!1,totalUnderlyingValue:0,portfolioMessage:"",totalPotentialLoss:0},It=()=>{const{user:v}=Ye(),[W,M]=y.useState(Ee),[O,a]=y.useState(!0),[u,I]=y.useState(!1),[T,P]=y.useState(!1);y.useEffect(()=>{(()=>{const h={totalPremiumTarget:parseInt(localStorage.getItem("portfolioGenerator_totalPremiumTarget")||"500"),strikeBelowPeriod:localStorage.getItem("portfolioGenerator_strikeBelowPeriod")?parseInt(localStorage.getItem("portfolioGenerator_strikeBelowPeriod")):null,minProbabilityWorthless:localStorage.getItem("portfolioGenerator_minProbabilityWorthless")?parseInt(localStorage.getItem("portfolioGenerator_minProbabilityWorthless")):null,maxProbabilityWorthless:localStorage.getItem("portfolioGenerator_maxProbabilityWorthless")?parseInt(localStorage.getItem("portfolioGenerator_maxProbabilityWorthless")):null,selectedExpiryDate:localStorage.getItem("portfolioGenerator_selectedExpiryDate")||"",portfolioUnderlyingValue:parseInt(localStorage.getItem("portfolioGenerator_underlyingStockValue")||"100000"),selectedProbabilityField:localStorage.getItem("portfolioGenerator_selectedProbabilityField")||"ProbWorthless_Bayesian_IsoCal",optimizationStrategy:localStorage.getItem("portfolioGenerator_optimizationStrategy")||"returns",v21Weight:parseInt(localStorage.getItem("portfolioGenerator_v21Weight")||"50"),maxTotalCapital:localStorage.getItem("portfolioGenerator_maxTotalCapital")?parseInt(localStorage.getItem("portfolioGenerator_maxTotalCapital")):null,excludedStocks:localStorage.getItem("portfolioGenerator_excludedStocks")?JSON.parse(localStorage.getItem("portfolioGenerator_excludedStocks")):[],generatedPortfolio:localStorage.getItem("portfolioGenerator_generatedPortfolio")?JSON.parse(localStorage.getItem("portfolioGenerator_generatedPortfolio")):[],portfolioGenerated:localStorage.getItem("portfolioGenerator_portfolioGenerated")==="true",totalUnderlyingValue:parseInt(localStorage.getItem("portfolioGenerator_totalUnderlyingValue")||"0"),portfolioMessage:localStorage.getItem("portfolioGenerator_portfolioMessage")||"",totalPotentialLoss:parseFloat(localStorage.getItem("portfolioGenerator_totalPotentialLoss")||"0")};M(h)})(),a(!1)},[]),y.useEffect(()=>{v&&!u&&!T&&k()},[v,u,T]);const k=async()=>{if(!(!v||u||T))try{const{data:i,error:h}=await Ce.from("user_preferences").select("preference_data").eq("user_id",v.id).eq("preference_type","portfolio_generator").maybeSingle();if(h){console.error("Error loading portfolio generator preferences:",h),P(!0);return}if(i!=null&&i.preference_data){const g=i.preference_data;g.portfolioUnderlyingValue&&g.portfolioUnderlyingValue>=1e4&&g.portfolioUnderlyingValue<=1e6&&(M(g),b(g))}P(!0)}catch(i){console.error("Error loading portfolio generator preferences:",i),P(!0)}},b=i=>{var h,g,m,j;console.log("ðŸ’¾ Saving to localStorage:",{portfolioUnderlyingValue:i.portfolioUnderlyingValue}),localStorage.setItem("portfolioGenerator_totalPremiumTarget",i.totalPremiumTarget.toString()),localStorage.setItem("portfolioGenerator_strikeBelowPeriod",((h=i.strikeBelowPeriod)==null?void 0:h.toString())||""),localStorage.setItem("portfolioGenerator_minProbabilityWorthless",((g=i.minProbabilityWorthless)==null?void 0:g.toString())||""),localStorage.setItem("portfolioGenerator_maxProbabilityWorthless",((m=i.maxProbabilityWorthless)==null?void 0:m.toString())||""),localStorage.setItem("portfolioGenerator_selectedExpiryDate",i.selectedExpiryDate),localStorage.setItem("portfolioGenerator_underlyingStockValue",i.portfolioUnderlyingValue.toString()),localStorage.setItem("portfolioGenerator_selectedProbabilityField",i.selectedProbabilityField),localStorage.setItem("portfolioGenerator_optimizationStrategy",i.optimizationStrategy),localStorage.setItem("portfolioGenerator_v21Weight",i.v21Weight.toString()),localStorage.setItem("portfolioGenerator_maxTotalCapital",((j=i.maxTotalCapital)==null?void 0:j.toString())||""),localStorage.setItem("portfolioGenerator_excludedStocks",JSON.stringify(i.excludedStocks)),localStorage.setItem("portfolioGenerator_generatedPortfolio",JSON.stringify(i.generatedPortfolio)),localStorage.setItem("portfolioGenerator_portfolioGenerated",i.portfolioGenerated.toString()),localStorage.setItem("portfolioGenerator_totalUnderlyingValue",i.totalUnderlyingValue.toString()),localStorage.setItem("portfolioGenerator_portfolioMessage",i.portfolioMessage),localStorage.setItem("portfolioGenerator_totalPotentialLoss",i.totalPotentialLoss.toString())},E=async i=>{if(console.log("ðŸ’¾ Saving settings:",{portfolioUnderlyingValue:i.portfolioUnderlyingValue}),M(i),b(i),v)try{const{error:h}=await Ce.from("user_preferences").upsert({user_id:v.id,preference_type:"portfolio_generator",preference_data:i},{onConflict:"user_id,preference_type"});h?console.error("Error saving portfolio generator preferences:",h):console.log("âœ… Successfully saved to Supabase")}catch(h){console.error("Error saving portfolio generator preferences:",h)}};return{settings:W,isLoading:O,updateSetting:(i,h)=>{const g={...W,[i]:h};E(g)},updateMultipleSettings:i=>{const h={...W,...i};E(h)},saveSettings:E,resetToDefaults:()=>{I(!0),P(!1);const i={...Ee,portfolioUnderlyingValue:1e5,totalPremiumTarget:500};M(i),b(i),v?Ce.from("user_preferences").delete().eq("user_id",v.id).eq("preference_type","portfolio_generator").then(()=>{I(!1)}):I(!1)}}},sa=()=>{var p,D,C,xe;tt("Portfolio Generator");const v=et(),{data:W}=kt(),{getLowPriceForPeriod:M}=Vt(),{transactionCost:O}=Ze(),{settings:a,updateSetting:u,updateMultipleSettings:I}=It(),{data:T}=Nt(),P=y.useMemo(()=>{const t=new Map;if(T)for(const c of T)t.set(c.option_name,c);return t},[T]),[k,b]=y.useState(!1),[E,R]=y.useState(a.totalPremiumTarget.toString()),[V,B]=y.useState(a.portfolioUnderlyingValue.toString()),[i,h]=y.useState(((p=a.maxTotalCapital)==null?void 0:p.toString())||"");y.useEffect(()=>{var o;R(a.totalPremiumTarget.toString());const t=parseInt(V)||0,c=a.portfolioUnderlyingValue;t!==c&&B(c.toString()),h(((o=a.maxTotalCapital)==null?void 0:o.toString())||"")},[a]);const g=(t,c)=>t.map(o=>{const S=Math.round(c/o.StrikePrice/100),H=(o.Bid+(o.Ask||o.Bid))/2,G=Math.round(H*S*100-O),ve=S*o.StrikePrice*100,F=Y=>{if(Y==null)return;const oe=o.StockPrice*(1+Y);return Math.min(0,(oe-o.StrikePrice)*S*100)},ee=F(o.BadHistoricalDecline)??o.LossAtBadDecline,X=F(o.WorstHistoricalDecline)??o.LossAtWorstDecline,he=F(o.Historical100DaysWorstDecline)??o.LossAt100DayWorstDecline,je=F(o["2008_100DaysWorstDecline"])??o.LossAt_2008_100DayWorstDecline,te=F(o.Historical50DaysWorstDecline)??o.LossAt50DayWorstDecline,ye=F(o["2008_50DaysWorstDecline"])??o.LossAt_2008_50DayWorstDecline,r=Math.max(ee,X,he),d=F(o.IV_2sigma_Decline)??null,f=F(o.CVaR10pct_Decline)??null;let N=o.PotentialLossAtLowerBound??null;const w=o.LowerBoundClosestToStrike;if(w){const Y=o.StrikePrice*S*100,ie=S*w*100-Y;N=G+ie,N>=0?N=0:N=N-(N*75e-6+O)}let A=o.EstTotalMargin??null;const re=o.Est_Margin_SEK;return re&&(A=Math.round(re*S)),{...o,originalPremium:o.Premium,recalculatedPremium:G,recalculatedNumberOfContracts:S,recalculatedBid_Ask_Mid_Price:H,Premium:G,NumberOfContractsBasedOnLimit:S,Bid_Ask_Mid_Price:H,Underlying_Value:ve,LossAtBadDecline:ee,LossAtWorstDecline:X,LossAt100DayWorstDecline:he,LossAt_2008_100DayWorstDecline:je,LossAt50DayWorstDecline:te,LossAt_2008_50DayWorstDecline:ye,Loss_Least_Bad:r,LossAtIV2sigmaDecline:d,LossAtCVaR10pctDecline:f,PotentialLossAtLowerBound:N,EstTotalMargin:A}}),m=y.useMemo(()=>g(W||[],a.portfolioUnderlyingValue),[W,a.portfolioUnderlyingValue,O]),[j,_]=y.useState(null),[z,$]=y.useState("asc"),[J,K]=y.useState(!1),q=t=>{j===t?$(z==="asc"?"desc":"asc"):(_(t),$("asc"))},ge=[{label:"1 Week Low",days:7},{label:"1 Month Low",days:30},{label:"3 Months Low",days:90},{label:"6 Months Low",days:180},{label:"9 Months Low",days:270},{label:"1 Year Low",days:365}],ne=[{value:"ProbWorthless_Bayesian_IsoCal",label:"PoW - Bayesian Calibrated"},{value:"1_2_3_ProbOfWorthless_Weighted",label:"PoW - Weighted Average"},{value:"1_ProbOfWorthless_Original",label:"PoW - Original Black-Scholes"},{value:"2_ProbOfWorthless_Calibrated",label:"PoW - Bias Corrected"},{value:"3_ProbOfWorthless_Historical_IV",label:"PoW - Historical IV"}],ae=[{value:"returns",label:"Maximize Returns",description:"Prioritize highest risk-adjusted returns"},{value:"capital",label:"Minimize Capital",description:"Prioritize lowest capital requirements"},{value:"balanced",label:"Balanced",description:"Balance returns and capital efficiency"},{value:"scored",label:"Scored Models",description:"Rank by V2.1 + TA model scores"}],fe=y.useMemo(()=>[...new Set(m.map(t=>t.ExpiryDate))].sort(),[m]),se=y.useMemo(()=>[...new Set(m.map(t=>t.StockName))].sort(),[m]),_e=t=>{const c=parseInt(t)||500,o=Math.max(500,Math.min(1e6,c));u("totalPremiumTarget",o),R(o.toString())},ce=t=>{B(t)},Pe=()=>{if(k)return;const t=parseInt(V)||1e4,c=Math.max(1e4,Math.min(1e6,t));u("portfolioUnderlyingValue",c),B(c.toString()),console.log("ðŸ“ Portfolio Generator - Saved underlying value:",c),a.portfolioGenerated&&I({generatedPortfolio:[],portfolioGenerated:!1,portfolioMessage:"",totalPotentialLoss:0,totalUnderlyingValue:0,portfolioUnderlyingValue:c})},de=t=>{const c=t[a.selectedProbabilityField],o=t["1_2_3_ProbOfWorthless_Weighted"];return(c==null||isNaN(c))&&(o==null||isNaN(o))?null:c||o||0},Se=t=>{if(de(t)===null)return!1;const o=t.PotentialLossAtLowerBound;return!(o==null||isNaN(o)||!t.NumberOfContractsBasedOnLimit||t.NumberOfContractsBasedOnLimit<=0)},s=t=>{const c=t||a.portfolioUnderlyingValue;if(!m||m.length===0){u("portfolioMessage","No options data available for portfolio generation");return}b(!0),Ne({title:"Generating Portfolio",description:"Analyzing options and building your portfolio..."}),setTimeout(()=>{var o;try{const S=[],H=new Set;let G=0;const ve=g(W||[],c),F=a.optimizationStrategy==="scored";let ee=ve.filter(r=>{if(F&&!P.has(r.OptionName)||!F&&!Se(r)||F&&(!r.NumberOfContractsBasedOnLimit||r.NumberOfContractsBasedOnLimit<=0)||r.Premium<=0||a.excludedStocks.includes(r.StockName))return!1;if(a.strikeBelowPeriod){const d=M(r.StockName,a.strikeBelowPeriod);if(!d||r.StrikePrice>d)return!1}if(a.selectedExpiryDate&&r.ExpiryDate!==a.selectedExpiryDate)return!1;if(a.minProbabilityWorthless||a.maxProbabilityWorthless){const d=de(r);if(d===null)return!1;if(a.minProbabilityWorthless){const f=a.minProbabilityWorthless/100;if(d<f)return!1}if(a.maxProbabilityWorthless){const f=a.maxProbabilityWorthless/100;if(d>f)return!1}}return!0});ee.forEach(r=>{const d=r.NumberOfContractsBasedOnLimit*r.StrikePrice*100;if(r.capitalRequired=d,F){const f=P.get(r.OptionName),N=f.v21_score??0,w=(f.ta_probability??0)*100,A=a.v21Weight/100,re=A*N+(1-A)*w;r.scoredData=f,r.combined_score=f.combined_score,r.v21_score=f.v21_score,r.ta_probability=f.ta_probability,r.agreement_strength=f.agreement_strength,r.finalScore=re}else{const f=de(r),N=Math.abs(r.PotentialLossAtLowerBound),w=r.Premium,A=w-(1-f)*N,re=d>0?A/d:0,Y=d>0?A/d:0,oe=N>0?w/N*f:f;let ie=0;a.optimizationStrategy==="returns"?ie=oe:a.optimizationStrategy==="capital"?ie=Y*(f*2):ie=oe*.6+Y*.4,r.expectedValue=A,r.expectedValuePerCapital=re,r.capitalEfficiencyScore=Y,r.riskAdjustedScore=oe,r.finalScore=ie}}),ee.sort((r,d)=>{const f=r.finalScore||0,N=d.finalScore||0;if(N!==f)return N-f;if(a.optimizationStrategy==="capital"){const w=r.capitalRequired||0,A=d.capitalRequired||0;if(w!==A)return w-A}else{const w=r.expectedValuePerCapital||0,A=d.expectedValuePerCapital||0;if(A!==w)return A-w}return d.Premium-r.Premium});let X=0;for(const r of ee){if(H.has(r.StockName))continue;const d=r.capitalRequired||0,f=X+d,N=G+r.Premium<=a.totalPremiumTarget,w=!a.maxTotalCapital||f<=a.maxTotalCapital;N&&w&&(S.push(r),H.add(r.StockName),G+=r.Premium,X=f)}if(G<a.totalPremiumTarget){const r=ee.filter(d=>{const f=d.capitalRequired||0,N=!H.has(d.StockName)&&d.Premium<=a.totalPremiumTarget-G,w=!a.maxTotalCapital||X+f<=a.maxTotalCapital;return N&&w});for(const d of r){const f=d.capitalRequired||0,N=G+d.Premium<=a.totalPremiumTarget,w=!a.maxTotalCapital||X+f<=a.maxTotalCapital;N&&w&&(S.push(d),H.add(d.StockName),G+=d.Premium,X+=f)}}const he=S.reduce((r,d)=>r+d.NumberOfContractsBasedOnLimit*d.StrikePrice*100,0),je=S.reduce((r,d)=>{const f=d.PotentialLossAtLowerBound||0;return r+f},0);let te="";if(G<a.totalPremiumTarget){const r=a.totalPremiumTarget-G;te=`Portfolio generated with ${G.toLocaleString("sv-SE")} SEK premium (${r.toLocaleString("sv-SE")} SEK below target). `}else te=`Portfolio successfully generated with ${G.toLocaleString("sv-SE")} SEK premium.`;const ye=(o=ae.find(r=>r.value===a.optimizationStrategy))==null?void 0:o.label;if(F)te+=` Strategy: ${ye} (V2.1: ${a.v21Weight}% / TA: ${100-a.v21Weight}%).`;else{const r=S.length>0?S.reduce((d,f)=>d+(f.capitalEfficiencyScore||0),0)/S.length:0;te+=` Strategy: ${ye}. Avg Capital Efficiency: ${(r*100).toFixed(2)}%.`}I({generatedPortfolio:S,portfolioGenerated:!0,portfolioMessage:te,totalUnderlyingValue:he,totalPotentialLoss:je,portfolioUnderlyingValue:c}),Ne({title:"Portfolio Generated",description:`Successfully created portfolio with ${S.length} options.`})}catch(S){u("portfolioMessage",`Error generating portfolio: ${S}`),Ne({title:"Error",description:"Failed to generate portfolio. Please try again.",variant:"destructive"})}finally{b(!1)}},100)},n=t=>{const c=encodeURIComponent(t.OptionName),S=window.location.pathname.includes("/put-options-se")?"/put-options-se":"",H=`${window.location.origin}${S}/option/${c}`;window.open(H,"_blank")},l=t=>{const o=window.location.pathname.includes("/put-options-se")?"/put-options-se":"",S=`${window.location.origin}${o}/stock/${encodeURIComponent(t)}`;window.open(S,"_blank")},x=()=>{v("/")};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(L,{variant:"ghost",onClick:x,className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-4 w-4"}),"Back to Options"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Automatic Portfolio Generator"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>K(!J),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(be,{className:"h-4 w-4"}),"How it works"]}),e.jsxs(Ge,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(L,{variant:"ghost",size:"sm",title:"Learn what PoW means and about the probability methods",className:"gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"PoW ?"})]})}),e.jsxs(ze,{className:"max-w-md",children:[e.jsx(Ue,{children:e.jsx(He,{children:"PoW Legend"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"What is PoW?"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"PoW = Probability of Worthless"})," â€” The probability that an option will expire worthless (meaning you keep the premium)."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"The 5 Calculation Methods"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-2 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Weighted Average:"})," Weighted combination of methods"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Bayesian Calibrated:"})," Bayesian probability calibration"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Original Black-Scholes:"})," Classic Black-Scholes model"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Bias Corrected:"})," Calibrated with bias correction"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Historical IV:"})," Based on historical implied volatility"]})]})]})]})]})]})]})]}),J&&e.jsx(ke,{className:"border-muted bg-muted/20",children:e.jsx(Ve,{className:"pt-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["The Portfolio Generator evaluates each option and ranks them based on your selected optimization strategy, then automatically selects a diversified set (one option per stock). ",e.jsx("strong",{children:"Maximize Returns"})," prioritizes highest risk-adjusted returns. ",e.jsx("strong",{children:"Minimize Capital"})," prioritizes lowest capital requirements while maintaining quality. ",e.jsx("strong",{children:"Balanced"})," optimizes for both return and capital efficiency.",e.jsx("strong",{children:"Scored Models"})," ranks options using a weighted blend of the V2.1 Probability Optimization and TA V3 Technical Analysis model scores."]})})}),e.jsxs(ke,{children:[e.jsx(Ae,{children:e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"Portfolio Configuration"]})}),e.jsxs(Ve,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"totalPremium",children:"Total Portfolio Premium"}),e.jsx(Q,{id:"totalPremium",type:"number",value:E,onChange:t=>R(t.target.value),onBlur:t=>_e(t.target.value),placeholder:"500 - 1 000 000"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Range: 500 - 1 000 000 SEK"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"underlyingValue",children:"Underlying Stock Value Per Option"}),e.jsx(Q,{id:"underlyingValue",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:V,onChange:t=>ce(t.target.value),onBlur:Pe,placeholder:"10 000 - 1 000 000",className:"text-left"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Range: 10 000 - 1 000 000 SEK"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Strike Price Below"}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"w-full justify-between",children:[a.strikeBelowPeriod===null?"Select Period (Optional)":(D=ge.find(t=>t.days===a.strikeBelowPeriod))==null?void 0:D.label,e.jsx(le,{className:"h-4 w-4"})]})}),e.jsxs(pe,{className:"w-full bg-background z-50",children:[e.jsx(Z,{onClick:()=>{u("strikeBelowPeriod",null)},children:"No Filter"}),ge.map(t=>e.jsx(Z,{onClick:()=>{u("strikeBelowPeriod",t.days)},children:t.label},t.days))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"minProbability",children:"Minimum Probability of Worthless (%)"}),e.jsx(Q,{id:"minProbability",type:"number",min:"40",max:"100",value:a.minProbabilityWorthless||"",onChange:t=>{const c=t.target.value?parseInt(t.target.value):null;u("minProbabilityWorthless",c)},placeholder:"40-100% (Optional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"maxProbability",children:"Maximum Probability of Worthless (%)"}),e.jsx(Q,{id:"maxProbability",type:"number",min:"40",max:"100",value:a.maxProbabilityWorthless||"",onChange:t=>{const c=t.target.value?parseInt(t.target.value):null;u("maxProbabilityWorthless",c)},placeholder:"40-100% (Optional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Probability Field to Use"}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"w-full justify-between",children:[((C=ne.find(t=>t.value===a.selectedProbabilityField))==null?void 0:C.label)||"Select Field",e.jsx(le,{className:"h-4 w-4"})]})}),e.jsx(pe,{className:"w-full bg-background z-50",children:ne.map(t=>e.jsx(Z,{onClick:()=>{u("selectedProbabilityField",t.value)},children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Expiry Date"}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"w-full justify-between",children:[a.selectedExpiryDate||"Select Expiry Date (Optional)",e.jsx(le,{className:"h-4 w-4"})]})}),e.jsxs(pe,{className:"w-full bg-background z-50 max-h-[200px] overflow-y-auto",children:[e.jsx(Z,{onClick:()=>{u("selectedExpiryDate","")},children:"All Expiry Dates"}),fe.map(t=>e.jsx(Z,{onClick:()=>{u("selectedExpiryDate",t)},children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Optimization Strategy"}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"w-full justify-between",children:[((xe=ae.find(t=>t.value===a.optimizationStrategy))==null?void 0:xe.label)||"Select Strategy",e.jsx(le,{className:"h-4 w-4"})]})}),e.jsx(pe,{className:"w-full bg-background z-50",children:ae.map(t=>e.jsx(Z,{onClick:()=>{u("optimizationStrategy",t.value)},children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.description})]})},t.value))})]})]}),a.optimizationStrategy==="scored"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Model Weight"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["V2.1: ",a.v21Weight,"%"]}),e.jsxs("span",{children:["TA: ",100-a.v21Weight,"%"]})]}),e.jsx(Qe,{value:[a.v21Weight],onValueChange:([t])=>u("v21Weight",t),min:0,max:100,step:5}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"V2.1 Probability"}),e.jsx("span",{children:"TA Technical"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"maxCapital",children:"Maximum Total Capital (Optional)"}),e.jsx(Q,{id:"maxCapital",type:"number",value:i,onChange:t=>h(t.target.value),onBlur:t=>{const c=t.target.value?parseInt(t.target.value):null;u("maxTotalCapital",c)},placeholder:"e.g., 5 000 000 SEK"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Limits total underlying value across all options"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:"Exclude Stocks"}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"w-full justify-between",children:[a.excludedStocks.length>0?`${a.excludedStocks.length} stock(s) excluded`:"No stocks excluded",e.jsx(le,{className:"h-4 w-4"})]})}),e.jsxs(pe,{className:"w-full bg-background z-50 max-h-[200px] overflow-y-auto",children:[e.jsx(Z,{onClick:()=>{u("excludedStocks",[])},children:"Clear All Exclusions"}),se.map(t=>e.jsxs(Z,{onClick:()=>{const c=a.excludedStocks.includes(t)?a.excludedStocks.filter(o=>o!==t):[...a.excludedStocks,t];u("excludedStocks",c)},children:[a.excludedStocks.includes(t)?"âœ“ ":"",t]},t))]})]}),a.excludedStocks.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Excluded: ",a.excludedStocks.join(", ")]})]})]}),e.jsx(L,{onClick:()=>{const t=parseInt(V)||1e5,c=Math.max(1e4,Math.min(1e6,t));!m||m.length===0||s(c)},disabled:k||!m||m.length===0,type:"button",className:"w-full md:w-auto",size:"lg",children:k?"Generating...":"Generate Portfolio Automatically"})]})]}),a.portfolioGenerated&&e.jsxs(ke,{children:[e.jsx(Ae,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(Oe,{children:["Generated Portfolio (",a.generatedPortfolio.length," options)"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1 mt-2",children:[e.jsx("p",{children:a.portfolioMessage}),e.jsxs("p",{children:["Total Underlying Stock Value: ",a.totalUnderlyingValue.toLocaleString("sv-SE")," SEK"]}),e.jsxs("p",{children:["Total Premium: ",a.generatedPortfolio.reduce((t,c)=>t+c.Premium,0).toLocaleString("sv-SE")," SEK (Based on ",a.portfolioUnderlyingValue.toLocaleString("sv-SE")," SEK underlying value, ",O," SEK transaction cost per option included)"]}),e.jsxs("p",{children:["Total Calculated Risk of Loss: ",Math.round(a.totalPotentialLoss).toLocaleString("sv-SE")," SEK"]})]})]})})}),e.jsx(Ve,{children:e.jsx(Bt,{data:a.generatedPortfolio,onRowClick:n,onStockClick:l,sortField:j,sortDirection:z,onSortChange:q,enableFiltering:!1,isScoredStrategy:a.optimizationStrategy==="scored",selectedProbabilityField:a.selectedProbabilityField})})]})]})};export{sa as default};
