import{r as D}from"./router-C0wDHNfv.js";import{P as K}from"./csv-B1Pu-2A6.js";const z=()=>{const[w,M]=D.useState([]),[v,d]=D.useState(!0),[F,p]=D.useState(null);D.useEffect(()=>{A()},[]);const A=async()=>{try{d(!0),p(null);const r=[`https://raw.githubusercontent.com/datamilo/put-options-se/main/data/stock_data.csv?${Date.now()}`,`${window.location.origin}/put-options-sedata/stock_data.csv?${Date.now()}`];let t=null,a=null;for(const e of r)try{if(console.log("ðŸ”— Trying stock data URL:",e),a=await fetch(e),a.ok){console.log("âœ… Successfully loaded CSV from:",e);break}}catch(n){console.warn("âŒ Failed to load from:",e,n),t=n}if(!a||!a.ok)throw t||new Error("Failed to load stock data from any URL");const s=await a.text();K.parse(s,{header:!0,delimiter:"|",skipEmptyLines:!0,transform:(e,n)=>n==="open"||n==="high"||n==="low"||n==="close"||n==="volume"||n==="pct_change_close"?e===""||e===null||e===void 0?n==="volume"?0:null:parseFloat(e):e,complete:e=>{console.log("Raw CSV data loaded:",e.data.slice(0,5)),console.log("Total rows loaded:",e.data.length);const n=e.data.filter(l=>l.name==="AAK AB");console.log("AAK AB data found:",n.length,"rows"),console.log("Latest AAK AB entries:",n.slice(-5)),M(e.data),d(!1)},error:e=>{console.error("Error parsing CSV:",e),p("Failed to parse stock data"),d(!1)}})}catch(r){console.error("Error loading stock data:",r),p("Failed to load stock data"),d(!1)}},h=r=>w.filter(t=>t.name===r).sort((t,a)=>new Date(t.date).getTime()-new Date(a.date).getTime());return{allStockData:w,isLoading:v,error:F,getStockData:h,getStockSummary:r=>{const t=h(r);if(t.length===0)return null;console.log(`Stock data for ${r}:`,t.slice(-5)),console.log(`Latest data for ${r}:`,t[t.length-1]);const a=t[t.length-1],s=t[t.length-2],e=s?a.close-s.close:0,n=s?e/s.close*100:0,l=new Date(a.date),i=new Date(l),y=i.getDay(),T=y===0?6:y-1;i.setDate(i.getDate()-T),i.setHours(0,0,0,0);const f=t.filter(o=>new Date(o.date)<i).sort((o,c)=>new Date(c.date).getTime()-new Date(o.date).getTime())[0],C=f?(a.close-f.close)/f.close*100:0,L=new Date(l.getFullYear(),l.getMonth(),1),k=t.filter(o=>new Date(o.date)<L).sort((o,c)=>new Date(c.date).getTime()-new Date(o.date).getTime())[0],E=k?(a.close-k.close)/k.close*100:0,Y=new Date(l.getFullYear(),0,1),S=t.filter(o=>new Date(o.date)<Y).sort((o,c)=>new Date(c.date).getTime()-new Date(o.date).getTime())[0],x=S?(a.close-S.close)/S.close*100:0,P=new Date;P.setFullYear(P.getFullYear()-1);const u=t.filter(o=>new Date(o.date)>=P),R=u.map(o=>o.high),W=u.map(o=>o.low),$=Math.max(...R),q=Math.min(...W),m=u.slice(1).map((o,c)=>(o.close-u[c].close)/u[c].close),O=m.reduce((o,c)=>o+c,0)/m.length,V=m.reduce((o,c)=>o+Math.pow(c-O,2),0)/m.length,_=Math.sqrt(V)*Math.sqrt(252)*100,g=u.map(o=>o.volume).sort((o,c)=>o-c),B=g.length%2===0?(g[g.length/2-1]+g[g.length/2])/2:g[Math.floor(g.length/2)];return{name:r,currentPrice:a.close,priceChange:e,priceChangePercent:n,priceChangePercentWeek:C,priceChangePercentMonth:E,priceChangePercentYear:x,volume:a.volume,medianVolume:B,highPrice52Week:$,lowPrice52Week:q,volatility:_}},getLowPriceForPeriod:(r,t)=>{const a=h(r);if(a.length===0)return null;const s=new Date;s.setDate(s.getDate()-t);const e=a.filter(l=>new Date(l.date)>=s);if(e.length===0)return null;const n=e.map(l=>l.low);return Math.min(...n)},getPriceRangeForPeriod:(r,t)=>{const a=h(r);if(a.length===0)return null;const s=new Date;s.setDate(s.getDate()-t);const e=a.filter(i=>new Date(i.date)>=s);if(e.length===0)return null;const n=e.map(i=>i.high),l=e.map(i=>i.low);return{high:Math.max(...n),low:Math.min(...l)}},loadStockData:A,getAllStockNames:()=>Array.from(new Set(w.map(t=>t.name))).filter(t=>t&&t.trim()!=="").sort()}};export{z as u};
