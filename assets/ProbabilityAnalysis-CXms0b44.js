import{c as Q,j as e,L as P,J as K,D as ee,a as te,B as se,b as ae,d as re,e as oe,K as H,V as ie,U as le,_ as F,C as ne}from"./index-Bzb4F3kx.js";import{r as g,R as I,h as ce,L as de}from"./router-C0wDHNfv.js";import{u as he,D as q}from"./data-timestamp-DWnCNA-w.js";import{n as me,u as xe}from"./useProbabilityRecoveryData-5JhFCbWq.js";import{P as ue}from"./csv-B1Pu-2A6.js";import{C as w,a as U,b as G,c as A}from"./card-WXtfKUg2.js";import{S as M,a as R,b as O,c as L,d as B,C as pe}from"./select-WonCfv9o.js";import{R as be,B as ge,C as je,X as fe,Y as ye,T as ve,L as Ne,b as Z}from"./charts-B8eVsusH.js";import{P as Ce}from"./react-plotly-BZSA8xH3.js";import{A as X}from"./arrow-up-down-nlnHjzKT.js";import{a as ke,f as Y,b as T}from"./numberFormatting-BNPfGtWN.js";import{L as Se,B as we,a as Ee,b as J,c as Ae,d as De,e as _e}from"./breadcrumb-wUG6xl80.js";import{I as Te}from"./info-paoyZXvp.js";import"./index-BAMY2Nnw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=Q("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Pe=()=>{const[u,y]=g.useState([]),[b,x]=g.useState([]),[j,v]=g.useState([]),[N,k]=g.useState(!1),[E,C]=g.useState(null),S=g.useCallback(async a=>{console.log("ðŸ“¥ Loading Validation CSV:",a),k(!0),C(null);const p=[`https://raw.githubusercontent.com/datamilo/put-options-se/main/data/${a}?${Date.now()}`,`${window.location.origin}/put-options-sedata/${a}?${Date.now()}`];let m=null;for(const t of p)try{console.log("ðŸ”— Trying URL:",t);const o=await fetch(t);if(!o.ok)throw new Error(`Failed to fetch CSV: ${o.status} ${o.statusText}`);const c=await o.text();if(!c||c.trim().length===0)throw new Error("Empty CSV file received");console.log("âœ… Successfully loaded Validation CSV from:",t);const r=await new Promise((l,n)=>{ue.parse(c,{header:!0,skipEmptyLines:!0,delimiter:"|",transformHeader:h=>h.trim(),transform:(h,f)=>{if(typeof f=="string"&&["PredictedProb","ActualRate","Count","CalibrationError","Brier_Score","AUC_ROC","Log_Loss","Expected_Calibration_Error"].includes(f)){const W=parseFloat(h);return isNaN(W)?0:W}return f==="ProbMethod"?me(h):h},complete:h=>{h.errors.length>0&&console.warn("âš ï¸ CSV parsing warnings:",h.errors);const f=h.data;console.log(`âœ… Parsed ${f.length} validation records`),l(f)},error:h=>{console.error("âŒ CSV parsing error:",h),n(h)}})});y(r);const s=r.filter(l=>l.DataType==="metrics"),d=r.filter(l=>l.DataType==="calibration_aggregated"||l.DataType==="calibration_by_stock"||l.DataType==="calibration_by_stock_and_dte");return x(s),v(d),k(!1),r}catch(o){m=o,console.warn(`âš ï¸ Failed to load from ${t}:`,o);continue}const i=(m==null?void 0:m.message)||"Failed to load validation CSV from all sources";throw console.error("âŒ All CSV load attempts failed:",i),C(i),k(!1),m},[]);g.useEffect(()=>{S("validation_report_data.csv").catch(a=>{console.error("Failed to load validation data:",a)})},[S]);const _=g.useCallback(()=>b.map(a=>({method:a.ProbMethod,brierScore:a.Brier_Score,aucRoc:a.AUC_ROC,logLoss:a.Log_Loss,calibrationError:a.Expected_Calibration_Error,sampleSize:a.Count})),[b]),D=g.useCallback((a,p)=>{let m=j;return a==="aggregated"?m=j.filter(i=>i.DataType==="calibration_aggregated"):a==="by_dte"&&p?m=j.filter(i=>i.DataType==="calibration_by_dte"&&i.DTE_Bin===p):a==="by_stock"&&p&&(m=j.filter(i=>i.DataType==="calibration_by_stock"&&i.Stock===p)),m.map(i=>({predicted:i.PredictedProb,actual:i.ActualRate,count:i.Count,method:i.ProbMethod}))},[j]);return{data:u,metrics:b,calibrationData:j,isLoading:N,error:E,getMethodPerformance:_,getCalibrationPoints:D,reload:()=>S("validation_report_data.csv")}},Me=({stocks:u,chartData:y,stockChartData:b})=>{const x=g.useMemo(()=>{const t=new Set,o=new Set,c=new Set;return Object.keys(y).forEach(r=>{t.add(r),Object.keys(y[r]).forEach(s=>{o.add(s),Object.keys(y[r][s]).forEach(d=>{c.add(d)})})}),Object.keys(b).forEach(r=>{t.add(r),Object.keys(b[r]).forEach(s=>{Object.keys(b[r][s]).forEach(d=>{o.add(d),Object.keys(b[r][s][d]).forEach(l=>{c.add(l)})})})}),{thresholds:Array.from(t).sort(),methods:Array.from(o).sort(),probBins:Array.from(c).sort()}},[y,b]),[j,v]=I.useState(x.thresholds[0]||"0.8"),[N,k]=I.useState(x.methods[0]||"Weighted Average"),[E,C]=I.useState(x.probBins[0]||"50-60%"),[S,_]=I.useState("All Stocks"),D=g.useMemo(()=>{var r,s,d,l,n;let t=["0-7","8-14","15-21","22-28","29-35","36+"];t=t.slice().reverse();const o=[],c=S==="All Stocks"?(s=(r=y[j])==null?void 0:r[N])==null?void 0:s[E]:(n=(l=(d=b[j])==null?void 0:d[S])==null?void 0:l[N])==null?void 0:n[E];if(!c)return[];for(const h of t){const f=c[h];f&&o.push({name:h,"Recovery Candidates":f.recovery_candidate_rate*100,Baseline:f.baseline_rate!==null?f.baseline_rate*100:null,recovery_candidate_n:f.recovery_candidate_n,baseline_n:f.baseline_n})}return o},[y,b,j,N,E,S]),a=({active:t,payload:o})=>{if(!t||!o||!o.length)return null;const c=o[0].payload;return e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsxs("p",{className:"font-semibold mb-2",children:[c.name," days"]}),o.map((r,s)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-1",children:e.jsxs("span",{style:{color:r.color},className:"font-medium",children:[r.name,":"]})}),r.value!==null?e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm opacity-90 ml-2",children:["Worthless Rate: ",r.value.toFixed(1),"% (",r.name==="Recovery Candidates"?`${c.recovery_candidate_n.toLocaleString()}`:`${c.baseline_n.toLocaleString()}`,")"]})}):e.jsx("p",{className:"text-sm opacity-70 ml-2",children:"No data"})]},s))]})},p=Math.round(parseFloat(j)*100),m=`PoW - ${N}`,i=S==="All Stocks"?`Recovery Candidates (${p}%+ peak) vs Baseline - ${m} (${E})`:`${S} - ${m} (${E}) - Peak Threshold: ${p}%+`;return e.jsxs(w,{children:[e.jsxs(U,{children:[e.jsx(G,{children:"Recovery Advantage Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Stock (optional)"}),e.jsxs(M,{value:S,onValueChange:_,children:[e.jsx(R,{children:e.jsx(O,{})}),e.jsx(L,{children:u.map(t=>e.jsx(B,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Probability Method"}),e.jsxs(M,{value:N,onValueChange:k,children:[e.jsx(R,{children:e.jsx(O,{})}),e.jsx(L,{children:x.methods.map(t=>e.jsxs(B,{value:t,children:["PoW - ",t]},t))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Historical Peak Threshold"}),e.jsxs(M,{value:j,onValueChange:v,children:[e.jsx(R,{children:e.jsx(O,{})}),e.jsx(L,{children:x.thresholds.map(t=>e.jsxs(B,{value:t,children:[(parseFloat(t)*100).toFixed(0),"%"]},t))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Current Probability Bin"}),e.jsxs(M,{value:E,onValueChange:C,children:[e.jsx(R,{children:e.jsx(O,{})}),e.jsx(L,{children:x.probBins.map(t=>e.jsx(B,{value:t,children:t},t))})]})]})]})]}),e.jsx(A,{children:D.length===0?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-center text-destructive",children:"No data available for this combination"})}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-4",children:i}),e.jsx(be,{width:"100%",height:400,children:e.jsxs(ge,{data:D,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(fe,{dataKey:"name",label:{value:"Days to Expiry (Calendar Days)",position:"insideBottom",offset:-5},className:"text-sm"}),e.jsx(ye,{label:{value:"Worthless Rate (%)",angle:-90,position:"insideLeft"},domain:[0,100],className:"text-sm"}),e.jsx(ve,{content:({active:t,payload:o})=>e.jsx(a,{active:t,payload:o})}),e.jsx(Ne,{wrapperStyle:{paddingTop:"20px"},layout:"horizontal",align:"center",verticalAlign:"bottom"}),e.jsx(Z,{dataKey:"Recovery Candidates",fill:"hsl(var(--chart-2))",radius:[4,4,0,0]}),e.jsx(Z,{dataKey:"Baseline",fill:"hsl(var(--chart-3))",radius:[4,4,0,0]})]})})]})})]})},Re=({calibrationPoints:u,availableStocks:y=[],getCalibrationPoints:b})=>{const[x,j]=g.useState("All Stocks"),[v,N]=g.useState("All DTE"),[k,E]=g.useState("All Methods"),C=["All DTE","0-3 days","4-7 days","8-14 days","15-21 days","22-28 days","29-35 days","35+ days"],_=["All Methods",...["Weighted Average","Bayesian Calibrated","Original Black-Scholes","Bias Corrected","Historical IV"]],D={"Weighted Average":"#3b82f6","Bayesian Calibrated":"#10b981","Original Black-Scholes":"#f59e0b","Bias Corrected":"#ef4444","Historical IV":"#8b5cf6"},a=t=>t==="All Methods"?t:`PoW - ${t}`,p=g.useMemo(()=>{let t=[];if(v!=="All DTE"){const l=u.filter(n=>{const h=n;return h.DataType==="calibration_by_stock_and_dte"&&h.DTE_Bin===v});if(x==="All Stocks"){const n={};l.forEach(h=>{const f=h,V=`${f.method}|${f.Bin}`;n[V]||(n[V]={method:f.method,Bin:f.Bin,totalCount:0,totalActualCount:0,totalPredictedCount:0});const W=f.count||0;n[V].totalCount+=W,n[V].totalActualCount+=W*(f.actual||0),n[V].totalPredictedCount+=W*(f.predicted||0)}),t=Object.values(n).map(h=>({predicted:h.totalCount>0?h.totalPredictedCount/h.totalCount:0,actual:h.totalCount>0?h.totalActualCount/h.totalCount:0,count:h.totalCount,method:h.method}))}else t=l.filter(n=>n.Stock===x)}else x!=="All Stocks"?t=u.filter(l=>{const n=l;return n.Stock===x&&n.DataType==="calibration_by_stock"}):t=u.filter(l=>l.DataType==="calibration_aggregated");const o=t.map(l=>l.count).sort((l,n)=>l-n),c=Math.floor(o.length*.25),r=o.length>0?o[c]:0,s=t.filter(l=>l.count>=r),d={};return s.forEach(l=>{d[l.method]||(d[l.method]=[]),d[l.method].push({predicted:l.predicted,actual:l.actual,count:l.count})}),Object.keys(d).forEach(l=>{d[l].sort((n,h)=>n.predicted-h.predicted)}),d},[u,x,v,b]),m=g.useMemo(()=>{const t=[];return t.push({x:[0,1],y:[0,1],mode:"lines",name:"Perfect Calibration",line:{color:"black",width:2,dash:"dash"},hoverinfo:"skip",showlegend:!0}),Object.entries(p).forEach(([o,c])=>{if(!c||c.length===0||k!=="All Methods"&&o!==k)return;const r=D[o]||"#999",s=a(o);t.push({x:c.map(d=>d.predicted),y:c.map(d=>d.actual),mode:"lines+markers",name:s,line:{color:r,width:2},marker:{color:r,size:8,line:{color:"white",width:1}},hovertemplate:"<b>"+s+"</b><br>Predicted: %{x:.1%}<br>Actual: %{y:.1%}<br>n=%{text}<extra></extra>",text:c.map(d=>d.count.toLocaleString()),showlegend:!0})}),t},[p,k]),i=g.useMemo(()=>({title:{text:"<b>Calibration Analysis</b>",font:{size:16}},xaxis:{title:"Predicted Probability",tickformat:".0%",range:[0,1],gridcolor:"#e5e7eb"},yaxis:{title:"Actual Rate",tickformat:".0%",range:[0,1],gridcolor:"#e5e7eb"},height:700,template:"plotly_white",hovermode:"closest",showlegend:!0,legend:{orientation:"h",y:-.15,x:.5,xanchor:"center"}}),[]);return e.jsxs(w,{children:[e.jsxs(U,{children:[e.jsx(G,{children:"Calibration Analysis"}),y.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Stock"}),e.jsxs(M,{value:x,onValueChange:j,children:[e.jsx(R,{children:e.jsx(O,{placeholder:"Select a stock"})}),e.jsxs(L,{children:[e.jsx(B,{value:"All Stocks",children:"All Stocks"}),y.filter(t=>t!=="All Stocks").map(t=>e.jsx(B,{value:t,children:t},t))]})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Days to Expiry (business days)"}),e.jsxs(M,{value:v,onValueChange:N,children:[e.jsx(R,{children:e.jsx(O,{placeholder:"Select DTE"})}),e.jsx(L,{children:C.map(t=>e.jsx(B,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Probability Method"}),e.jsxs(M,{value:k,onValueChange:E,children:[e.jsx(R,{children:e.jsx(O,{placeholder:"Select method"})}),e.jsx(L,{children:_.map(t=>e.jsx(B,{value:t,children:a(t)},t))})]})]})]})]}),e.jsxs(A,{children:[Object.keys(p).length===0||Object.values(p).every(t=>!t||t.length===0)?e.jsx("div",{className:"flex items-center justify-center h-96 bg-muted/30 rounded-lg",children:e.jsx("p",{className:"text-muted-foreground",children:"No calibration data available for this filter combination."})}):e.jsx("div",{className:"w-full",children:e.jsx(Ce,{data:m,layout:i,config:{responsive:!0,displayModeBar:!0,displaylogo:!1},style:{width:"100%",height:"700px"}})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Interpretation:"})," Lines closer to the diagonal indicate better calibration. Each dot represents a probability bin showing predicted vs actual rates."]})})]})]})},Oe=["Weighted Average","Bayesian Calibrated","Original Black-Scholes","Bias Corrected","Historical IV"],$=Oe,Le=["All DTE","0-3 days","4-7 days","8-14 days","15-21 days","22-28 days","29-35 days","35+ days"],Ve={"Weighted Average":"#3b82f6","Bayesian Calibrated":"#10b981","Original Black-Scholes":"#f59e0b","Bias Corrected":"#ef4444","Historical IV":"#8b5cf6"},We=u=>`PoW - ${u}`,$e=({calibrationPoints:u})=>{const[y,b]=g.useState("8-14 days"),[x,j]=g.useState("stock"),[v,N]=g.useState("asc"),k=g.useMemo(()=>{const a=[],p=Array.isArray(u)?u.filter(m=>m.DataType==="calibration_by_stock_and_dte"):[];if(console.log("MethodComparisonChart - calibrationPoints count:",u==null?void 0:u.length),console.log("MethodComparisonChart - filtered records count:",p.length),p.length===0)return console.warn("No calibration_by_stock_and_dte records found"),[];if(y==="All DTE"){const m=p.filter(s=>s.DTE_Bin==="All DTE"),i=m.map(s=>s.count).sort((s,d)=>s-d),t=Math.floor(i.length*.25),o=i.length>0?i[t]:0,c=m.filter(s=>s.count>=o),r={};c.forEach(s=>{r[s.Stock]||(r[s.Stock]={}),r[s.Stock][s.method]||(r[s.Stock][s.method]={totalError:0,totalCount:0});const d=s.actual-s.predicted;r[s.Stock][s.method].totalError+=s.count*d,r[s.Stock][s.method].totalCount+=s.count}),Object.entries(r).forEach(([s,d])=>{Object.entries(d).forEach(([l,n])=>{const h=n.totalCount>0?n.totalError/n.totalCount:0;a.push({stock:s,method:l,avgError:h,totalCount:n.totalCount})})})}else{const m=p.filter(s=>s.DTE_Bin===y),i=m.map(s=>s.count).sort((s,d)=>s-d),t=Math.floor(i.length*.25),o=i.length>0?i[t]:0,c=m.filter(s=>s.count>=o),r={};c.forEach(s=>{r[s.Stock]||(r[s.Stock]={}),r[s.Stock][s.method]||(r[s.Stock][s.method]={totalError:0,totalCount:0});const d=s.actual-s.predicted;r[s.Stock][s.method].totalError+=s.count*d,r[s.Stock][s.method].totalCount+=s.count}),Object.entries(r).forEach(([s,d])=>{Object.entries(d).forEach(([l,n])=>{const h=n.totalCount>0?n.totalError/n.totalCount:0;a.push({stock:s,method:l,avgError:h,totalCount:n.totalCount})})})}return a},[u,y]),E=g.useMemo(()=>{const a={};Array.from(new Set(k.map(i=>i.stock))).sort().forEach(i=>{a[i]={stock:i},$.forEach(t=>{a[i][t]=0})}),k.forEach(i=>{a[i.stock]&&(a[i.stock][i.method]=i.avgError)});let m=Object.values(a).map(i=>({...i,avgError:$.reduce((t,o)=>t+(typeof i[o]=="number"?i[o]:0),0)/$.length}));return m.sort((i,t)=>{let o=i[x],c=t[x];return typeof o=="string"?(o=o.toLowerCase(),c=c.toLowerCase(),v==="asc"?o.localeCompare(c):c.localeCompare(o)):v==="asc"?(o||0)-(c||0):(c||0)-(o||0)}),m},[k,x,v]),C=a=>a<-.2?"bg-red-900":a<-.1?"bg-red-500":a<0?"bg-red-200":a===0?"bg-white":a<.1?"bg-green-200":a<.2?"bg-green-500":"bg-green-900",S=a=>(a*100).toFixed(1),_=a=>{x===a?N(v==="asc"?"desc":"asc"):(j(a),N("asc"))},D=({column:a})=>x!==a?e.jsx(X,{className:"w-4 h-4 opacity-30"}):e.jsx(X,{className:`w-4 h-4 ${v==="asc"?"rotate-0":"rotate-180"}`});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{children:e.jsxs(U,{children:[e.jsx(G,{children:"Stock Performance by Method"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"max-w-xs",children:[e.jsx(P,{children:"Days to Expiry (business days)"}),e.jsxs(M,{value:y,onValueChange:b,children:[e.jsx(R,{children:e.jsx(O,{})}),e.jsx(L,{children:Le.map(a=>e.jsx(B,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-900 rounded-lg text-sm",children:[e.jsxs("p",{className:"text-amber-900 dark:text-amber-200",children:[e.jsx("strong",{children:"Color Guide:"})," Green = conservative (under-predicts), Red = overconfident (over-predicts), White = well-calibrated"]}),e.jsx("p",{className:"text-amber-800 dark:text-amber-300 text-xs mt-2",children:"Values show average calibration error (actual - predicted) weighted by sample size. Positive = conservative, Negative = overconfident."})]})]})]})}),k.length===0?e.jsx(w,{children:e.jsx(A,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"No data available for this filter combination."})})}):e.jsx(w,{children:e.jsxs(A,{className:"pt-6",children:[e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-900 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left cursor-pointer",onClick:()=>_("stock"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Stock",e.jsx(D,{column:"stock"})]})}),$.map(a=>e.jsx("th",{className:"px-4 py-2 text-right cursor-pointer",onClick:()=>_(a),style:{backgroundColor:Ve[a],color:"white",fontSize:"0.75rem"},children:e.jsxs("div",{className:"flex items-center justify-between gap-1",children:[We(a),e.jsx(D,{column:a})]})},a)),e.jsx("th",{className:"px-4 py-2 text-right cursor-pointer",onClick:()=>_("avgError"),children:e.jsxs("div",{className:"flex items-center justify-between gap-1",children:["Avg Error",e.jsx(D,{column:"avgError"})]})})]})}),e.jsx("tbody",{children:E.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:a.stock}),$.map(p=>{const m=typeof a[p]=="number"?a[p]:0;return e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${C(m)}`,children:[S(m),"%"]})},p)}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold",children:[S(a.avgError),"%"]})]},a.stock))})]})}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg text-sm mt-4",children:e.jsxs("p",{className:"text-blue-900 dark:text-blue-300",children:[e.jsx("strong",{children:"Interpretation:"})," Positive values indicate the method is conservative (predicts lower probabilities than actual), negative values indicate overconfidence. Values are weighted by sample size to emphasize results with more data."]})})]})})]})},Ie={default:"border-border bg-card",success:"border-success/30 bg-success/5",warning:"border-warning/30 bg-warning/5",danger:"border-destructive/30 bg-destructive/5",info:"border-info/30 bg-info/5"},He={up:"text-success",down:"text-destructive",neutral:"text-muted-foreground"},ze=u=>typeof u=="string"?u:ke(u);function z({title:u,value:y,subtitle:b,trend:x,icon:j,variant:v="default",className:N}){return e.jsx(w,{className:K("border-2",Ie[v],N),children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:u}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-tight",children:ze(y)}),b&&e.jsx("p",{className:"text-xs text-muted-foreground",children:b}),x&&e.jsxs("p",{className:K("text-xs font-medium flex items-center gap-1",He[x.direction]),children:[x.direction==="up"&&"â†‘",x.direction==="down"&&"â†“",x.value]})]}),j&&e.jsx("div",{className:"ml-2",children:e.jsx(j,{className:"h-5 w-5 text-muted-foreground"})})]})})})}const rt=()=>{var o,c;ce();const[u,y]=I.useState(!1),{timestamps:b}=he(),{isLoading:x,error:j,stocks:v,scenarios:N,chartData:k,stockChartData:E}=xe(),{calibrationData:C,isLoading:S,error:_,getCalibrationPoints:D}=Pe(),a=x||S,p=j||_,m=g.useMemo(()=>C.map(r=>({predicted:r.PredictedProb,actual:r.ActualRate,count:r.Count,method:r.ProbMethod,Bin:r.Bin,DTE_Bin:r.DTE_Bin,Stock:r.Stock,DataType:r.DataType})),[C]),i=g.useMemo(()=>{const r=C.filter(s=>s.DataType==="calibration_by_stock"&&s.Stock).map(s=>s.Stock);return Array.from(new Set(r)).sort()},[C]),t=g.useMemo(()=>{if(!N||!N.length||!C.length)return null;const r=N.reduce((l,n)=>l+n.RecoveryCandidate_N,0),s=N.reduce((l,n)=>l+n.AllOptions_N,0),d=C.length>0?C.reduce((l,n)=>l+n.ActualRate,0)/C.length*100:0;return{totalRecoveryCandidates:r,totalAllOptions:s,avgAccuracy:d,stocksAnalyzed:v.length}},[N,v,C]);return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading probability analysis data..."})]})}):p?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Error loading data"}),e.jsx("p",{className:"text-sm",children:p})]})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-4",children:[e.jsx(we,{children:e.jsxs(Ee,{children:[e.jsx(J,{children:e.jsx(Ae,{asChild:!0,children:e.jsx(de,{to:"/",children:"Options Dashboard"})})}),e.jsx(De,{}),e.jsx(J,{children:e.jsx(_e,{children:"Probability Analysis"})})]})}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-1",children:"Probability Analysis"}),e.jsx("p",{className:"text-muted-foreground",children:"Method validation and recovery opportunities"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(q,{timestamp:(o=b==null?void 0:b.optionsData)==null?void 0:o.lastUpdated,label:"Options data"}),e.jsx(q,{timestamp:(c=b==null?void 0:b.analysisCompleted)==null?void 0:c.lastUpdated,label:"Analysis updated"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ee,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(se,{variant:"ghost",size:"sm",title:"Learn what PoW means and about the probability methods",className:"gap-1",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"PoW ?"})]})}),e.jsxs(ae,{className:"max-w-md",children:[e.jsx(re,{children:e.jsx(oe,{children:"PoW Legend"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"What is PoW?"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"PoW = Probability of Worthless"})," â€” The probability that an option will expire worthless."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"The 5 Calculation Methods"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-2 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Weighted Average:"})," Weighted combination of methods"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Bayesian Calibrated:"})," Bayesian probability calibration"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Original Black-Scholes:"})," Classic Black-Scholes model"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Bias Corrected:"})," Calibrated with bias correction"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PoW - Historical IV:"})," Based on historical implied volatility"]})]})]})]})]})]}),e.jsx(H,{className:"h-6 w-6 text-muted-foreground"})]})]})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(z,{title:"Recovery Candidates",value:t.totalRecoveryCandidates,subtitle:"High probability options",icon:H,variant:"success"}),e.jsx(z,{title:"All Options (Ground Truth)",value:t.totalAllOptions,subtitle:"Total options analyzed",icon:ie,variant:"default"}),e.jsx(z,{title:"Avg Accuracy",value:`${t.avgAccuracy.toFixed(1)}%`,subtitle:"Model calibration",icon:le,variant:"info"}),e.jsx(z,{title:"Stocks Analyzed",value:t.stocksAnalyzed,subtitle:"Unique securities",icon:Be,variant:"default"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(w,{className:"border-blue-500/20 bg-blue-500/5",children:e.jsxs(A,{className:"pt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold",children:"Calibration Analysis"})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Validates which probability calculation methods are most accurate by comparing predictions against actual market outcomes."})]})}),e.jsx(w,{className:"border-green-500/20 bg-green-500/5",children:e.jsxs(A,{className:"pt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Probability Recovery"})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Identifies recovery opportunities where options previously had high probability levels but have since declinedâ€”these statistically expire worthless more often than expected."})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Calibration Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Probability Method Accuracy & Validation"})]})]}),e.jsx(w,{className:"border-l-4 border-l-blue-500",children:e.jsx(A,{className:"pt-6 space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"How to Read the Chart"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"The chart compares predicted probabilities (horizontal axis) against actual outcomes (vertical axis). The diagonal line represents perfect calibration. Methods above the line are conservative (safer than predicted); methods below are overconfident (riskier than predicted). Colored lines with dots represent different probability calculation methodsâ€”larger dots indicate more data points."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use the dropdown menu to filter by individual stocks and see which probability methods are most reliable for your trading."})]})})}),e.jsx(w,{children:e.jsx(A,{className:"pt-6",children:e.jsx(Re,{calibrationPoints:m,availableStocks:i,getCalibrationPoints:D})})})]}),e.jsx("div",{className:"border-t-2 border-border my-8"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>y(!u),children:[e.jsx(F,{className:"h-6 w-6 text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Stock Performance by Method"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compare Method Accuracy Across All Stocks"})]}),u?e.jsx(pe,{className:"h-6 w-6 text-muted-foreground"}):e.jsx(ne,{className:"h-6 w-6 text-muted-foreground"})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"border-l-4 border-l-purple-500",children:e.jsx(A,{className:"pt-6 space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"How to Read the Chart"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This analysis compares how each probability method performs across different stocks. Each cell shows the average calibration errorâ€”how much the method's predictions deviate from actual outcomes. Positive values (green) indicate the method is conservative, predicting lower probabilities than actual results. Negative values (red) indicate overconfidence, predicting higher probabilities than actual results."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use the DTE selector to see how method performance changes as options approach expiration. Sort by any column to identify which methods work best for specific stocks."})]})})}),e.jsx(w,{children:e.jsx(A,{className:"pt-6",children:e.jsx($e,{calibrationPoints:m})})})]})]}),e.jsx("div",{className:"border-t-2 border-border my-8"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"h-6 w-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Probability Recovery Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Identifying Systematic Mispricing Where Options Expire Worthless More Often Than Expected"})]})]}),e.jsx(w,{className:"border-l-4 border-l-green-600 bg-green-50 dark:bg-green-950/30",children:e.jsx(A,{className:"pt-6 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-green-900 dark:text-green-100",children:"Validated Finding: Recovery Candidates Expire Worthless 1.17x More Often"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Recovery candidates:"}),e.jsxs("p",{className:"font-bold text-base",children:[Y(87.59,2),"% worthless"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"All options:"}),e.jsxs("p",{className:"font-bold text-base",children:[Y(74.88,2),"% worthless"]})]})]}),e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:[T(12.71,2)," advantage (statistically significant, p < 0,001)"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on 1,16M expired options analyzed across all probability methods and thresholds"})]})})}),e.jsx(w,{className:"border-l-4 border-l-green-500",children:e.jsx(A,{className:"pt-6 space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"What Are Recovery Candidates?"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Recovery candidates are options that previously peaked at high probability (80%+, 85%+, 90%+, or 95%+) but have since declined to lower probability levels. Analysis shows these options expire worthless significantly more often than the probability model predictsâ€”revealing systematic mispricing."}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[e.jsx("strong",{children:"Why this matters:"})," The probability model underestimates their true worthless rates by ",T(17.18,2)," on average, while it underestimates for all options by only ",T(3.01,2),". This ",T(14.18,2)," gap proves recovery candidates are systematically mispriced, not just statistical noise."]}),e.jsx("h3",{className:"text-lg font-semibold mb-3 pt-2",children:"How to Read the Chart"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"The chart compares worthless rates (green bars = recovery candidates vs red bars = all options) across different days-to-expiry periods. Higher green bars indicate better opportunities for put sellers."}),e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Best Opportunities:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"DTE:"})," 36+ days show ",T(15.21,2)," advantage (vs ",T(7.94,2)," for 0-7 days)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Probability Bin:"})," 50-60% show ",T(23.61,2)," advantage (vs ",T(4.46,2)," for 80-90%)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Method:"})," Weighted Average shows ",T(16.06,2)," advantage (best for identifying recovery opportunities)"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Use the filters to explore which probability thresholds, methods, and current probability ranges show the strongest recovery advantages on specific stocks."})]})})}),e.jsx(w,{children:e.jsx(A,{className:"pt-6",children:e.jsx(Me,{stocks:v,chartData:k,stockChartData:E})})})]})]})]})};export{rt as ProbabilityAnalysis};
