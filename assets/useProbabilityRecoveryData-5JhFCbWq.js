import{r as i}from"./router-C0wDHNfv.js";import{P as H}from"./csv-B1Pu-2A6.js";const D={"PoW - Weighted Average":"Weighted Average","PoW - Bayesian Calibrated":"Bayesian Calibrated","PoW - Original Black-Scholes":"Original Black-Scholes","PoW - Bias Corrected":"Bias Corrected","PoW - Historical IV":"Historical IV"},M=g=>{if(!g)return"";const u=g.trim();return u in D?D[u]:u},q=()=>{const[g,u]=i.useState([]),[w,R]=i.useState([]),[P,A]=i.useState([]),[O,y]=i.useState(!1),[W,m]=i.useState(null),[T,V]=i.useState([]),[$,B]=i.useState({}),[E,F]=i.useState({}),v=i.useCallback(l=>{const r={},o={},h=new Set;for(const e of l){const t=e.HistoricalPeakThreshold.toFixed(2),a=e.ProbMethod,s=e.CurrentProb_Bin,f=e.DTE_Bin,c=e.Stock||"",C=e.RecoveryCandidate_WorthlessRate_pct/100,k=e.AllOptions_N>0&&e.AllOptions_WorthlessRate_pct!==void 0?e.AllOptions_WorthlessRate_pct/100:null,_={recovery_candidate_n:e.RecoveryCandidate_N,recovery_candidate_rate:C,baseline_n:e.AllOptions_N,baseline_rate:k,advantage:e.RecoveryAdvantage_pp};e.DataType==="scenario"||c===""?(r[t]||(r[t]={}),r[t][a]||(r[t][a]={}),r[t][a][s]||(r[t][a][s]={}),r[t][a][s][f]=_):(o[t]||(o[t]={}),o[t][c]||(o[t][c]={}),o[t][c][a]||(o[t][c][a]={}),o[t][c][a][s]||(o[t][c][a][s]={}),o[t][c][a][s][f]=_,h.add(c))}if(console.log("âœ… Built chart data structure:"),console.log("ðŸ”‘ Aggregated thresholds:",Object.keys(r)),Object.keys(r).length>0){const e=Object.keys(r)[0];console.log(`ðŸ“Š Methods for threshold ${e}:`,Object.keys(r[e]))}return{aggregatedChart:r,stockChart:o,uniqueStocks:Array.from(h).sort()}},[]),S=i.useCallback(async l=>{console.log("ðŸ“¥ Loading Recovery CSV:",l),y(!0),m(null);const r=[`https://raw.githubusercontent.com/datamilo/put-options-se/main/data/${l}?${Date.now()}`,`${window.location.origin}/put-options-sedata/${l}?${Date.now()}`];let o=null;for(const e of r)try{console.log("ðŸ”— Trying URL:",e);const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch CSV: ${t.status} ${t.statusText}`);const a=await t.text();if(!a||a.trim().length===0)throw new Error("Empty CSV file received");console.log("âœ… Successfully loaded Recovery CSV from:",e);const s=await new Promise((p,N)=>{H.parse(a,{header:!0,skipEmptyLines:!0,delimiter:"|",transformHeader:n=>n.trim(),transform:(n,d)=>{if(typeof d=="string"&&["HistoricalPeakThreshold","RecoveryCandidate_N","RecoveryCandidate_WorthlessCount","RecoveryCandidate_WorthlessRate_pct","AllOptions_N","AllOptions_WorthlessCount","AllOptions_WorthlessRate_pct","RecoveryAdvantage_pp"].includes(d)){const b=parseFloat(n);return isNaN(b)?0:b}return d==="ProbMethod"?M(n):n},complete:n=>{n.errors.length>0&&console.warn("âš ï¸ CSV parsing warnings:",n.errors);const d=n.data;console.log(`âœ… Parsed ${d.length} recovery records`),p(d)},error:n=>{console.error("âŒ CSV parsing error:",n),N(n)}})});u(s);const f=s.filter(p=>p.DataType==="scenario"),c=s.filter(p=>p.DataType==="stock");R(f),A(c);const{aggregatedChart:C,stockChart:k,uniqueStocks:_}=v(s);return B(C),F(k),V(["All Stocks",..._]),y(!1),s}catch(t){o=t,console.warn(`âš ï¸ Failed to load from ${e}:`,t);continue}const h=(o==null?void 0:o.message)||"Failed to load recovery CSV from all sources";throw console.error("âŒ All CSV load attempts failed:",h),m(h),y(!1),o},[v]);return i.useEffect(()=>{S("recovery_report_data.csv").catch(l=>{console.error("Failed to load recovery data:",l)})},[S]),{data:g,scenarios:w,stockData:P,isLoading:O,error:W,stocks:T,chartData:$,stockChartData:E,reload:()=>S("recovery_report_data.csv")}};export{M as n,q as u};
