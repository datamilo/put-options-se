import{c as te,k as re,s as X,j as e,B as J,L,l as ae,m as ne,C as O,n as le,ak as ie,al as ce,v as W,aj as oe,Q as U,U as de,K as H}from"./index-m-D8N6ZR.js";import{r as u,R as me}from"./router-C0wDHNfv.js";import{u as xe}from"./usePageTitle-CpPgFbZv.js";import{s as g,V as he,T as ge,u as be}from"./useScoredOptionsData-CBTYEUqF.js";import{C,c as D,a as pe,b as ue}from"./card-CFv4AOJA.js";import{u as K,w as fe,D as je}from"./xlsx-CFAW_Hl2.js";import{S as q,a as Y,b as Q,c as Z,d as $,C as B}from"./select-BQ6yrQU9.js";import{I as w}from"./info-icon-tooltip-C8Op9q7s.js";import{R as ye}from"./rotate-ccw-DPye7aKO.js";import{T as P,a as R,b,c as p,d as z,e as t}from"./table-HqYCl6OD.js";import{S as Ne,a as ve}from"./scroll-area-DrcYSP2b.js";import{f,a as T,c as Se,b as ke}from"./numberFormatting-BNPfGtWN.js";import{C as we}from"./circle-x-aIwZ_57S.js";import{A as _e,a as Ae}from"./arrow-up-MVoUlZXt.js";import"./charts-B8eVsusH.js";import"./useEnrichedOptionsData-CGjGgNf5.js";import"./csv-B1Pu-2A6.js";import"./info-DTjHuAI_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=te("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=te("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ce={expiryDate:"",stockNames:[],agreement:"all",minScore:70,minV21Score:0,minTAProb:0},G="scoredOptionsFilterSettings",De=()=>{const{user:s}=re(),[l,r]=u.useState(Ce),[o,d]=u.useState(!0),[h,i]=u.useState(!1);return u.useEffect(()=>{(()=>{try{const a=localStorage.getItem(G);if(a){const v=JSON.parse(a);r(v)}}catch(a){console.error("Error loading scored options settings from localStorage:",a)}})()},[]),u.useEffect(()=>{if(!s||h){d(!1);return}(async()=>{try{d(!0);const{data:a,error:v}=await X.from("user_preferences").select("preference_data").eq("user_id",s.id).eq("preference_type","scored_options_filters").maybeSingle();if(v){console.error("Error loading scored options settings from Supabase:",v);return}if(a!=null&&a.preference_data){const N=a.preference_data;console.log("ðŸ”„ useScoredOptionsPreferences - Loaded from Supabase:",N),r(N),localStorage.setItem(G,JSON.stringify(N))}else console.log("ðŸ”„ useScoredOptionsPreferences - No saved preferences found in Supabase")}catch(a){console.error("Error loading scored options settings:",a)}finally{d(!1),i(!0)}})()},[s,h]),{settings:l,isLoading:o,saveSettings:async m=>{console.log("ðŸ’¾ useScoredOptionsPreferences - Saving settings:",m),r(m);try{localStorage.setItem(G,JSON.stringify(m))}catch(a){console.error("Error saving to localStorage:",a)}if(s)try{const{error:a}=await X.from("user_preferences").upsert({user_id:s.id,preference_type:"scored_options_filters",preference_data:m},{onConflict:"user_id,preference_type"});a?console.error("Error saving scored options settings to Supabase:",a):console.log("âœ… useScoredOptionsPreferences - Successfully saved to Supabase")}catch(a){console.error("Error saving scored options settings:",a)}}}},Le=({filename:s,data:l})=>{const r=a=>a==null||Number.isNaN(a)?null:typeof a=="boolean"?a?"Yes":"No":a,o=l.map(a=>({date:r(a.date),stock_name:r(a.stock_name),option_name:r(a.option_name),strike_price:r(a.strike_price),expiry_date:r(a.expiry_date),days_to_expiry:r(a.days_to_expiry),premium:r(a.premium),current_probability:r(a.current_probability),v21_score:r(a.v21_score),v21_bucket:r(a.v21_bucket),v21_historical_peak:r(a.v21_historical_peak),v21_support_strength:r(a.v21_support_strength),ta_probability:r(a.ta_probability),ta_bucket:r(a.ta_bucket),RSI_14:r(a.RSI_14),RSI_Slope:r(a.RSI_Slope),MACD_Hist:r(a.MACD_Hist),MACD_Slope:r(a.MACD_Slope),BB_Position:r(a.BB_Position),Dist_SMA50:r(a.Dist_SMA50),Vol_Ratio:r(a.Vol_Ratio),ADX_14:r(a.ADX_14),ADX_Slope:r(a.ADX_Slope),ATR_14:r(a.ATR_14),Stochastic_K:r(a.Stochastic_K),Stochastic_D:r(a.Stochastic_D),Sigma_Distance:r(a.Sigma_Distance),Greeks_Delta:r(a.Greeks_Delta),Greeks_Vega:r(a.Greeks_Vega),Greeks_Theta:r(a.Greeks_Theta),models_agree:r(a.models_agree),agreement_strength:r(a.agreement_strength),combined_score:r(a.combined_score)})),d=K.json_to_sheet(o),h=[{wch:12},{wch:15},{wch:12},{wch:13},{wch:12},{wch:13},{wch:12},{wch:18},{wch:11},{wch:12},{wch:18},{wch:18},{wch:13},{wch:12},{wch:10},{wch:11},{wch:12},{wch:12},{wch:12},{wch:12},{wch:11},{wch:10},{wch:11},{wch:10},{wch:12},{wch:12},{wch:14},{wch:11},{wch:11},{wch:11},{wch:12},{wch:18},{wch:13}];d["!cols"]=h;const i=K.book_new();K.book_append_sheet(i,d,"Scored Options");const j=new Date().toISOString().slice(0,10),m=`${s}_${j}.xlsx`;fe(i,m)},Ie=({filters:s,onFiltersChange:l,onResetToDefault:r,availableStocks:o,availableExpiryDates:d})=>{const h=c=>{l({...s,expiryDate:c})},i=c=>{const _=s.stockNames.includes(c)?s.stockNames.filter(M=>M!==c):[...s.stockNames,c];l({...s,stockNames:_})},j=()=>{l({...s,stockNames:[]})},m=c=>{l({...s,agreement:c})},a=c=>{l({...s,minScore:c[0]})},v=c=>{l({...s,minV21Score:c[0]})},N=c=>{l({...s,minTAProb:c[0]})};return e.jsx(C,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("div",{className:"flex justify-end mb-4",children:r&&e.jsxs(J,{onClick:r,variant:"ghost",size:"sm",className:"text-xs text-muted-foreground hover:text-foreground",title:"Reset all filters to default",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Reset to Default"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{htmlFor:"expiry",children:"Expiry Date"}),e.jsx(w,{content:g.filters.expiryDate.content,side:"bottom"})]}),e.jsxs(q,{value:s.expiryDate,onValueChange:h,children:[e.jsx(Y,{id:"expiry",children:e.jsx(Q,{placeholder:"Select expiry date"})}),e.jsx(Z,{children:d.map(c=>e.jsx($,{value:c,children:new Date(c).toLocaleDateString("sv-SE")},c))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{children:"Stocks"}),e.jsx(w,{content:g.filters.stocks.content,side:"bottom"})]}),e.jsxs(ae,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(J,{variant:"outline",className:"w-full justify-between",children:[e.jsx("span",{className:"truncate",children:s.stockNames.length===0?"All stocks":`${s.stockNames.length} selected`}),e.jsx(O,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})}),e.jsxs(le,{align:"start",className:"w-56 max-h-64 overflow-y-auto",children:[s.stockNames.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,className:"w-full px-2 py-1.5 text-sm text-left hover:bg-accent hover:text-accent-foreground rounded-sm",children:"Clear all stocks"}),e.jsx(ie,{})]}),o.map(c=>e.jsx(ce,{checked:s.stockNames.includes(c),onCheckedChange:()=>i(c),children:c},c))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{htmlFor:"agreement",children:"Model Agreement"}),e.jsx(w,{content:g.filters.modelAgreement.content,side:"bottom"})]}),e.jsxs(q,{value:s.agreement,onValueChange:m,children:[e.jsx(Y,{id:"agreement",children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx($,{value:"all",children:"All Options"}),e.jsx($,{value:"agree",children:"Models Agree"}),e.jsx($,{value:"disagree",children:"Models Disagree"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{children:["Min Combined Score: ",s.minScore]}),e.jsx(w,{content:g.filters.minCombinedScore.content,side:"bottom"})]}),e.jsx(W,{value:[s.minScore],onValueChange:a,min:0,max:100,step:1,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{children:["Min Probability Optimization Score: ",s.minV21Score]}),e.jsx(w,{content:g.filters.minV21Score.content,side:"bottom"})]}),e.jsx(W,{value:[s.minV21Score],onValueChange:v,min:0,max:100,step:1,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{children:["Min TA Prob: ",s.minTAProb,"%"]}),e.jsx(w,{content:g.filters.minTAProb.content,side:"bottom"})]}),e.jsx(W,{value:[s.minTAProb],onValueChange:N,min:0,max:100,step:1,className:"mt-2"})]})]})]})})},Pe=({option:s})=>{const l=i=>i>=80?"text-green-700":i>=70?"text-amber-600":"text-red-600",r=i=>i>=80?"bg-green-50 dark:bg-green-950":i>=70?"bg-amber-50 dark:bg-amber-950":"bg-red-50 dark:bg-red-950",o=i=>i==="Strong"?"text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800":i==="Moderate"?"text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-950 border-amber-200 dark:border-amber-800":"text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800",h=(()=>{if(!s.models_agree){const j=s.v21_score>s.ta_probability*100,m=Math.abs(s.v21_score-s.ta_probability*100);return{title:"Models Disagree",icon:e.jsx(we,{className:"w-5 h-5"}),description:j?`Probability Optimization Model (${f(s.v21_score,1)}) is bullish, but TA ML Model (${f(s.ta_probability*100,1)}) is bearish. Difference: ${f(m,1)} points.`:`TA ML Model (${f(s.ta_probability*100,1)}) is bullish, but Probability Optimization Model (${f(s.v21_score,1)}) is bearish. Difference: ${f(m,1)} points.`,recommendation:"Use with caution. Mixed signals suggest elevated uncertainty. Consider additional confirmation."}}s.v21_score>s.ta_probability*100;const i=Math.abs(s.v21_score-s.ta_probability*100);return{title:"Models Agree",icon:e.jsx(Me,{className:"w-5 h-5"}),description:s.agreement_strength==="Strong"?`Both models strongly bullish. Probability Optimization: ${f(s.v21_score,1)}, TA ML: ${f(s.ta_probability*100,1)}. Difference: ${f(i,1)} points.`:`Both models aligned with moderate conviction. Probability Optimization: ${f(s.v21_score,1)}, TA ML: ${f(s.ta_probability*100,1)}. Difference: ${f(i,1)} points.`,recommendation:s.agreement_strength==="Strong"?"High confidence signal. Both models strongly support this position.":"Moderate confidence signal. Both models support, but with some variance."}})();return e.jsxs(C,{className:`${r(s.combined_score)}`,children:[e.jsx(pe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ue,{className:"text-lg",children:"Combined Analysis"}),e.jsx("div",{className:`text-4xl font-bold ${l(s.combined_score)}`,children:f(s.combined_score,1)})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${o(s.agreement_strength)}`,children:[h.icon,e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:h.title}),e.jsxs("div",{className:"text-xs mt-0.5 opacity-90",children:[s.agreement_strength," Agreement"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Models Agree"}),e.jsx(w,{title:g.agreement.modelsAgreeField.title,content:g.agreement.modelsAgreeField.content,side:"top"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-sm font-semibold",children:s.models_agree?"Yes":"No"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Agreement Strength"}),e.jsx(w,{title:g.agreement.agreementStrengthField.title,content:g.agreement.agreementStrengthField.content,side:"top"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-sm font-semibold",children:s.agreement_strength})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Model Scores"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Probability Optimization Model"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500",style:{width:`${Math.min(s.v21_score,100)}%`}})}),e.jsx("span",{className:"text-sm font-semibold w-12 text-right",children:f(s.v21_score,0)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"TA Model"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500",style:{width:`${Math.min(s.ta_probability*100,100)}%`}})}),e.jsx("span",{className:"text-sm font-semibold w-12 text-right",children:f(s.ta_probability*100,0)})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Difference:"," ",e.jsxs("span",{className:"font-semibold",children:[f(Math.abs(s.v21_score-s.ta_probability*100),1)," points"]})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:h.description}),e.jsxs("div",{className:"bg-muted/50 p-2 rounded text-xs italic text-muted-foreground",children:["ðŸ’¡ ",h.recommendation]})]})]})]})},Re=({data:s,filters:l,getFullPath:r})=>{const[o,d]=u.useState("combined_score"),[h,i]=u.useState("desc"),[j,m]=u.useState(null),a=u.useMemo(()=>s.filter(n=>{if(l.expiryDate&&n.expiry_date!==l.expiryDate||l.stockNames.length>0&&!l.stockNames.includes(n.stock_name)||l.agreement==="agree"&&!n.models_agree||l.agreement==="disagree"&&n.models_agree)return!1;if(n.combined_score==null){if(l.minScore>0)return!1}else if(n.combined_score<l.minScore)return!1;if(n.v21_score==null){if(l.minV21Score>0)return!1}else if(n.v21_score<l.minV21Score)return!1;if(n.ta_probability==null){if(l.minTAProb>0)return!1}else if(n.ta_probability*100<l.minTAProb)return!1;return!0}),[s,l]),v=u.useMemo(()=>o==="expanded"?a:[...a].sort((n,x)=>{const y=n[o],S=x[o],k=y==null,A=S==null;return k&&A?0:k?1:A?-1:typeof y=="number"&&typeof S=="number"?h==="asc"?y-S:S-y:typeof y=="string"&&typeof S=="string"?h==="asc"?y.localeCompare(S):S.localeCompare(y):0}),[a,o,h]),N=n=>{o===n?i(h==="asc"?"desc":"asc"):(d(n),i("desc"))},c=({field:n,label:x,align:y="left",tooltipTitle:S,tooltipContent:k})=>e.jsx(p,{className:`cursor-pointer hover:bg-muted/50 ${y==="right"?"text-right":y==="center"?"text-center":""}`,onClick:()=>N(n),"aria-sort":o===n?h==="asc"?"ascending":"descending":void 0,children:e.jsxs("div",{className:`flex items-center gap-1.5 ${y==="right"?"justify-end":y==="center"?"justify-center":""}`,children:[e.jsx("span",{children:x}),o===n&&(h==="asc"?e.jsx(_e,{className:"h-3 w-3"}):e.jsx(Ae,{className:"h-3 w-3"})),k&&e.jsx(w,{title:S,content:k,side:"bottom"})]})}),_=n=>n>=80?"text-green-600 dark:text-green-400":n>=70?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400",M=n=>n>=80?"bg-green-50":n>=70?"bg-amber-50":"bg-red-50",E=n=>n?"âœ“":"âœ•",V=n=>n?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",F=n=>n.FinancialReport==="Y"?"text-orange-600 dark:text-orange-400":n["X-Day"]&&String(n["X-Day"]).toUpperCase()==="Y"?"text-red-600 dark:text-red-400":"text-primary";return e.jsx("div",{className:"space-y-4",children:e.jsxs(Ne,{className:"w-full border rounded-lg",children:[e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"w-12",children:"Details"}),e.jsx(c,{field:"stock_name",label:"Stock"}),e.jsx(c,{field:"option_name",label:"Option"}),e.jsx(c,{field:"strike_price",label:"Strike",align:"right"}),e.jsx(c,{field:"expiry_date",label:"Expiry"}),e.jsx(c,{field:"days_to_expiry",label:"DTE",align:"right"}),e.jsx(c,{field:"premium",label:"Premium",align:"right"}),e.jsx(c,{field:"v21_score",label:"Probability Score",align:"right",tooltipTitle:g.columns.v21Score.title,tooltipContent:g.columns.v21Score.content}),e.jsx(c,{field:"ta_probability",label:"TA Prob",align:"right",tooltipTitle:g.columns.taProbability.title,tooltipContent:g.columns.taProbability.content}),e.jsx(c,{field:"combined_score",label:"Combined",align:"right",tooltipTitle:g.columns.combined.title,tooltipContent:g.columns.combined.content}),e.jsx(c,{field:"models_agree",label:"Agree",align:"center",tooltipTitle:g.columns.agree.title,tooltipContent:g.columns.agree.content}),e.jsx(c,{field:"agreement_strength",label:"Strength",tooltipTitle:g.columns.strength.title,tooltipContent:g.columns.strength.content})]})}),e.jsx(z,{children:v.length===0?e.jsx(b,{children:e.jsx(t,{colSpan:12,className:"text-center text-muted-foreground py-8",children:"No options found matching your filters."})}):v.map((n,x)=>e.jsxs(me.Fragment,{children:[e.jsxs(b,{className:"hover:bg-muted/50",children:[e.jsx(t,{children:e.jsx("button",{onClick:()=>m(j===x?null:x),className:"p-1 hover:bg-muted rounded text-gray-600 dark:text-gray-400",children:j===x?e.jsx(B,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})})}),e.jsx(t,{children:e.jsx("button",{onClick:()=>window.open(r(`/stock/${encodeURIComponent(n.stock_name)}`),"_blank"),className:"text-primary hover:underline cursor-pointer font-medium",children:n.stock_name})}),e.jsx(t,{children:e.jsx("button",{onClick:()=>window.open(r(`/option/${encodeURIComponent(n.option_name)}`),"_blank"),className:`hover:underline cursor-pointer font-medium ${F(n)} hover:opacity-80 transition-all`,children:n.option_name})}),e.jsx(t,{className:"text-right",children:T(n.strike_price,0)}),e.jsx(t,{children:new Date(n.expiry_date).toLocaleDateString("sv-SE")}),e.jsx(t,{className:"text-right",children:n.days_to_expiry}),e.jsx(t,{className:"text-right text-green-600 dark:text-green-400 font-semibold",children:Se(n.premium,0)}),e.jsx(t,{className:`text-right font-semibold ${n.v21_score!=null?_(n.v21_score):""}`,children:n.v21_score!=null?f(n.v21_score,1):"-"}),e.jsx(t,{className:`text-right font-semibold ${n.ta_probability!=null?_(n.ta_probability*100):""}`,children:n.ta_probability!=null?f(n.ta_probability*100,0):"-"}),e.jsx(t,{className:`text-right font-bold text-lg ${_(n.combined_score)}`,children:e.jsx("div",{className:`px-2 py-1 rounded ${M(n.combined_score)}`,children:f(n.combined_score,1)})}),e.jsx(t,{className:`text-center font-bold ${V(n.models_agree)}`,children:E(n.models_agree)}),e.jsx(t,{className:"text-sm",children:n.agreement_strength})]}),j===x&&e.jsx(b,{children:e.jsx(t,{colSpan:12,className:"bg-muted/30 p-0",children:e.jsx("div",{className:"p-6 overflow-x-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-w-full",children:[e.jsx(he,{option:n}),e.jsx(ge,{option:n}),e.jsx(Pe,{option:n})]})})})})]},`${n.option_name}-${x}`))})]}),e.jsx(ve,{orientation:"horizontal"})]})})},I={v21Buckets:[{rangeLabel:"90-100%",minScore:90,maxScore:100,hitRate:.999,sampleSize:1878,confidenceIntervalLower:.997,confidenceIntervalUpper:.9999,expectedNote:"Actual Worthless %: 99.9%"},{rangeLabel:"80-90%",minScore:80,maxScore:90,hitRate:.981,sampleSize:27082,confidenceIntervalLower:.979,confidenceIntervalUpper:.982,expectedNote:"Actual Worthless %: 98.1%"},{rangeLabel:"70-80%",minScore:70,maxScore:80,hitRate:.838,sampleSize:19830,confidenceIntervalLower:.833,confidenceIntervalUpper:.843,expectedNote:"Actual Worthless %: 83.8%"},{rangeLabel:"60-70%",minScore:60,maxScore:70,hitRate:.514,sampleSize:13506,confidenceIntervalLower:.506,confidenceIntervalUpper:.523,expectedNote:"Actual Worthless %: 51.4%"},{rangeLabel:"50-60%",minScore:50,maxScore:60,hitRate:.322,sampleSize:7389,confidenceIntervalLower:.311,confidenceIntervalUpper:.332,expectedNote:"Actual Worthless %: 32.2%"},{rangeLabel:"40-50%",minScore:40,maxScore:50,hitRate:.123,sampleSize:1963,confidenceIntervalLower:.109,confidenceIntervalUpper:.138,expectedNote:"Actual Worthless %: 12.3%"},{rangeLabel:"30-40%",minScore:30,maxScore:40,hitRate:.064,sampleSize:622,confidenceIntervalLower:.048,confidenceIntervalUpper:.086,expectedNote:"Actual Worthless %: 6.4%"},{rangeLabel:"20-30%",minScore:20,maxScore:30,hitRate:.015,sampleSize:194,confidenceIntervalLower:.005,confidenceIntervalUpper:.044,expectedNote:"Actual Worthless %: 1.5%"},{rangeLabel:"10-20%",minScore:10,maxScore:20,hitRate:.4,sampleSize:5,confidenceIntervalLower:.118,confidenceIntervalUpper:.769,expectedNote:"Actual Worthless %: 40.0%"}],v3Buckets:[{rangeLabel:"90%+",minScore:90,maxScore:100,hitRate:.9824,sampleSize:587666,confidenceIntervalLower:.982,confidenceIntervalUpper:.9827,expectedNote:"Actual Worthless %: 98.24%"},{rangeLabel:"80-90%",minScore:80,maxScore:90,hitRate:.8525,sampleSize:1766411,confidenceIntervalLower:.852,confidenceIntervalUpper:.853,expectedNote:"Actual Worthless %: 85.25%"},{rangeLabel:"70-80%",minScore:70,maxScore:80,hitRate:.7242,sampleSize:1425565,confidenceIntervalLower:.7234,confidenceIntervalUpper:.7249,expectedNote:"Actual Worthless %: 72.42%"},{rangeLabel:"60-70%",minScore:60,maxScore:70,hitRate:.6285,sampleSize:1126329,confidenceIntervalLower:.6276,confidenceIntervalUpper:.6293,expectedNote:"Actual Worthless %: 62.85%"},{rangeLabel:"50-60%",minScore:50,maxScore:60,hitRate:.5432,sampleSize:915790,confidenceIntervalLower:.5421,confidenceIntervalUpper:.5442,expectedNote:"Actual Worthless %: 54.32%"},{rangeLabel:"<50%",minScore:0,maxScore:50,hitRate:.3104,sampleSize:2999840,confidenceIntervalLower:.3098,confidenceIntervalUpper:.3109,expectedNote:"Actual Worthless %: 31.04%"}],v3TemporalFolds:[{fold:1,testPeriod:"Aug 29 - Dec 2, 2024",hitRate:.75,sampleCount:72253,deviation:-1.6},{fold:2,testPeriod:"Dec 3, 2024 - Mar 14, 2025",hitRate:.694,sampleCount:110180,deviation:-7.2},{fold:3,testPeriod:"Mar 17 - Jun 26, 2025",hitRate:.748,sampleCount:108676,deviation:-1.8},{fold:4,testPeriod:"Jun 27 - Sep 30, 2025",hitRate:.852,sampleCount:130333,deviation:8.6},{fold:5,testPeriod:"Oct 1, 2025 - Jan 12, 2026",hitRate:.765,sampleCount:215197,deviation:-.1}]},ee=({title:s,buckets:l,modelType:r})=>{const o=r==="v21"?l.filter(i=>i.minScore>=50):l,d=i=>i>=.8?"text-green-700 dark:text-green-400":i>=.7?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400",h=i=>i>=.8?"bg-green-50 dark:bg-green-950":i>=.7?"bg-amber-50 dark:bg-amber-950":"bg-red-50 dark:bg-red-950";return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:s}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"text-left font-semibold",children:r==="v21"?"Score Range":"Predicted Range"}),e.jsx(p,{className:"text-center font-semibold",children:"Actual Worthless %"}),e.jsx(p,{className:"text-center font-semibold",children:"Sample Size"}),e.jsx(p,{className:"text-center font-semibold",children:"95% CI"}),e.jsx(p,{className:"text-left font-semibold",children:"Notes"})]})}),e.jsx(z,{children:o.map((i,j)=>e.jsxs(b,{className:`hover:bg-opacity-75 ${h(i.hitRate)}`,children:[e.jsx(t,{className:"font-medium text-gray-900 dark:text-gray-100",children:i.rangeLabel}),e.jsxs(t,{className:`text-center font-bold ${d(i.hitRate)}`,children:[f(i.hitRate*100,1),"%"]}),e.jsx(t,{className:"text-center text-gray-700 dark:text-gray-300",children:T(i.sampleSize)}),e.jsxs(t,{className:"text-center text-sm text-gray-700 dark:text-gray-300",children:["[",f(i.confidenceIntervalLower*100,1),"% â€“"," ",f(i.confidenceIntervalUpper*100,1),"%]"]}),e.jsxs(t,{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.isPremiumZone&&e.jsx("span",{className:"inline-block bg-amber-200 dark:bg-amber-800 text-amber-900 dark:text-amber-100 px-2 py-1 rounded text-xs font-semibold mr-2",children:"âœ“ OPTIMAL"}),i.expectedNote]})]},`${i.rangeLabel}-${j}`))})]})})]})},ze=({folds:s})=>{const[l,r]=u.useState(!1),o=d=>Math.abs(d)<2?"text-gray-700 dark:text-gray-300":d>0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400";return e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-900 space-y-4",children:[e.jsxs("button",{onClick:()=>r(!l),className:"flex items-center gap-2 font-semibold text-gray-900 dark:text-gray-100 hover:text-gray-600 dark:hover:text-gray-300 transition-colors w-full",children:[l?e.jsx(B,{className:"h-5 w-5"}):e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{children:"Temporal Stability Analysis (Per-Fold 70-80% Bucket)"})]}),l&&e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:`This analysis shows how the TA ML Model's Actual Worthless % at the 70-80% prediction range varied across different market periods. Each "fold" represents a distinct 3-month testing window in walk-forward validation. The overall average across all periods is approximately 77%, but individual periods show deviation due to market regime changes.`}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"text-center font-semibold",children:"Fold"}),e.jsx(p,{className:"text-left font-semibold",children:"Test Period"}),e.jsx(p,{className:"text-center font-semibold",children:"Actual Worthless %"}),e.jsx(p,{className:"text-center font-semibold",children:"Sample Size"}),e.jsx(p,{className:"text-center font-semibold",children:"Deviation from 77%"})]})}),e.jsx(z,{children:s.map(d=>e.jsxs(b,{children:[e.jsx(t,{className:"text-center font-semibold text-gray-900 dark:text-gray-100",children:d.fold}),e.jsx(t,{className:"text-gray-700 dark:text-gray-300",children:d.testPeriod}),e.jsxs(t,{className:"text-center font-semibold text-amber-600 dark:text-amber-400",children:[f(d.hitRate*100,1),"%"]}),e.jsx(t,{className:"text-center text-gray-700 dark:text-gray-300",children:T(d.sampleCount)}),e.jsx(t,{className:"text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsxs("span",{className:`font-semibold ${o(d.deviation)}`,children:[d.deviation>0?"+":"",ke(d.deviation,1)]})})})]},d.fold))})]})}),e.jsxs("div",{className:"space-y-3 bg-white dark:bg-gray-800 rounded p-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Key Observations:"}),e.jsxs("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Fold 1-4:"})," Variation ranges from -12.3pp (Fold 2) to +7.0pp (Fold 3), showing how market regimes affect calibration"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Fold 2 Underperformance:"})," Dec 2024 - Mar 2025 experienced significant degradation (64.7% actual vs 77% expected). This reflects a temporary market regime shift during this period."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Recent Performance:"})," Folds 4-5 (Jun 2025 - Jan 2026) show improvement to 79-81%, suggesting the model is well-calibrated for current market conditions."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Overall Average:"})," Across all periods combined, the TA ML Model achieved 77% Actual Worthless % at 70-80% predictions. This aggregate rate masks period-to-period variation. Users should understand that actual performance fluctuates with market regimes, though the long-term average remains stable."]})]})]})]})]})},Oe=()=>e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:"ðŸ’¡ Key Insights: The Premium Collection Sweet Spot"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Two Independent Models:"})," When predicting 70-80% probability, Probability Optimization Model achieved 83.8% accuracy (options actually expired worthless), TA ML Model achieved 72.42%. Different market coverage explains the difference: Probability Optimization Model specializes on deeply-tracked options (19.8K sample); TA Model validates on comprehensive historical data (1.4M sample across all market conditions)."]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Data-Driven Metrics:"})," Actual Worthless % varies by model and prediction range. Review the detailed tables below for comprehensive performance data."]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Statistical Precision:"})," Large sample sizes (1.4M for TA ML Model, 19.8K for Probability Model at 70-80%) provide high confidence in the estimates. Confidence intervals show the range where true Actual Worthless % likely falls."]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Risk Assessment:"})," Lower Actual Worthless % indicates higher risk. Evaluate model performance across prediction ranges to support your trading decisions."]})})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 italic",children:"Source: Validated testing on 1.8M+ Swedish equity option records (April 2024 - January 2026)."})]}),Ee=()=>{const[s,l]=u.useState("v21"),[r,o]=u.useState(!1);return e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-3 text-left",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Model Calibration & Accuracy"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"When models predict 70-80% probability: Probability Optimization achieves 83.8% accuracy, TA ML Model 72.42%. Both validated on 934K+ historical options."})]})}),r?e.jsx(B,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 flex-shrink-0"}):e.jsx(O,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 flex-shrink-0"})]}),r&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-6 bg-gray-50 dark:bg-gray-900 space-y-6",children:[e.jsx(Oe,{}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>l("v21"),className:`px-4 py-3 font-semibold transition-colors ${s==="v21"?"text-gray-900 dark:text-gray-100 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Probability Optimization Model"}),e.jsx("button",{onClick:()=>l("v3"),className:`px-4 py-3 font-semibold transition-colors ${s==="v3"?"text-gray-900 dark:text-gray-100 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"TA ML Model"})]}),s==="v21"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"The Probability Optimization Model combines three factors to estimate the likelihood an option will expire worthless (out-of-the-money). This table shows the historical accuracy of predictions at different probability levels, based on analysis of 72,469 options with known outcomes."}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Testing approach:"})," In-sample calibration on the Probability Tracking System (options actively tracked with complete historical snapshots). The 83.8% accuracy at 70-80% represents how well the formula works on this specific tracked dataset. Sample size of 19,830 at 70-80% is sufficient for high statistical confidence on tracked options."]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-3 border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"DATA REQUIREMENT DETAIL:"}),e.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:["Probability Optimization Model requires ",e.jsx("strong",{children:"5 complex probability calculation methods"})," (Black-Scholes + calibration + historical volatility + Bayesian + ensemble). This requires months of special historical probability tracking data. Of 1.86M historical options, only ",e.jsx("strong",{children:"72,469 (3.9%)"})," have complete: probability calculations + historical peak data + support metrics + known outcomes. This is why sample size is limited."]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100 mb-2",children:"Why Different Sample Sizes?"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"Probability Optimization Model tests on 72,469 total options (Probability Tracking System) â†’ 19,830 at 70-80%. TA Model tests on 1,860,935 total options (comprehensive historical database) â†’ 636,639 at 70-80%. The 32x difference reflects different data sources: Probability Optimization is limited to tracked options, while TA Model accesses all Swedish equity options. Both use 27% of their respective datasets at 70-80%, showing identical market distribution."})]}),e.jsx(ee,{title:"Probability Optimization Model - Actual Worthless % by Score Range",buckets:I.v21Buckets,modelType:"v21"})]}),s==="v3"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"The TA ML Model uses machine learning to analyze 17 different signals about each option and the underlying stock to estimate the probability it will expire worthless. This table shows the historical accuracy of predictions at different probability levels."}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Testing approach:"})," Walk-forward temporal validation on the comprehensive historical database (all Swedish options, not just tracked ones). The model trains on historical data, then predicts on future periods it never saw. The 76.6% accuracy at 70-80% represents realistic expectation for new options the model hasn't encountered. Sample size of 636,639 at 70-80% provides extremely tight confidence intervals (Â±0.11 pp), proving the model generalizes well beyond training data."]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-3 border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"DATA REQUIREMENT DETAIL:"}),e.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:["TA Model uses ",e.jsx("strong",{children:"17 standard technical analysis features"})," (RSI, MACD, ADX, Bollinger Bands, Greeks, etc.) calculated from standard daily price data. These work on ",e.jsx("strong",{children:"any option with basic market data"}),". Of 1.86M historical options, ",e.jsx("strong",{children:"~1,860,935 (99%+)"})," have complete technical feature data. No special probability tracking required, no months of historical data neededâ€”just standard market data every stock has."]})]})]}),e.jsx(ee,{title:"TA ML Model - Actual Worthless % by Predicted Range",buckets:I.v3Buckets,modelType:"v3"}),I.v3TemporalFolds&&e.jsx(ze,{folds:I.v3TemporalFolds})]})]})]})},$e=()=>{const[s,l]=u.useState("v21"),[r,o]=u.useState(!1);return e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-3 text-left",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Loss Analysis - In-the-Money Scenarios"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Historical loss data when options expire in-the-money (ITM). V2.1: 263,723 ITM options analyzed. TA Model V3: 2.3M+ ITM options (walk-forward validation)."})]})}),r?e.jsx(B,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 flex-shrink-0"}):e.jsx(O,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 flex-shrink-0"})]}),r&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-6 bg-gray-50 dark:bg-gray-900 space-y-8",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>l("v21"),className:`px-4 py-3 font-semibold transition-colors ${s==="v21"?"text-gray-900 dark:text-gray-100 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Probability Optimization Model"}),e.jsx("button",{onClick:()=>l("v3"),className:`px-4 py-3 font-semibold transition-colors ${s==="v3"?"text-gray-900 dark:text-gray-100 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"TA ML Model"})]}),s==="v21"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"text-left font-semibold",children:"Score Bucket"}),e.jsx(p,{className:"text-center font-semibold",children:"Sample Size"}),e.jsx(p,{className:"text-center font-semibold",children:"Avg Loss"}),e.jsx(p,{className:"text-center font-semibold",children:"Median Loss"}),e.jsx(p,{className:"text-center font-semibold",children:"Min Loss"}),e.jsx(p,{className:"text-center font-semibold",children:"95th Percentile"}),e.jsx(p,{className:"text-center font-semibold",children:"Max Loss"})]})}),e.jsxs(z,{children:[e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"<50%"}),e.jsx(t,{className:"text-center",children:T(47103)}),e.jsx(t,{className:"text-center font-semibold",children:"11,62%"}),e.jsx(t,{className:"text-center",children:"9,43%"}),e.jsx(t,{className:"text-center",children:"0,00%"}),e.jsx(t,{className:"text-center",children:"30,69%"}),e.jsx(t,{className:"text-center",children:"56,19%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"50-60%"}),e.jsx(t,{className:"text-center",children:T(40959)}),e.jsx(t,{className:"text-center font-semibold",children:"7,57%"}),e.jsx(t,{className:"text-center",children:"5,77%"}),e.jsx(t,{className:"text-center",children:"0,00%"}),e.jsx(t,{className:"text-center",children:"20,55%"}),e.jsx(t,{className:"text-center",children:"49,00%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"60-70%"}),e.jsx(t,{className:"text-center",children:T(63043)}),e.jsx(t,{className:"text-center font-semibold",children:"7,26%"}),e.jsx(t,{className:"text-center",children:"5,10%"}),e.jsx(t,{className:"text-center",children:"0,00%"}),e.jsx(t,{className:"text-center",children:"21,60%"}),e.jsx(t,{className:"text-center",children:"56,79%"})]}),e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950",children:[e.jsx(t,{className:"font-medium",children:"70-80%"}),e.jsx(t,{className:"text-center",children:T(67616)}),e.jsx(t,{className:"text-center font-semibold",children:"5,70%"}),e.jsx(t,{className:"text-center",children:"3,80%"}),e.jsx(t,{className:"text-center",children:"0,00%"}),e.jsx(t,{className:"text-center",children:"17,48%"}),e.jsx(t,{className:"text-center",children:"45,25%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"80-100%"}),e.jsx(t,{className:"text-center",children:T(45002)}),e.jsx(t,{className:"text-center font-semibold",children:"4,63%"}),e.jsx(t,{className:"text-center",children:"3,07%"}),e.jsx(t,{className:"text-center",children:"0,00%"}),e.jsx(t,{className:"text-center",children:"14,14%"}),e.jsx(t,{className:"text-center",children:"39,39%"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Data source: v2_1_loss_analysis_summary_cleaned.csv (263,723 ITM options). Dataset cleaned by removing 2,957 Embracer Group AB options with artificial losses from stock split event."})]}),s==="v3"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"text-left font-semibold",children:"Predicted Range"}),e.jsx(p,{className:"text-center font-semibold",children:"Avg Loss"}),e.jsx(p,{className:"text-center font-semibold",children:"Median Loss"})]})}),e.jsxs(z,{children:[e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"90%+"}),e.jsx(t,{className:"text-center font-semibold",children:"6,44%"}),e.jsx(t,{className:"text-center",children:"4,41%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"80-90%"}),e.jsx(t,{className:"text-center font-semibold",children:"6,64%"}),e.jsx(t,{className:"text-center",children:"4,33%"})]}),e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950",children:[e.jsx(t,{className:"font-medium",children:"70-80%"}),e.jsx(t,{className:"text-center font-semibold",children:"6,64%"}),e.jsx(t,{className:"text-center",children:"4,62%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"60-70%"}),e.jsx(t,{className:"text-center font-semibold",children:"7,23%"}),e.jsx(t,{className:"text-center",children:"4,85%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"50-60%"}),e.jsx(t,{className:"text-center font-semibold",children:"8,19%"}),e.jsx(t,{className:"text-center",children:"5,90%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"<50%"}),e.jsx(t,{className:"text-center font-semibold",children:"12,16%"}),e.jsx(t,{className:"text-center",children:"10,38%"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Data source: ta_v3_calibration_results.csv (walk-forward validation on 2.3M+ ITM options)."})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Loss Distribution Summary (70-80% Primary Operating Zone)"}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(b,{children:[e.jsx(p,{className:"text-left font-semibold",children:"Metric"}),e.jsx(p,{className:"text-center font-semibold",children:"Probability Optimization"}),e.jsx(p,{className:"text-center font-semibold",children:"TA Model V3"})]})}),e.jsxs(z,{children:[e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"Hit Rate"}),e.jsx(t,{className:"text-center",children:"62,51%"}),e.jsx(t,{className:"text-center",children:"70,16%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"ITM Failure Rate"}),e.jsx(t,{className:"text-center",children:"37,49%"}),e.jsx(t,{className:"text-center",children:"29,84%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"Avg Loss When ITM"}),e.jsx(t,{className:"text-center font-semibold",children:"5,70%"}),e.jsx(t,{className:"text-center font-semibold",children:"6,64%"})]}),e.jsxs(b,{children:[e.jsx(t,{className:"font-medium",children:"Median Loss When ITM"}),e.jsx(t,{className:"text-center",children:"3,80%"}),e.jsx(t,{className:"text-center",children:"4,62%"})]})]})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Loss Scaling by Confidence Level"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Probability Optimization Model"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Lowest confidence (<50%):"}),e.jsx("span",{className:"font-semibold",children:"11,62%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Highest confidence (80-100%):"}),e.jsx("span",{className:"font-semibold",children:"4,63%"})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-300 dark:border-gray-600 pt-2",children:[e.jsx("span",{children:"Ratio:"}),e.jsx("span",{className:"font-semibold",children:"2.51x"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-gray-100",children:"TA Model V3"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Lowest confidence (<50%):"}),e.jsx("span",{className:"font-semibold",children:"12,16%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Highest confidence (90%+):"}),e.jsx("span",{className:"font-semibold",children:"6,44%"})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-300 dark:border-gray-600 pt-2",children:[e.jsx("span",{children:"Ratio:"}),e.jsx("span",{className:"font-semibold",children:"1.89x"})]})]})]})]})]})]})]})};function Be(s,l,r){return r.find(o=>s>=o.minScore&&s<o.maxScore)}function Ve(s,l,r){const o=r.filter(d=>s<d.maxScore&&l>d.minScore);return o.length===0?0:o.length===1?o[0].sampleSize:o.reduce((d,h)=>d+h.sampleSize,0)}function Fe(s){if(!s)return 0;const l=1-s.hitRate;return Math.round(l*100*10)/10}function We(s,l){if(!s||s.length===0)return{avgCombinedScore:null,sampleSize:null,maxHistoricalLoss:null};const r=s.map(N=>N.combined_score).filter(N=>N!=null),o=r.length>0?Math.round(r.reduce((N,c)=>N+c,0)/r.length*10)/10:null,d=r.sort((N,c)=>N-c),h=d[0],i=d[d.length-1],j=Be(h,i,l.v21Buckets),m=Ve(h,i,l.v21Buckets),a=m>0?T(m,0):null,v=j?Fe(j):null;return{avgCombinedScore:o,sampleSize:a,maxHistoricalLoss:v}}const se=({label:s,value:l,subValue:r,icon:o,iconColor:d,tooltipTitle:h,tooltipContent:i,colorClass:j="text-blue-600",valueClassName:m})=>e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx(w,{title:h,content:i})]}),e.jsx("p",{className:`text-3xl font-bold mt-2 ${m||""}`,children:l??"-"}),r&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r})]}),e.jsx(o,{className:`h-8 w-8 ${j}`})]})})}),cs=()=>{xe("Scored Options Recommendations");const{data:s,isLoading:l,error:r}=be(),{settings:o,isLoading:d,saveSettings:h}=De(),{toast:i}=oe(),j=u.useRef(!1),[m,a]=u.useState(()=>({expiryDate:"",stockNames:[],agreement:"all",minScore:70,minV21Score:0,minTAProb:0})),v=u.useMemo(()=>!s||s.length===0?[]:[...new Set(s.map(x=>x.expiry_date))].sort(),[s]),N=u.useMemo(()=>!s||s.length===0?[]:[...new Set(s.map(x=>x.stock_name))].sort(),[s]);u.useEffect(()=>{if(j.current||s.length===0||d)return;console.log("ðŸ“¥ Loading preferences from Supabase:",o);const x=[...new Set(s.map(A=>A.stock_name))].sort(),y=[...new Set(s.map(A=>A.expiry_date))].sort(),S=o.stockNames.filter(A=>x.includes(A));let k=o.expiryDate;if(k&&!y.includes(k)&&(console.log("âš ï¸ Saved expiry date no longer available:",k),k=""),!k&&y.length>0){const A=U(y);A&&(k=A),console.log("ðŸŽ¯ Using default expiry date:",k)}console.log("âœ… Valid saved stocks:",S),console.log("âœ… Valid saved expiry date:",k),a({expiryDate:k,stockNames:S,agreement:o.agreement,minScore:o.minScore,minV21Score:o.minV21Score,minTAProb:o.minTAProb}),j.current=!0},[s,d,o]),u.useEffect(()=>{if(!m.expiryDate&&v.length>0&&!j.current){const x=U(v);x&&a(y=>({...y,expiryDate:x}))}},[v]),u.useEffect(()=>{if(!d&&s.length>0&&j.current){const x=setTimeout(()=>{console.log("ðŸ’¾ Saving preferences to Supabase:",m),h(m)},500);return()=>clearTimeout(x)}},[m,d,s.length,h]);const c=u.useMemo(()=>s.filter(x=>{if(m.expiryDate&&x.expiry_date!==m.expiryDate||m.stockNames.length>0&&!m.stockNames.includes(x.stock_name)||m.agreement==="agree"&&!x.models_agree||m.agreement==="disagree"&&x.models_agree)return!1;if(x.combined_score==null){if(m.minScore>0)return!1}else if(x.combined_score<m.minScore)return!1;if(x.v21_score==null){if(m.minV21Score>0)return!1}else if(x.v21_score<m.minV21Score)return!1;if(x.ta_probability==null){if(m.minTAProb>0)return!1}else if(x.ta_probability*100<m.minTAProb)return!1;return!0}),[s,m]),_=u.useMemo(()=>({totalOptions:s.length,currentlyShowing:c.length}),[s,c]),M=u.useMemo(()=>We(c,I),[c,I]),E=M.avgCombinedScore?M.avgCombinedScore>=75?"text-green-600":M.avgCombinedScore>=70?"text-orange-500":"text-red-600":"",V=x=>(window.location.hostname==="datamilo.github.io"?"/put-options-se":"")+x,F=()=>{const x=[...new Set(s.map(S=>S.expiry_date))].sort(),y=x.length>0?U(x):"";a({expiryDate:y||"",stockNames:[],agreement:"all",minScore:70,minV21Score:0,minTAProb:0}),i({title:"Filters reset",description:"Filters have been reset to default settings"})},n=()=>{if(c.length===0){i({title:"No data to export",description:"Please adjust your filters to include at least one option.",variant:"destructive"});return}Le({filename:"scored-options",data:c}),i({title:"Export successful",description:`Exported ${c.length} scored options to Excel`})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Scored Options Recommendations"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Dual-model consensus screening: probability-based analysis cross-validated with machine learning technical indicators."})]}),r&&e.jsx(C,{className:"border-red-200 bg-red-50",children:e.jsx(D,{className:"pt-6",children:e.jsxs("p",{className:"text-red-800",children:[e.jsx("strong",{children:"Error loading data:"})," ",r]})})}),l&&e.jsx(C,{children:e.jsx(D,{className:"py-8",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading scored options data..."})})}),!l&&!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Options"}),e.jsx(w,{title:g.kpi.totalOptions.title,content:g.kpi.totalOptions.content})]}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:_.totalOptions})]}),e.jsx(H,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(se,{label:"Avg Combined Score",value:M.avgCombinedScore!==null?M.avgCombinedScore.toLocaleString("sv-SE",{minimumFractionDigits:1,maximumFractionDigits:1}):null,icon:H,iconColor:E||"text-blue-600",tooltipTitle:g.kpi.avgCombinedScore.title,tooltipContent:g.kpi.avgCombinedScore.content,valueClassName:E}),e.jsx(se,{label:"Sample Size",value:M.sampleSize,icon:Te,iconColor:"text-blue-600",tooltipTitle:g.kpi.sampleSize.title,tooltipContent:g.kpi.sampleSize.content}),e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Showing"}),e.jsx(w,{title:g.kpi.showing.title,content:g.kpi.showing.content})]}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:_.currentlyShowing}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[_.totalOptions>0?(_.currentlyShowing/_.totalOptions*100).toFixed(0):0,"%"]})]}),e.jsx(H,{className:"h-8 w-8 text-amber-600"})]})})})]}),e.jsx("div",{className:"mt-8",children:e.jsx(Ee,{})}),e.jsx("div",{className:"mt-8",children:e.jsx($e,{})}),e.jsx(Ie,{filters:m,onFiltersChange:a,onResetToDefault:F,availableStocks:N,availableExpiryDates:v}),c.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(J,{onClick:n,variant:"outline",className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Export to Excel"]})}),c.length===0?e.jsx(C,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx("p",{children:"No options found matching your filters."}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your filter criteria."})]})})}):e.jsx(Re,{data:c,filters:m,getFullPath:V})]})]})};export{cs as ScoredOptions};
